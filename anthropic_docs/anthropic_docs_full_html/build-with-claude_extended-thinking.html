<!DOCTYPE html>
<html class="dark" lang="en"><head><meta charset="utf-8"/><meta content="width=device-width" name="viewport"/><link href="https://mintlify.s3-us-west-1.amazonaws.com/anthropic/_generated/favicon/apple-touch-icon.png?v=3" rel="apple-touch-icon" sizes="180x180" type="image/png"/><link href="https://mintlify.s3-us-west-1.amazonaws.com/anthropic/_generated/favicon/favicon-32x32.png?v=3" rel="icon" sizes="32x32" type="image/png"/><link href="https://mintlify.s3-us-west-1.amazonaws.com/anthropic/_generated/favicon/favicon-16x16.png?v=3" rel="icon" sizes="16x16" type="image/png"/><link href="https://mintlify.s3-us-west-1.amazonaws.com/anthropic/_generated/favicon/favicon.ico?v=3" rel="shortcut icon" type="image/x-icon"/><meta content="https://mintlify.s3-us-west-1.amazonaws.com/anthropic/_generated/favicon/browserconfig.xml?v=3" name="msapplication-config"/><meta content="Anthropic" name="apple-mobile-web-app-title"/><meta content="Anthropic" name="application-name"/><meta content="#0E0E0E" name="msapplication-TileColor"/><meta content="#ffffff" name="theme-color"/><link href="/sitemap.xml" rel="sitemap" type="application/xml"/><meta content="utf-8" name="charset"/><meta content="website" name="og:type"/><meta content="Anthropic" name="og:site_name"/><meta content="summary_large_image" name="twitter:card"/><meta content="Building with extended thinking - Anthropic" name="og:title"/><meta content="Building with extended thinking - Anthropic" name="twitter:title"/><meta content="https://mintlify.com/docs/api/og?division=Documentation&amp;mode=light&amp;title=Building+with+extended+thinking&amp;logoLight=https%3A%2F%2Fmintlify.s3.us-west-1.amazonaws.com%2Fanthropic%2Flogo%2Flight.svg&amp;logoDark=https%3A%2F%2Fmintlify.s3.us-west-1.amazonaws.com%2Fanthropic%2Flogo%2Fdark.svg&amp;primaryColor=%230E0E0E&amp;lightColor=%23D4A27F&amp;darkColor=%230E0E0E" name="og:image"/><meta content="https://mintlify.com/docs/api/og?division=Documentation&amp;mode=light&amp;title=Building+with+extended+thinking&amp;logoLight=https%3A%2F%2Fmintlify.s3.us-west-1.amazonaws.com%2Fanthropic%2Flogo%2Flight.svg&amp;logoDark=https%3A%2F%2Fmintlify.s3.us-west-1.amazonaws.com%2Fanthropic%2Flogo%2Fdark.svg&amp;primaryColor=%230E0E0E&amp;lightColor=%23D4A27F&amp;darkColor=%230E0E0E" name="twitter:image"/><title>Building with extended thinking - Anthropic</title><meta content="/en/docs/build-with-claude/extended-thinking" name="og:url"/><link href="/en/docs/build-with-claude/extended-thinking" rel="canonical"/><meta content="23" name="next-head-count"/><link crossorigin="anonymous" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css" integrity="sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC" rel="stylesheet"/><link as="font" crossorigin="anonymous" data-next-font="size-adjust" href="/_next/static/media/a34f9d1faa5f3315-s.p.woff2" rel="preload" type="font/woff2"/><link as="font" crossorigin="anonymous" data-next-font="size-adjust" href="/_next/static/media/bb3ef058b751a6ad-s.p.woff2" rel="preload" type="font/woff2"/><link as="style" href="/_next/static/css/dc50e134f609f53d.css" rel="preload"/><link data-n-g="" href="/_next/static/css/dc50e134f609f53d.css" rel="stylesheet"/><noscript data-n-css=""></noscript></head><div id="__next"><main class="jsx-4145347147"><div class="relative antialiased text-gray-500 dark:text-gray-400"><div class="z-30 fixed lg:sticky top-0 w-full" id="navbar"><div class="max-w-8xl mx-auto relative"><div class=""><div class="relative"><div class="flex items-center lg:px-12 h-16 min-w-0 mx-4 lg:mx-0"><div class="h-full relative flex-1 flex items-center gap-x-4 min-w-0 border-b border-gray-500/5 dark:border-gray-300/[0.06]"><div class="flex-1 flex items-center gap-x-4"><a href="/"><span class="sr-only">Anthropic<!-- --> home page</span></a><div class="flex items-center gap-x-2"><button aria-expanded="false" aria-haspopup="menu" class="group bg-background-light dark:bg-background-dark disabled:pointer-events-none [&amp;&gt;span]:line-clamp-1 overflow-hidden group outline-none group-hover:text-zinc-950/70 dark:group-hover:text-white/70 text-xs gap-1.5 text-gray-500 dark:text-gray-400 leading-5 font-semibold border border-gray-200 dark:border-gray-800 hover:border-gray-300 dark:hover:border-gray-700 rounded-full py-1 px-3 flex items-center space-x-2 whitespace-nowrap" data-state="closed" id="radix-:R25fcql6:" type="button">English</button></div></div><div class="hidden lg:block mx-px relative flex-1 bg-white dark:bg-gray-900 pointer-events-auto rounded-xl min-w-0"><button class="w-full flex items-center text-sm leading-6 rounded-xl py-1.5 pl-3.5 pr-3 shadow-sm text-gray-400 dark:text-white/50 bg-background-light dark:bg-background-dark dark:brightness-[1.1] dark:ring-1 dark:hover:brightness-[1.25] ring-1 ring-gray-400/20 hover:ring-gray-600/25 dark:ring-gray-600/30 dark:hover:ring-gray-500/30 focus:outline-primary justify-between truncate gap-2 min-w-[43px]" id="search-bar-entry" type="button"><div class="flex items-center gap-3 min-w-[42px]"><div class="truncate min-w-0">Search...</div></div></button></div><div class="flex lg:hidden items-center gap-2"><button class="text-gray-500 w-8 h-8 flex items-center justify-center hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300" id="search-bar-entry-mobile" type="button"><span class="sr-only">Search...</span></button></div></div></div><div class="flex items-center h-14 py-4 px-5 lg:hidden"><button class="text-gray-500 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300" type="button"><span class="sr-only">Navigation</span></button><div class="ml-4 flex text-sm leading-6 whitespace-nowrap min-w-0 space-x-3"><div class="flex items-center space-x-3"><span>Build with Claude</span></div><div class="font-semibold text-gray-900 truncate dark:text-gray-200">Building with extended thinking</div></div></div></div><div class="hidden lg:flex px-12 h-12"><div class="h-full flex text-sm space-x-6"><a class="group relative h-full flex items-center font-medium text-gray-600 dark:text-gray-400 group-hover:text-gray-800 dark:group-hover:text-gray-300" href="/en/home">Welcome</a><a class="group relative h-full flex items-center text-gray-800 dark:text-gray-200 font-semibold" href="/en/docs/welcome">User Guides</a><a class="group relative h-full flex items-center font-medium text-gray-600 dark:text-gray-400 group-hover:text-gray-800 dark:group-hover:text-gray-300" href="/en/api/getting-started">API Reference</a><a class="group relative h-full flex items-center font-medium text-gray-600 dark:text-gray-400 group-hover:text-gray-800 dark:group-hover:text-gray-300" href="/en/prompt-library/library">Prompt Library</a><a class="group relative h-full flex items-center font-medium text-gray-600 dark:text-gray-400 group-hover:text-gray-800 dark:group-hover:text-gray-300" href="/en/release-notes/overview">Release Notes</a></div></div></div></div></div><div class="max-w-8xl px-4 mx-auto lg:px-8 min-h-screen"><div class="z-20 hidden lg:block fixed bottom-0 right-auto w-[18rem] top-[7.1rem]" id="sidebar"><div class="absolute inset-0 z-10 stable-scrollbar-gutter overflow-auto pr-8 pb-10" id="sidebar-content"><div class="relative lg:text-sm lg:leading-6"><div id="navigation-items"><li class="list-none"><a class="pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://console.anthropic.com/" rel="noreferrer" target="_blank">Developer Console</a></li><li class="list-none"><a class="pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://www.anthropic.com/discord" rel="noreferrer" target="_blank">Developer Discord</a></li><li class="list-none"><a class="pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://support.anthropic.com/" rel="noreferrer" target="_blank">Support</a></li><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Get started</h5><ul><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/welcome"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/welcome" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Overview</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/initial-setup"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/initial-setup" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Initial setup</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/intro-to-claude"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/intro-to-claude" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Intro to Claude</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Learn about Claude</h5><ul><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Use cases</div></div></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Models &amp; pricing</div></div></li><li class="scroll-m-4 first:scroll-m-20" id="https://trust.anthropic.com/"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://trust.anthropic.com/" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Security and compliance</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Build with Claude</h5><ul><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/define-success"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/define-success" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Define success criteria</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/develop-tests"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/develop-tests" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Develop test cases</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/context-windows"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/context-windows" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Context windows</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/vision"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/vision" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Vision</div></div></a></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Prompt engineering</div></div></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/extended-thinking"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl bg-primary/10 text-primary font-semibold dark:text-primary-light dark:bg-primary-light/10" href="/en/docs/build-with-claude/extended-thinking" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Extended thinking</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/multilingual-support"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/multilingual-support" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Multilingual support</div></div></a></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Tool use (function calling)</div></div></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/prompt-caching"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/prompt-caching" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Prompt caching</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/pdf-support"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/pdf-support" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>PDF support</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/citations"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/citations" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Citations</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/token-counting"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/token-counting" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Token counting</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/batch-processing"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/batch-processing" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Batch processing</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/embeddings"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/embeddings" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Embeddings</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Agents and tools</h5><ul><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Claude Code</div></div></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/agents-and-tools/computer-use"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/agents-and-tools/computer-use" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Computer use (beta)</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/agents-and-tools/mcp"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/agents-and-tools/mcp" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Model Context Protocol (MCP)</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/agents-and-tools/claude-for-sheets"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/agents-and-tools/claude-for-sheets" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Google Sheets add-on</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Test and evaluate</h5><ul><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Strengthen guardrails</div></div></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/test-and-evaluate/eval-tool"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/test-and-evaluate/eval-tool" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Using the Evaluation Tool</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Administration</h5><ul><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/administration/administration-api"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/administration/administration-api" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Admin API</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Resources</h5><ul><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/resources/glossary"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/resources/glossary" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Glossary</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/resources/model-deprecations"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/resources/model-deprecations" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Model deprecations</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="https://status.anthropic.com/"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://status.anthropic.com/" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>System status</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="https://assets.anthropic.com/m/61e7d27f8c8f5919/original/Claude-3-Model-Card.pdf"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://assets.anthropic.com/m/61e7d27f8c8f5919/original/Claude-3-Model-Card.pdf" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Claude 3 model card</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="https://anthropic.com/claude-3-7-sonnet-system-card"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://anthropic.com/claude-3-7-sonnet-system-card" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Claude 3.7 system card</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="https://github.com/anthropics/anthropic-cookbook"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://github.com/anthropics/anthropic-cookbook" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Anthropic Cookbook</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="https://github.com/anthropics/courses"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://github.com/anthropics/courses" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Anthropic Courses</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/resources/api-features"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/resources/api-features" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>API features</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Legal center</h5><ul><li class="scroll-m-4 first:scroll-m-20" id="https://www.anthropic.com/legal/privacy"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://www.anthropic.com/legal/privacy" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Anthropic Privacy Policy</div></div></a></li></ul></div></div></div></div></div><div class="" id="content-container"><div class="flex flex-row gap-12 box-border w-full pt-40 lg:pt-10"><div class="relative grow box-border flex-col w-full mx-auto px-1 lg:pl-[23.7rem] lg:-ml-12 xl:w-[calc(100%-28rem)]" id="content-area"><div class="relative mt-8 prose prose-gray dark:prose-invert"><p>Extended thinking gives Claude 3.7 Sonnet enhanced reasoning capabilities for complex tasks, while also providing transparency into its step-by-step thought process before it delivers its final answer.</p>
<h2 class="flex whitespace-pre-wrap group" id="how-extended-thinking-works"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#how-extended-thinking-works">​</a></div><span class="cursor-pointer">How extended thinking works</span></h2>
<p>When extended thinking is turned on, Claude creates <code>thinking</code> content blocks where it outputs its internal reasoning. Claude incorporates insights from this reasoning before crafting a final response.</p>
<p>The API response will include both <code>thinking</code> and <code>text</code> content blocks.</p>
<p>In multi-turn conversations, only thinking blocks associated with a tool use session or <code>assistant</code> turn in the last message position are visible to Claude and are billed as input tokens; thinking blocks associated with earlier <code>assistant</code> messages are <a href="/en/docs/build-with-claude/context-windows#the-context-window-with-extended-thinking">not visible</a> to Claude during sampling and do not get billed as input tokens.</p>
<h2 class="flex whitespace-pre-wrap group" id="implementing-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#implementing-extended-thinking">​</a></div><span class="cursor-pointer">Implementing extended thinking</span></h2>
<p>Add the <code>thinking</code> parameter and a specified token budget to use for extended thinking to your API request.</p>
<p>The <code>budget_tokens</code> parameter determines the maximum number of tokens Claude is allowed to use for its internal reasoning process. Larger budgets can improve response quality by enabling more thorough analysis for complex problems, although Claude may not use the entire budget allocated, especially at ranges above 32K.</p>
<p>Your <code>budget_tokens</code> must always be less than the <code>max_tokens</code> specified.</p>
<!-- -->
<h2 class="flex whitespace-pre-wrap group" id="understanding-thinking-blocks"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#understanding-thinking-blocks">​</a></div><span class="cursor-pointer">Understanding thinking blocks</span></h2>
<p>Thinking blocks represent Claude’s internal thought process. In order to allow Claude to work through problems with minimal internal restrictions while maintaining our safety standards and our stateless APIs, we have implemented the following:</p>
<ul>
<li>Thinking blocks contain a <code>signature</code> field. This field holds a cryptographic token which verifies that the thinking block was generated by Claude, and is verified when thinking blocks are passed back to the API. When streaming responses, the signature is added via a <code>signature_delta</code> inside a <code>content_block_delta</code> event just before the <code>content_block_stop</code> event. It is only strictly necessary to send back thinking blocks when using <a href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#extended-thinking-with-tool-use">tool use with extended thinking</a>. Otherwise you can omit thinking blocks from previous turns, or let the API strip them for you if you pass them back.</li>
<li>Occasionally Claude’s internal reasoning will be flagged by our safety systems. When this occurs, we encrypt some or all of the <code>thinking</code> block and return it to you as a <code>redacted_thinking</code> block. These redacted thinking blocks are decrypted when passed back to the API, allowing Claude to continue its response without losing context.</li>
<li><code>thinking</code> and <code>redacted_thinking</code> blocks are returned before the <code>text</code> blocks in the response.</li>
</ul>
<p>Here’s an example showing both normal and redacted thinking blocks:</p>
<div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json"><code class="language-json"><span class=""><span class="token punctuation">{</span></span>
<span class="">  <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking"</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">"Let me analyze this step by step..."</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"signature"</span><span class="token operator">:</span> <span class="token string">"WaUjzkypQ2mUEVM36O2TxuC06KN8xyfbJwyem2dw3URve/op91XWHOEBLLqIOMfFG/UvLEczmEsUjavL...."</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"redacted_thinking"</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"data"</span><span class="token operator">:</span> <span class="token string">"EmwKAhgBEgy3va3pzix/LafPsn4aDFIT2Xlxh0L5L8rLVyIwxtE3rAFBa8cr3qpP..."</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Based on my analysis..."</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class="">  <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<div class="my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10"><div class="text-sm prose min-w-0 text-sky-900 dark:text-sky-200"><p>Seeing redacted thinking blocks in your output is expected behavior. The model can still use this redacted reasoning to inform its responses while maintaining safety guardrails.</p><p>If you need to test redacted thinking handling in your application, you can use this special test string as your prompt: <code>ANTHROPIC_MAGIC_STRING_TRIGGER_REDACTED_THINKING_46C9A13E193C177646C7398A98432ECCCE4C1253D5E2D82641AC0E52CC2876CB</code></p></div></div>
<p>When passing <code>thinking</code> and <code>redacted_thinking</code> blocks back to the API in a multi-turn conversation, you must include the complete unmodified block back to the API for the last assistant turn.</p>
<p>This is critical for maintaining the model’s reasoning flow. We suggest always passing back all thinking blocks to the API. For more details, see the <a href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#preserving-thinking-blocks">Preserving thinking blocks</a> section below.</p>
<div class="[&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="example-working-with-redacted-thinking-blocks accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Example: Working with redacted thinking blocks</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="example-working-with-redacted-thinking-blocks accordion children"><p>This example demonstrates how to handle <code>redacted_thinking</code> blocks that may appear in responses when Claude’s internal reasoning contains content flagged by safety systems:</p></div></div></div>
<h3 class="flex whitespace-pre-wrap group" id="suggestions-for-handling-redacted-thinking-in-production"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#suggestions-for-handling-redacted-thinking-in-production">​</a></div><span class="cursor-pointer">Suggestions for handling redacted thinking in production</span></h3>
<p>When building customer-facing applications that use extended thinking:</p>
<ul>
<li>Be aware that redacted thinking blocks contain encrypted content that isn’t human-readable</li>
<li>Consider providing a simple explanation like: “Some of Claude’s internal reasoning has been automatically encrypted for safety reasons. This doesn’t affect the quality of responses.”</li>
<li>If showing thinking blocks to users, you can filter out redacted blocks while preserving normal thinking blocks</li>
<li>Be transparent that using extended thinking features may occasionally result in some reasoning being encrypted</li>
<li>Implement appropriate error handling to gracefully manage redacted thinking without breaking your UI</li>
</ul>
<h2 class="flex whitespace-pre-wrap group" id="streaming-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#streaming-extended-thinking">​</a></div><span class="cursor-pointer">Streaming extended thinking</span></h2>
<p>When streaming is enabled, you’ll receive thinking content via <code>thinking_delta</code> events. Here’s how to handle streaming with thinking:</p>
<!-- -->
<p>Example streaming output:</p>
<div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json"><code class="language-json"><span class="">event<span class="token operator">:</span> message_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message_start"</span><span class="token punctuation">,</span> <span class="token property">"message"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"msg_01..."</span><span class="token punctuation">,</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token property">"role"</span><span class="token operator">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">"model"</span><span class="token operator">:</span> <span class="token string">"claude-3-7-sonnet-20250219"</span><span class="token punctuation">,</span> <span class="token property">"stop_reason"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span> <span class="token property">"stop_sequence"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_start"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">"content_block"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking"</span><span class="token punctuation">,</span> <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_delta"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">"delta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking_delta"</span><span class="token punctuation">,</span> <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">"Let me solve this step by step:\n\n1. First break down 27 * 453"</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_delta"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">"delta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking_delta"</span><span class="token punctuation">,</span> <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">"\n2. 453 = 400 + 50 + 3"</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class=""><span class="token comment">// Additional thinking deltas...</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_delta"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">"delta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"signature_delta"</span><span class="token punctuation">,</span> <span class="token property">"signature"</span><span class="token operator">:</span> <span class="token string">"EqQBCgIYAhIM1gbcDa9GJwZA2b3hGgxBdjrkzLoky3dl1pkiMOYds..."</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_stop"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_start"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">"content_block"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_delta"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">"delta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text_delta"</span><span class="token punctuation">,</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"27 * 453 = 12,231"</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class=""><span class="token comment">// Additional text deltas...</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_stop"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> message_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message_delta"</span><span class="token punctuation">,</span> <span class="token property">"delta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"stop_reason"</span><span class="token operator">:</span> <span class="token string">"end_turn"</span><span class="token punctuation">,</span> <span class="token property">"stop_sequence"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> message_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message_stop"</span><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<div class="my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10"><div class="text-sm prose min-w-0 text-sky-900 dark:text-sky-200"><p><strong>About streaming behavior with thinking</strong></p><p>When using streaming with thinking enabled, you might notice that text sometimes arrives in larger chunks alternating with smaller, token-by-token delivery. This is expected behavior, especially for thinking content.</p><p>The streaming system needs to process content in batches for optimal performance, which can result in this “chunky” delivery pattern. We’re continuously working to improve this experience, with future updates focused on making thinking content stream more smoothly.</p><p><code>redacted_thinking</code> blocks will not have any deltas associated and will be sent as a single event.</p></div></div>
<div class="[&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="example-streaming-with-redacted-thinking accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Example: Streaming with redacted thinking</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="example-streaming-with-redacted-thinking accordion children"><p>This will output:</p><div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json"><code class="language-json"><span class="">event<span class="token operator">:</span> message_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"message_start"</span><span class="token punctuation">,</span><span class="token property">"message"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"msg_018J5iQyrGb5Xgy5CWx3iQFB"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"assistant"</span><span class="token punctuation">,</span><span class="token property">"model"</span><span class="token operator">:</span><span class="token string">"claude-3-7-sonnet-20250219"</span><span class="token punctuation">,</span><span class="token property">"content"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"stop_reason"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"stop_sequence"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"usage"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"input_tokens"</span><span class="token operator">:</span><span class="token number">92</span><span class="token punctuation">,</span><span class="token property">"cache_creation_input_tokens"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"cache_read_input_tokens"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"output_tokens"</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">}</span>       <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_start"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"content_block"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"redacted_thinking"</span><span class="token punctuation">,</span><span class="token property">"data"</span><span class="token operator">:</span><span class="token string">"EvEBCoYBGAIiQAqN5Z4LumxzafxD2yf2zW+hVm/G2/Am05ChRXkU1Xe2wQLPLo0wnmoaVJI1WTkLpRYJAIz2UjzHblLwkJ59xeAqQNr5EWqMZkOr8yNcpbCO5PssXiUvEjhoaC0IN3qyhE3vumOOS9Qd0Ku4AYTgu8VjP4C6IJHnkuIexa0VrU/cFbISDJjPWOWQlyAx4y5FCRoMk55jLUCR8KCZrKrzIjDR8S3F/pCWlz/JA5RN0uprpWAI75HjgcY2NJkPX3sEC0Ew6fl6YEISNk1XsmzWtj4qGArQlCfAW9l8SDiKbXm0UZ4hQhh2ruPbaw=="</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> ping</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"ping"</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_stop"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">0</span>         <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_start"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token property">"content_block"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"redacted_thinking"</span><span class="token punctuation">,</span><span class="token property">"data"</span><span class="token operator">:</span><span class="token string">"EvMBCoYBGAIiQKZ6LAz+dCNWxvz0dmjI0gfqEInA9MLVAtFJTpolzOaIbUs28xuKyXVzEQsPWPvP12gN+hxVJ4mYzWT8DCIAxXIqQHwQZcGASLMxWCfHrUlYfFq0vF8IGhRgQKxpj1zxouNLuKdhpZrcHF9vKODIPCPW8EWD13aI6t+exz/UboOs/ZMSDA8tVDp4vkOEUc7sGBoMbiRhGYMqcmAOhb3nIjC/lewBt2l9P+VpJkV78YQ3LhvNh/q3KfsbGuJ2U+lIMPGf9wnzrRC/6xqdsHPe1B0qGozBPKnbBifhyb7xYyWcEWoi/qW9OdoFl1/w"</span><span class="token punctuation">}</span>            <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_stop"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">1</span>             <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_start"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token property">"content_block"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"redacted_thinking"</span><span class="token punctuation">,</span><span class="token property">"data"</span><span class="token operator">:</span><span class="token string">"Eu8BCoYBGAIiQCXtUNB4QyT//Zww832Q+xjJ0oa7/PQZr74OvbS1+a7cRNywZfYMYGGte3RXXTMa6I0bFJOMmXXckcbLxR/L+msqQLhKGx9Bt2FnLpo7bp/PdMQBDDCo+jkbOctnxBQrHCuYbu33o30qPCh73AZ8O1xXXEZfzfLC0L6RoHzLxQSHN5gSDAxGSY7Ifg073BaUYBoMSWHLVrmZrydEfc7SIjAF1R+fYlyVPFwS4Sac/Dw9caskXNF/p+Yn7RNaW9+v/jL03qsqqvemuqRGltSBfZcqFrowQipxo/ftIkEC47Ua64RzSBIe27E="</span><span class="token punctuation">}</span>   <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_stop"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">2</span>              <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_start"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token property">"content_block"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"redacted_thinking"</span><span class="token punctuation">,</span><span class="token property">"data"</span><span class="token operator">:</span><span class="token string">"Eu8BCoYBGAIiQEgE6WUvQO3d6fPpY3OaA95soqeWgZv/Nyi0X6iywTb5KqvUn9NxWySiZwSFZb+4S8ymtHRO4OBKA7eRWEXcBuQqQNudvV6YSFH5ErwaDME0HaEjtHcuy8SslL6RhLwhEJKGpYCzq7zWupcMBB1g57sR8vh/JwGjr7D9sfX9jmM7EsESDEatCbzVVczyZ0TERRoMenFOToj2qn0Xmh1LIjA1WgxaMqiHhb5T4k/++UCKNMH2SEseLzTlR7uIz20qZUXDWtoVck6wc+x7lSWRKXQqFiLoTO1oG0I/lbPz1n2FgC3MH7683FU="</span><span class="token punctuation">}</span>     <span class="token punctuation">}</span></span>
<!-- -->
<span class=""><span class="token comment">// Additional events...</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_start"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">58</span><span class="token punctuation">,</span><span class="token property">"content_block"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"redacted_thinking"</span><span class="token punctuation">,</span><span class="token property">"data"</span><span class="token operator">:</span><span class="token string">"EuoBCoYBGAIiQJ/SxkPAgqxhKok29YrpJHRUJ0OT8ahCHKAwyhmRuUhtdmDX9+mn4gDzKNv3fVpQdB01zEPMzNY3QuTCd+1bdtEqQK6JuKHqdndbwpr81oVWb4wxd1GqF/7Jkw74IlQa27oobX+KuRkopr9Dllt/RDe7Se0sI1IkU7tJIAQCoP46OAwSDF51P09q67xhHlQ3ihoM2aOVlkghq/X0w8NlIjBMNvXYNbjhyrOcIg6kPFn2ed/KK7Cm5prYAtXCwkb4Wr5tUSoSHu9T5hKdJRbr6WsqEc7Lle7FULqMLZGkhqXyc3BA"</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_stop"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">58</span>            <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_start"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token property">"content_block"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token property">"text"</span><span class="token operator">:</span><span class="token string">""</span><span class="token punctuation">}</span>              <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_delta"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token property">"delta"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"text_delta"</span><span class="token punctuation">,</span><span class="token property">"text"</span><span class="token operator">:</span><span class="token string">"I'm"</span><span class="token punctuation">}</span>        <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_delta"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token property">"delta"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"text_delta"</span><span class="token punctuation">,</span><span class="token property">"text"</span><span class="token operator">:</span><span class="token string">" not"</span><span class="token punctuation">}</span>     <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_delta"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token property">"delta"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"text_delta"</span><span class="token punctuation">,</span><span class="token property">"text"</span><span class="token operator">:</span><span class="token string">" sure"</span><span class="token punctuation">}</span>    <span class="token punctuation">}</span></span>
<!-- -->
<span class=""><span class="token comment">// Additional text deltas...</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_delta"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token property">"delta"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"text_delta"</span><span class="token punctuation">,</span><span class="token property">"text"</span><span class="token operator">:</span><span class="token string">" me know what you'"</span><span class="token punctuation">}</span>          <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_delta"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">59</span><span class="token punctuation">,</span><span class="token property">"delta"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"text_delta"</span><span class="token punctuation">,</span><span class="token property">"text"</span><span class="token operator">:</span><span class="token string">"d like assistance with."</span><span class="token punctuation">}</span>   <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"content_block_stop"</span><span class="token punctuation">,</span><span class="token property">"index"</span><span class="token operator">:</span><span class="token number">59</span>               <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> message_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"message_delta"</span><span class="token punctuation">,</span><span class="token property">"delta"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"stop_reason"</span><span class="token operator">:</span><span class="token string">"end_turn"</span><span class="token punctuation">,</span><span class="token property">"stop_sequence"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token property">"usage"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"output_tokens"</span><span class="token operator">:</span><span class="token number">184</span><span class="token punctuation">}</span>  <span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> message_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"message_stop"</span>          <span class="token punctuation">}</span></span>
</code></pre></div></div></div></div></div></div>
<h2 class="flex whitespace-pre-wrap group" id="important-considerations-when-using-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#important-considerations-when-using-extended-thinking">​</a></div><span class="cursor-pointer">Important considerations when using extended thinking</span></h2>
<p><strong>Working with the thinking budget:</strong> The minimum budget is 1,024 tokens. We suggest starting at the minimum and increasing the thinking budget incrementally to find the optimal range for Claude to perform well for your use case. Higher token counts may allow you to achieve more comprehensive and nuanced reasoning, but there may also be diminishing returns depending on the task.</p>
<ul>
<li>The thinking budget is a target rather than a strict limit - actual token usage may vary based on the task.</li>
<li>Be prepared for potentially longer response times due to the additional processing required for the reasoning process.</li>
<li>Streaming is required when <code>max_tokens</code> is greater than 21,333.</li>
</ul>
<p><strong>For thinking budgets above 32K:</strong> We recommend using <a href="/en/docs/build-with-claude/batch-processing">batch processing</a> for workloads where the thinking budget is set above 32K to avoid networking issues. Requests pushing the model to think above 32K tokens causes long running requests that might run up against system timeouts and open connection limits.</p>
<p><strong>Thinking compatibility with other features:</strong></p>
<ul>
<li>Thinking isn’t compatible with <code>temperature</code>, <code>top_p</code>, or <code>top_k</code> modifications as well as <a href="/en/docs/build-with-claude/tool-use#forcing-tool-use">forced tool use</a>.</li>
<li>You cannot pre-fill responses when thinking is enabled.</li>
<li>Changes to the thinking budget invalidate cached prompt prefixes that include messages. However, cached system prompts and tool definitions will continue to work when thinking parameters change.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group" id="pricing-and-token-usage-for-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#pricing-and-token-usage-for-extended-thinking">​</a></div><span class="cursor-pointer">Pricing and token usage for extended thinking</span></h3>
<p>Extended thinking tokens count towards the context window and are billed as output tokens. Since thinking tokens are treated as normal output tokens, they also count towards your rate limits. Be sure to account for this increased token usage when planning your API usage.</p>
<p>For Claude 3.7 Sonnet, the pricing is:</p>
<table><thead><tr><th>Token use</th><th>Cost</th></tr></thead><tbody><tr><td>Input tokens</td><td>$3 / MTok</td></tr><tr><td>Output tokens (including thinking tokens)</td><td>$15 / MTok</td></tr><tr><td>Prompt caching write</td><td>$3.75 / MTok</td></tr><tr><td>Prompt caching read</td><td>$0.30 / MTok</td></tr></tbody></table>
<p><a href="/en/docs/build-with-claude/batch-processing">Batch processing</a> for extended thinking is available at 50% off these prices and often completes in less than 1 hour.</p>
<div class="my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10"><div class="text-sm prose min-w-0 text-sky-900 dark:text-sky-200"><p>All extended thinking tokens (including redacted thinking tokens) are billed as output tokens and count toward your rate limits.</p><p>In multi-turn conversations, thinking blocks associated with earlier assistant messages do not get billed as input tokens.</p><p>When extended thinking is enabled, a specialized 28 or 29 token system prompt is automatically included to support this feature.</p></div></div>
<div class="[&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="example-previous-thinking-tokens-omitted-as-input-tokens-for-future-turns accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Example: Previous thinking tokens omitted as input tokens for future turns</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="example-previous-thinking-tokens-omitted-as-input-tokens-for-future-turns accordion children"><p>This example demonstrates that even though the second message includes the assistant’s complete response with thinking blocks, the token counting API shows that previous thinking tokens don’t contribute to the input token count for the subsequent turn:</p><p>This behavior occurs because the Anthropic API automatically strips thinking blocks from previous turns when calculating context usage. This helps optimize token usage while maintaining the benefits of extended thinking.</p></div></div></div>
<h3 class="flex whitespace-pre-wrap group" id="extended-output-capabilities-beta"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#extended-output-capabilities-beta">​</a></div><span class="cursor-pointer">Extended output capabilities (beta)</span></h3>
<p>Claude 3.7 Sonnet can produce substantially longer responses than previous models with support for up to 128K output tokens (beta)—more than 15x longer than other Claude models. This expanded capability is particularly effective for extended thinking use cases involving complex reasoning, rich code generation, and comprehensive content creation.</p>
<p>This feature can be enabled by passing an <code>anthropic-beta</code> header of <code>output-128k-2025-02-19</code>.</p>
<!-- -->
<p>When using extended thinking with longer outputs, you can allocate a larger thinking budget to support more thorough reasoning, while still having ample tokens available for the final response.</p>
<p>We suggest using streaming or batch mode with this extended output capability; for more details see our guidance on network reliability considerations for <a href="/en/api/errors#long-requests">long requests</a>.</p>
<h2 class="flex whitespace-pre-wrap group" id="using-extended-thinking-with-prompt-caching"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#using-extended-thinking-with-prompt-caching">​</a></div><span class="cursor-pointer">Using extended thinking with prompt caching</span></h2>
<p>Prompt caching with thinking has several important considerations:</p>
<p><strong>Thinking block inclusion in cached prompts</strong></p>
<ul>
<li>Thinking is only included when generating an assistant turn and not meant to be cached.</li>
<li>Previous turn thinking blocks are ignored.</li>
<li>If thinking becomes disabled, any thinking content passed to the API is simply ignored.</li>
</ul>
<p><strong>Cache invalidation rules</strong></p>
<ul>
<li>Alterations to thinking parameters (enabling/disabling or budget changes) invalidate cache breakpoints set in messages.</li>
<li>System prompts and tools maintain caching even when thinking parameters change.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group" id="examples-of-prompt-caching-with-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#examples-of-prompt-caching-with-extended-thinking">​</a></div><span class="cursor-pointer">Examples of prompt caching with extended thinking</span></h3>
<div class="[&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="system-prompt-caching-preserved-when-thinking-changes accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">System prompt caching (preserved when thinking changes)</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="system-prompt-caching-preserved-when-thinking-changes accordion children"><p>Here is the output of the script (you may see slightly different numbers)</p><div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">First request - establishing cache</span>
<span class="">First response usage: { cache_creation_input_tokens: 1365, cache_read_input_tokens: 0, input_tokens: 44, output_tokens: 725 }</span>
<!-- -->
<span class="">Second request - same thinking parameters (cache hit expected)</span>
<span class="">Second response usage: { cache_creation_input_tokens: 0, cache_read_input_tokens: 1365, input_tokens: 386, output_tokens: 765 }</span>
<!-- -->
<span class="">Third request - different thinking budget (cache hit expected)</span>
<span class="">Third response usage: { cache_creation_input_tokens: 0, cache_read_input_tokens: 1365, input_tokens: 811, output_tokens: 542 }</span>
</code></pre></div></div></div><p>This example demonstrates that when caching is set up in the system prompt, changing the thinking parameters (budget_tokens increased from 4000 to 8000) <strong>does not invalidate the cache</strong>. The third request still shows a cache hit with <code>cache_read_input_tokens=1365</code>, proving that system prompt caching is preserved even when thinking parameters change.</p></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="messages-caching-invalidated-when-thinking-changes accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Messages caching (invalidated when thinking changes)</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="messages-caching-invalidated-when-thinking-changes accordion children"><p>Here is the output of the script (you may see slightly different numbers)</p><div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">First request - establishing cache</span>
<span class="">First response usage: { cache_creation_input_tokens: 1370, cache_read_input_tokens: 0, input_tokens: 17, output_tokens: 700 }</span>
<!-- -->
<span class="">Second request - same thinking parameters (cache hit expected)</span>
<!-- -->
<span class="">Second response usage: { cache_creation_input_tokens: 0, cache_read_input_tokens: 1370, input_tokens: 303, output_tokens: 874 }</span>
<!-- -->
<span class="">Third request - different thinking budget (cache miss expected)</span>
<span class="">Third response usage: { cache_creation_input_tokens: 1370, cache_read_input_tokens: 0, input_tokens: 747, output_tokens: 619 }</span>
</code></pre></div></div></div><p>This example demonstrates that when caching is set up in the messages array, changing the thinking parameters (budget_tokens increased from 4000 to 8000) <strong>invalidates the cache</strong>. The third request shows no cache hit with <code>cache_creation_input_tokens=1370</code> and <code>cache_read_input_tokens=0</code>, proving that message-based caching is invalidated when thinking parameters change.</p></div></div></div>
<h2 class="flex whitespace-pre-wrap group" id="max-tokens-and-context-window-size-with-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#max-tokens-and-context-window-size-with-extended-thinking">​</a></div><span class="cursor-pointer">Max tokens and context window size with extended thinking</span></h2>
<p>In older Claude models (prior to Claude 3.7 Sonnet), if the sum of prompt tokens and <code>max_tokens</code> exceeded the model’s context window, the system would automatically adjust <code>max_tokens</code> to fit within the context limit. This meant you could set a large <code>max_tokens</code> value and the system would silently reduce it as needed.</p>
<p>With Claude 3.7 Sonnet, <code>max_tokens</code> (which includes your thinking budget when thinking is enabled) is enforced as a strict limit. The system will now return a validation error if prompt tokens + <code>max_tokens</code> exceeds the context window size.</p>
<h3 class="flex whitespace-pre-wrap group" id="how-context-window-is-calculated-with-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#how-context-window-is-calculated-with-extended-thinking">​</a></div><span class="cursor-pointer">How context window is calculated with extended thinking</span></h3>
<p>When calculating context window usage with thinking enabled, there are some considerations to be aware of:</p>
<ul>
<li>Thinking blocks from previous turns are stripped and not counted towards your context window</li>
<li>Current turn thinking counts towards your <code>max_tokens</code> limit for that turn</li>
</ul>
<p>The diagram below demonstrates the specialized token management when extended thinking is enabled:</p>

<p>The effective context window is calculated as:</p>
<div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">context window =</span>
<span class="">  (current input tokens - previous thinking tokens) +</span>
<span class="">  (thinking tokens + redacted thinking tokens + text output tokens)</span>
</code></pre></div></div></div>
<p>We recommend using the <a href="/en/docs/build-with-claude/token-counting">token counting API</a> to get accurate token counts for your specific use case, especially when working with multi-turn conversations that include thinking.</p>
<div class="my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10"><div class="text-sm prose min-w-0 text-sky-900 dark:text-sky-200"><p>You can read through our <a href="/en/docs/context-windows">guide on context windows</a> for a more thorough deep dive.</p></div></div>
<h3 class="flex whitespace-pre-wrap group" id="managing-tokens-with-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#managing-tokens-with-extended-thinking">​</a></div><span class="cursor-pointer">Managing tokens with extended thinking</span></h3>
<p>Given new context window and <code>max_tokens</code> behavior with extended thinking models like Claude 3.7 Sonnet, you may need to:</p>
<ul>
<li>More actively monitor and manage your token usage</li>
<li>Adjust <code>max_tokens</code> values as your prompt length changes</li>
<li>Potentially use the <a href="/en/docs/build-with-claude/token-counting">token counting endpoints</a> more frequently</li>
<li>Be aware that previous thinking blocks don’t accumulate in your context window</li>
</ul>
<p>This change has been made to provide more predictable and transparent behavior, especially as maximum token limits have increased significantly.</p>
<h2 class="flex whitespace-pre-wrap group" id="extended-thinking-with-tool-use"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#extended-thinking-with-tool-use">​</a></div><span class="cursor-pointer">Extended thinking with tool use</span></h2>
<p>When using extended thinking with tool use, be aware of the following behavior pattern:</p>
<ol>
<li>
<p><strong>First assistant turn</strong>: When you send an initial user message, the assistant response will include thinking blocks followed by tool use requests.</p>
</li>
<li>
<p><strong>Tool result turn</strong>: When you pass the user message with tool result blocks, <strong>the subsequent assistant message will not contain any additional thinking blocks.</strong></p>
</li>
</ol>
<p>To expand here, the normal order of a tool use conversation with thinking follows these steps:</p>
<ol>
<li>User sends initial message</li>
<li>Assistant responds with thinking blocks and tool requests</li>
<li>User sends message with tool results</li>
<li>Assistant responds with either more tool calls or just text (no thinking blocks in this response)</li>
<li>If more tools are requested, repeat steps 3-4 until the conversation is complete</li>
</ol>
<p>This design allows Claude to show its reasoning process before making tool requests, but not repeat the thinking process after receiving tool results. Claude will not output another thinking block until after the next non-<code>tool_result</code> <code>user</code> turn.</p>
<p>The diagram below illustrates the context window token management when combining extended thinking with tool use:</p>

<div class="[&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="example-passing-thinking-blocks-with-tool-results accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Example: Passing thinking blocks with tool results</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="example-passing-thinking-blocks-with-tool-results accordion children"><p>Here’s a practical example showing how to preserve thinking blocks when providing tool results:</p><p>The API response will include thinking, text, and tool_use blocks:</p><div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json"><code class="language-json"><span class=""><span class="token punctuation">{</span></span>
<span class="">    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">"The user wants to know the current weather in Paris. I have access to a function `get_weather`..."</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"signature"</span><span class="token operator">:</span> <span class="token string">"BDaL4VrbR2Oj0hO4XpJxT28J5TILnCrrUXoKiiNBZW9P+nr8XSj1zuZzAl4egiCCpQNvfyUuFFJP5CncdYZEQPPmLxYsNrcs...."</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"I can help you get the current weather information for Paris. Let me check that for you"</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"tool_use"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"toolu_01CswdEQBMshySk6Y9DFKrfq"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"get_weather"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"input"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="">                <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"Paris"</span></span>
<span class="">            <span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div><p>Now let’s continue the conversation and use the tool</p><p>The API response will now <strong>only</strong> include text</p><div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json"><code class="language-json"><span class=""><span class="token punctuation">{</span></span>
<span class="">    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Currently in Paris, the temperature is 88°F (31°C)"</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div></div></div></div>
<h3 class="flex whitespace-pre-wrap group" id="preserving-thinking-blocks"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#preserving-thinking-blocks">​</a></div><span class="cursor-pointer">Preserving thinking blocks</span></h3>
<p>During tool use, you must pass <code>thinking</code> and <code>redacted_thinking</code> blocks back to the API, and you must include the complete unmodified block back to the API.  This is critical for maintaining the model’s reasoning flow and conversation integrity.</p>
<div class="my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-emerald-500/20 bg-emerald-50/50 dark:border-emerald-500/30 dark:bg-emerald-500/10"><div class="text-sm prose min-w-0 text-emerald-900 dark:text-emerald-200"><p>While you can omit <code>thinking</code> and <code>redacted_thinking</code> blocks from prior <code>assistant</code> role turns, we suggest always passing back all thinking blocks to the API for any multi-turn conversation. The API will:</p><ul>
<li>Automatically filter the provided thinking blocks</li>
<li>Use the relevant thinking blocks necessary to preserve the model’s reasoning</li>
<li>Only bill for the input tokens for the blocks shown to Claude</li>
</ul></div></div>
<h4 class="flex whitespace-pre-wrap group" id="why-thinking-blocks-must-be-preserved"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#why-thinking-blocks-must-be-preserved">​</a></div><span class="cursor-pointer">Why thinking blocks must be preserved</span></h4>
<p>When Claude invokes tools, it is pausing its construction of a response to await external information. When tool results are returned, Claude will continue building that existing response. This necessitates preserving thinking blocks during tool use, for a couple of reasons:</p>
<ol>
<li>
<p><strong>Reasoning continuity</strong>: The thinking blocks capture Claude’s step-by-step reasoning that led to tool requests. When you post tool results, including the original thinking ensures Claude can continue its reasoning from where it left off.</p>
</li>
<li>
<p><strong>Context maintenance</strong>: While tool results appear as user messages in the API structure, they’re part of a continuous reasoning flow. Preserving thinking blocks maintains this conceptual flow across multiple API calls.</p>
</li>
</ol>
<p><strong>Important</strong>: When providing <code>thinking</code> or <code>redacted_thinking</code> blocks, the entire sequence of consecutive <code>thinking</code> or <code>redacted_thinking</code> blocks must match the outputs generated by the model during the original request; you cannot rearrange or modify the sequence of these blocks.</p>
<h2 class="flex whitespace-pre-wrap group" id="tips-for-making-the-best-use-of-extended-thinking-mode"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#tips-for-making-the-best-use-of-extended-thinking-mode">​</a></div><span class="cursor-pointer">Tips for making the best use of extended thinking mode</span></h2>
<p>To get the most out of extended thinking:</p>
<ol>
<li>
<p><strong>Set appropriate budgets</strong>: Start with larger thinking budgets (16,000+ tokens) for complex tasks and adjust based on your needs.</p>
</li>
<li>
<p><strong>Experiment with thinking token budgets</strong>: The model might perform differently at different max thinking budget settings. Increasing max thinking budget can make the model think better/harder, at the tradeoff of increased latency. For critical tasks, consider testing different budget settings to find the optimal balance between quality and performance.</p>
</li>
<li>
<p><strong>You do not need to remove previous thinking blocks yourself</strong>: The Anthropic API automatically ignores thinking blocks from previous turns and they are not included when calculating context usage.</p>
</li>
<li>
<p><strong>Monitor token usage</strong>: Keep track of thinking token usage to optimize costs and performance.</p>
</li>
<li>
<p><strong>Use extended thinking for particularly complex tasks</strong>: Enable thinking for tasks that benefit from step-by-step reasoning like math, coding, and analysis.</p>
</li>
<li>
<p><strong>Account for extended response time</strong>: Factor in that generating thinking blocks may increase overall response time.</p>
</li>
<li>
<p><strong>Handle streaming appropriately</strong>: When streaming, be prepared to handle both thinking and text content blocks as they arrive.</p>
</li>
<li>
<p><strong>Prompt engineering</strong>: Review our <a href="/en/docs/build-with-claude/prompt-engineering/extended-thinking-tips">extended thinking prompting tips</a> if you want to maximize Claude’s thinking capabilities.</p>
</li>
</ol>
<h2 class="flex whitespace-pre-wrap group" id="next-steps"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#next-steps">​</a></div><span class="cursor-pointer">Next steps</span></h2>
<div class="not-prose grid gap-x-4 sm:grid-cols-2"><a class="card block not-prose font-normal group relative my-2 ring-2 ring-transparent rounded-2xl bg-white dark:bg-background-dark border border-gray-950/10 dark:border-white/10 overflow-hidden w-full cursor-pointer hover:!border-primary dark:hover:!border-primary-light" href="https://github.com/anthropics/anthropic-cookbook/tree/main/extended_thinking" rel="noreferrer" target="_blank"><div class="px-6 py-5"><div><h2 class="font-semibold text-base text-gray-800 dark:text-white mt-4">Try the extended thinking cookbook</h2><div class="mt-1 font-normal text-sm leading-6 text-gray-600 dark:text-gray-400"><p>Explore practical examples of thinking in our cookbook.</p></div></div></div></a><a class="card block not-prose font-normal group relative my-2 ring-2 ring-transparent rounded-2xl bg-white dark:bg-background-dark border border-gray-950/10 dark:border-white/10 overflow-hidden w-full cursor-pointer hover:!border-primary dark:hover:!border-primary-light" href="/en/docs/build-with-claude/prompt-engineering/extended-thinking-tips"><div class="px-6 py-5"><div><h2 class="font-semibold text-base text-gray-800 dark:text-white mt-4">Extended thinking prompting tips</h2><div class="mt-1 font-normal text-sm leading-6 text-gray-600 dark:text-gray-400"><p>Learn prompt engineering best practices for extended thinking.</p></div></div></div></a></div></div><div class="leading-6 mt-14"><div class="pb-16 w-full"><div class="flex flex-col gap-y-4 xl:flex-col xl:gap-6 min-[1400px]:flex-row md:flex-row md:justify-end"><div class="flex flex-row gap-5 items-center grow justify-between md:justify-start xl:justify-between min-[1400px]:justify-start"><p class="text-sm text-gray-600 dark:text-gray-400">Was this page helpful?</p><div class="flex flex-row gap-3 items-center"><button class="px-3.5 py-2 flex flex-row gap-3 items-center border-standard rounded-xl text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 bg-white/50 dark:bg-codeblock/50 hover:border-gray-400 hover:dark:border-gray-500"><small class="text-sm font-normal leading-4">Yes</small></button><button class="px-3.5 py-2 flex flex-row gap-3 items-center border-standard rounded-xl text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 bg-white/50 dark:bg-codeblock/50 hover:border-gray-400 hover:dark:border-gray-500"><small class="text-sm font-normal leading-4">No</small></button></div></div></div></div><div class="mb-12 px-0.5 flex items-center text-sm font-semibold text-gray-700 dark:text-gray-200"><a class="flex items-center space-x-3 group" href="/en/docs/build-with-claude/prompt-engineering/extended-thinking-tips"><span class="group-hover:text-gray-900 dark:group-hover:text-white">Extended thinking tips</span></a><a class="flex items-center ml-auto space-x-3 group" href="/en/docs/build-with-claude/multilingual-support"><span class="group-hover:text-gray-900 dark:group-hover:text-white">Multilingual support</span></a></div></div></div><div class="z-10 hidden xl:flex pl-10 box-border w-[19rem]" id="table-of-contents"><div class="fixed text-gray-600 text-sm leading-6 w-[16.5rem] overflow-y-auto space-y-2 h-[calc(100%-10rem)]" id="table-of-contents-content"><div class="text-gray-700 dark:text-gray-300 font-medium flex items-center space-x-2"><span>On this page</span></div><ul><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#how-extended-thinking-works">How extended thinking works</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#implementing-extended-thinking">Implementing extended thinking</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#understanding-thinking-blocks">Understanding thinking blocks</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#suggestions-for-handling-redacted-thinking-in-production">Suggestions for handling redacted thinking in production</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#streaming-extended-thinking">Streaming extended thinking</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#important-considerations-when-using-extended-thinking">Important considerations when using extended thinking</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#pricing-and-token-usage-for-extended-thinking">Pricing and token usage for extended thinking</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#extended-output-capabilities-beta">Extended output capabilities (beta)</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#using-extended-thinking-with-prompt-caching">Using extended thinking with prompt caching</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#examples-of-prompt-caching-with-extended-thinking">Examples of prompt caching with extended thinking</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#max-tokens-and-context-window-size-with-extended-thinking">Max tokens and context window size with extended thinking</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#how-context-window-is-calculated-with-extended-thinking">How context window is calculated with extended thinking</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#managing-tokens-with-extended-thinking">Managing tokens with extended thinking</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#extended-thinking-with-tool-use">Extended thinking with tool use</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#preserving-thinking-blocks">Preserving thinking blocks</a></li><li style="margin-left:2rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#why-thinking-blocks-must-be-preserved">Why thinking blocks must be preserved</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#tips-for-making-the-best-use-of-extended-thinking-mode">Tips for making the best use of extended thinking mode</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#next-steps">Next steps</a></li></ul></div></div></div></div></div></div></main></div></html>