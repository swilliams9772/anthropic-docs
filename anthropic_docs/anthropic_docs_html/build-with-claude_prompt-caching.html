<main class="jsx-4145347147"><div class="relative antialiased text-gray-500 dark:text-gray-400"><div class="max-w-8xl px-4 mx-auto lg:px-8"><div class="z-20 hidden lg:block fixed bottom-0 right-auto w-[18rem]" id="sidebar" style="top:7rem"><div class="absolute inset-0 z-10 stable-scrollbar-gutter overflow-auto pr-8 pb-10" id="sidebar-content"><div class="relative lg:text-sm lg:leading-6"><div id="navigation-items"><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-semibold text-primary dark:text-primary-light" href="/en/home">Documentation</a></li><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://console.anthropic.com/" rel="noreferrer" target="_blank">Developer Console</a></li><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://www.anthropic.com/discord" rel="noreferrer" target="_blank">Developer Discord</a></li><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://support.anthropic.com/" rel="noreferrer" target="_blank">Support</a></li><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">First steps</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/welcome"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/welcome" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Intro to Claude</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/get-started"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/get-started" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Get started</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Models &amp; pricing</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/models/overview"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/models/overview" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Models overview</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/models/choosing-a-model"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/models/choosing-a-model" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Choosing a model</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/models/migrating-to-claude-4"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/models/migrating-to-claude-4" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Migrating to Claude 4</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/model-deprecations"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/model-deprecations" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Model deprecations</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/pricing"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/pricing" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Pricing</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Learn about Claude</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/overview"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/overview" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Building with Claude</div></div></a></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div class="">Use cases</div></div></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/context-windows"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/context-windows" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Context windows</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/glossary"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/glossary" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Glossary</div></div></a></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div class="">Prompt engineering</div></div></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Explore features</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/overview"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/overview" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Features overview</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/prompt-caching"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl bg-primary/10 text-primary font-semibold dark:text-primary-light dark:bg-primary-light/10" href="/en/docs/build-with-claude/prompt-caching" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Prompt caching</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/extended-thinking"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/extended-thinking" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Extended thinking</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/streaming"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/streaming" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Streaming Messages</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/batch-processing"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/batch-processing" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Batch processing</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/citations"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/citations" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Citations</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/multilingual-support"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/multilingual-support" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Multilingual support</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/token-counting"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/token-counting" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Token counting</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/embeddings"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/embeddings" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Embeddings</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/vision"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/vision" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Vision</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/pdf-support"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/pdf-support" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>PDF support</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Agent components</h5><ul id="sidebar-group"><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div class="">Tools</div></div></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div class="">Model Context Protocol (MCP)</div></div></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/agents-and-tools/computer-use"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/agents-and-tools/computer-use" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Computer use (beta)</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/agents-and-tools/claude-for-sheets"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/agents-and-tools/claude-for-sheets" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Google Sheets add-on</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Test &amp; evaluate</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/test-and-evaluate/define-success"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/test-and-evaluate/define-success" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Define success criteria</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/test-and-evaluate/develop-tests"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/test-and-evaluate/develop-tests" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Develop test cases</div></div></a></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div class="">Strengthen guardrails</div></div></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/test-and-evaluate/eval-tool"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/test-and-evaluate/eval-tool" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Using the Evaluation Tool</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Legal center</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="https://www.anthropic.com/legal/privacy"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://www.anthropic.com/legal/privacy" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Anthropic Privacy Policy</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="https://trust.anthropic.com/"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://trust.anthropic.com/" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Security and compliance</div></div></a></li></ul></div></div></div></div></div><div class="" id="content-container"><div class="flex flex-row gap-12 box-border w-full pt-40 lg:pt-10"><div class="relative grow box-border flex-col w-full mx-auto px-1 lg:pl-[23.7rem] lg:-ml-12 xl:w-[calc(100%-28rem)]" id="content-area"><div class="mdx-content relative mt-8 prose prose-gray dark:prose-invert"><p>Prompt caching is a powerful feature that optimizes your API usage by allowing resuming from specific prefixes in your prompts. This approach significantly reduces processing time and costs for repetitive tasks or prompts with consistent elements.</p>
<p>Here’s an example of how to implement prompt caching with the Messages API using a <code>cache_control</code> block:</p>
<div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:R1b0ampkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R2b0ampkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R3b0ampkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R4b0ampkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:Rd0ampkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-bash language-bash"><code class="language-bash"><span class=""><span class="token function">curl</span> https://api.anthropic.com/v1/messages <span class="token punctuation">\</span></span>
<span class="">  <span class="token parameter variable">-H</span> <span class="token string">"content-type: application/json"</span> <span class="token punctuation">\</span></span>
<span class="">  <span class="token parameter variable">-H</span> <span class="token string">"x-api-key: <span class="token variable">$ANTHROPIC_API_KEY</span>"</span> <span class="token punctuation">\</span></span>
<span class="">  <span class="token parameter variable">-H</span> <span class="token string">"anthropic-version: 2023-06-01"</span> <span class="token punctuation">\</span></span>
<span class="">  <span class="token parameter variable">-d</span> '<span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"model"</span><span class="token builtin class-name">:</span> <span class="token string">"claude-opus-4-20250514"</span>,</span>
<span class="">    <span class="token string">"max_tokens"</span><span class="token builtin class-name">:</span> <span class="token number">1024</span>,</span>
<span class="">    <span class="token string">"system"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">      <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,</span>
<span class="">        <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"You are an AI assistant tasked with analyzing literary works. Your goal is to provide insightful commentary on themes, characters, and writing style.<span class="token entity" title="\n">\n</span>"</span></span>
<span class="">      <span class="token punctuation">}</span>,</span>
<span class="">      <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,</span>
<span class="">        <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"&lt;the entire contents of Pride and Prejudice&gt;"</span>,</span>
<span class="">        <span class="token string">"cache_control"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"ephemeral"</span><span class="token punctuation">}</span></span>
<span class="">      <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span>,</span>
<span class="">    <span class="token string">"messages"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">      <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"role"</span><span class="token builtin class-name">:</span> <span class="token string">"user"</span>,</span>
<span class="">        <span class="token string">"content"</span><span class="token builtin class-name">:</span> <span class="token string">"Analyze the major themes in Pride and Prejudice."</span></span>
<span class="">      <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class="">  <span class="token punctuation">}</span>'</span>
<!-- -->
<span class=""><span class="token comment"># Call the model again with the same inputs up to the cache checkpoint</span></span>
<span class=""><span class="token function">curl</span> https://api.anthropic.com/v1/messages <span class="token comment"># rest of input</span></span>
</code></pre></div></div></div></div>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="flex rounded-t-2xl text-gray-400 text-xs leading-6 border-b font-medium bg-black/40 border-gray-900/80" data-component-part="code-block-tab-bar"><div class="flex-none border-b px-4 pt-2.5 pb-2 flex items-center text-primary-light border-primary-light" data-component-part="code-block-tab-bar-filename">JSON</div></div><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json language-json"><code class="language-JSON"><span class=""><span class="token punctuation">{</span><span class="token property">"cache_creation_input_tokens"</span><span class="token operator">:</span><span class="token number">188086</span><span class="token punctuation">,</span><span class="token property">"cache_read_input_tokens"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"input_tokens"</span><span class="token operator">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token property">"output_tokens"</span><span class="token operator">:</span><span class="token number">393</span><span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">{</span><span class="token property">"cache_creation_input_tokens"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token property">"cache_read_input_tokens"</span><span class="token operator">:</span><span class="token number">188086</span><span class="token punctuation">,</span><span class="token property">"input_tokens"</span><span class="token operator">:</span><span class="token number">21</span><span class="token punctuation">,</span><span class="token property">"output_tokens"</span><span class="token operator">:</span><span class="token number">393</span><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<p>In this example, the entire text of “Pride and Prejudice” is cached using the <code>cache_control</code> parameter. This enables reuse of this large text across multiple API calls without reprocessing it each time. Changing only the user message allows you to ask various questions about the book while utilizing the cached content, leading to faster responses and improved efficiency.</p>

<h2 class="flex whitespace-pre-wrap group font-semibold" id="how-prompt-caching-works"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#how-prompt-caching-works">​</a></div><span class="cursor-pointer">How prompt caching works</span></h2>
<p>When you send a request with prompt caching enabled:</p>
<ol>
<li>The system checks if a prompt prefix, up to a specified cache breakpoint, is already cached from a recent query.</li>
<li>If found, it uses the cached version, reducing processing time and costs.</li>
<li>Otherwise, it processes the full prompt and caches the prefix once the response begins.</li>
</ol>
<p>This is especially useful for:</p>
<ul>
<li>Prompts with many examples</li>
<li>Large amounts of context or background information</li>
<li>Repetitive tasks with consistent instructions</li>
<li>Long multi-turn conversations</li>
</ul>
<p>By default, the cache has a 5-minute lifetime. The cache is refreshed for no additional cost each time the cached content is used.</p>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-emerald-500/20 bg-emerald-50/50 dark:border-emerald-500/30 dark:bg-emerald-500/10" data-callout-type="tip"><div class="text-sm prose min-w-0 w-full text-emerald-900 dark:text-emerald-200" data-component-part="callout-content"><p><strong>Prompt caching caches the full prefix</strong></p><p>Prompt caching references the entire prompt - <code>tools</code>, <code>system</code>, and <code>messages</code> (in that order) up to and including the block designated with <code>cache_control</code>.</p></div></div>

<h2 class="flex whitespace-pre-wrap group font-semibold" id="pricing"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#pricing">​</a></div><span class="cursor-pointer">Pricing</span></h2>
<p>Prompt caching introduces a new pricing structure. The table below shows the price per million tokens for each supported model:</p>
<table><thead><tr><th>Model</th><th>Base Input Tokens</th><th>5m Cache Writes</th><th>1h Cache Writes</th><th>Cache Hits &amp; Refreshes</th><th>Output Tokens</th></tr></thead><tbody><tr><td>Claude Opus 4</td><td>$15 / MTok</td><td>$18.75 / MTok</td><td>$30 / MTok</td><td>$1.50 / MTok</td><td>$75 / MTok</td></tr><tr><td>Claude Sonnet 4</td><td>$3 / MTok</td><td>$3.75 / MTok</td><td>$6 / MTok</td><td>$0.30 / MTok</td><td>$15 / MTok</td></tr><tr><td>Claude Sonnet 3.7</td><td>$3 / MTok</td><td>$3.75 / MTok</td><td>$6 / MTok</td><td>$0.30 / MTok</td><td>$15 / MTok</td></tr><tr><td>Claude Sonnet 3.5</td><td>$3 / MTok</td><td>$3.75 / MTok</td><td>$6 / MTok</td><td>$0.30 / MTok</td><td>$15 / MTok</td></tr><tr><td>Claude Haiku 3.5</td><td>$0.80 / MTok</td><td>$1 / MTok</td><td>$1.6 / MTok</td><td>$0.08 / MTok</td><td>$4 / MTok</td></tr><tr><td>Claude Opus 3</td><td>$15 / MTok</td><td>$18.75 / MTok</td><td>$30 / MTok</td><td>$1.50 / MTok</td><td>$75 / MTok</td></tr><tr><td>Claude Haiku 3</td><td>$0.25 / MTok</td><td>$0.30 / MTok</td><td>$0.50 / MTok</td><td>$0.03 / MTok</td><td>$1.25 / MTok</td></tr></tbody></table>
<p>Note:</p>
<ul>
<li>5-minute cache write tokens are 1.25 times the base input tokens price</li>
<li>1-hour cache write tokens are 2 times the base input tokens price</li>
<li>Cache read tokens are 0.1 times the base input tokens price</li>
<li>Regular input and output tokens are priced at standard rates</li>
</ul>

<h2 class="flex whitespace-pre-wrap group font-semibold" id="how-to-implement-prompt-caching"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#how-to-implement-prompt-caching">​</a></div><span class="cursor-pointer">How to implement prompt caching</span></h2>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="supported-models"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#supported-models">​</a></div><span class="cursor-pointer">Supported models</span></h3>
<p>Prompt caching is currently supported on:</p>
<ul>
<li>Claude Opus 4</li>
<li>Claude Sonnet 4</li>
<li>Claude Sonnet 3.7</li>
<li>Claude Sonnet 3.5</li>
<li>Claude Haiku 3.5</li>
<li>Claude Haiku 3</li>
<li>Claude Opus 3</li>
</ul>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="structuring-your-prompt"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#structuring-your-prompt">​</a></div><span class="cursor-pointer">Structuring your prompt</span></h3>
<p>Place static content (tool definitions, system instructions, context, examples) at the beginning of your prompt. Mark the end of the reusable content for caching using the <code>cache_control</code> parameter.</p>
<p>Cache prefixes are created in the following order: <code>tools</code>, <code>system</code>, then <code>messages</code>.</p>
<p>Using the <code>cache_control</code> parameter, you can define up to 4 cache breakpoints, allowing you to cache different reusable sections separately. For each breakpoint, the system will automatically check for cache hits at previous positions and use the longest matching prefix if one is found.</p>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="cache-limitations"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#cache-limitations">​</a></div><span class="cursor-pointer">Cache limitations</span></h3>
<p>The minimum cacheable prompt length is:</p>
<ul>
<li>1024 tokens for Claude Opus 4, Claude Sonnet 4, Claude Sonnet 3.7, Claude Sonnet 3.5 and Claude Opus 3</li>
<li>2048 tokens for Claude Haiku 3.5 and Claude Haiku 3</li>
</ul>
<p>Shorter prompts cannot be cached, even if marked with <code>cache_control</code>. Any requests to cache fewer than this number of tokens will be processed without caching. To see if a prompt was cached, see the response usage <a class="link" href="https://docs.anthropic.com/en/docs/build-with-claude/prompt-caching#tracking-cache-performance" rel="noreferrer" target="_blank">fields</a>.</p>
<p>For concurrent requests, note that a cache entry only becomes available after the first response begins. If you need cache hits for parallel requests, wait for the first response before sending subsequent requests.</p>
<p>Currently, “ephemeral” is the only supported cache type, which by default has a 5-minute lifetime.</p>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="what-can-be-cached"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#what-can-be-cached">​</a></div><span class="cursor-pointer">What can be cached</span></h3>
<p>Most blocks in the request can be designated for caching with <code>cache_control</code>. This includes:</p>
<ul>
<li>Tools: Tool definitions in the <code>tools</code> array</li>
<li>System messages: Content blocks in the <code>system</code> array</li>
<li>Text messages: Content blocks in the <code>messages.content</code> array, for both user and assistant turns</li>
<li>Images &amp; Documents: Content blocks in the <code>messages.content</code> array, in user turns</li>
<li>Tool use and tool results: Content blocks in the <code>messages.content</code> array, in both user and assistant turns</li>
</ul>
<p>Each of these elements can be marked with <code>cache_control</code> to enable caching for that portion of the request.</p>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="what-cannot-be-cached"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#what-cannot-be-cached">​</a></div><span class="cursor-pointer">What cannot be cached</span></h3>
<p>While most request blocks can be cached, there are some exceptions:</p>
<ul>
<li>
<p>Thinking blocks cannot be cached directly with <code>cache_control</code>. However, thinking blocks CAN be cached alongside other content when they appear in previous assistant turns. When cached this way, they DO count as input tokens when read from cache.</p>
</li>
<li>
<p>Sub-content blocks (like <a class="link" href="/en/docs/build-with-claude/citations">citations</a>) themselves cannot be cached directly. Instead, cache the top-level block.</p>
<p>In the case of citations, the top-level document content blocks that serve as the source material for citations can be cached. This allows you to use prompt caching with citations effectively by caching the documents that citations will reference.</p>
</li>
<li>
<p>Empty text blocks cannot be cached.</p>
</li>
</ul>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="tracking-cache-performance"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#tracking-cache-performance">​</a></div><span class="cursor-pointer">Tracking cache performance</span></h3>
<p>Monitor cache performance using these API response fields, within <code>usage</code> in the response (or <code>message_start</code> event if <a class="link" href="https://docs.anthropic.com/en/api/messages-streaming" rel="noreferrer" target="_blank">streaming</a>):</p>
<ul>
<li><code>cache_creation_input_tokens</code>: Number of tokens written to the cache when creating a new entry.</li>
<li><code>cache_read_input_tokens</code>: Number of tokens retrieved from the cache for this request.</li>
<li><code>input_tokens</code>: Number of input tokens which were not read from or used to create a cache.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="best-practices-for-effective-caching"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#best-practices-for-effective-caching">​</a></div><span class="cursor-pointer">Best practices for effective caching</span></h3>
<p>To optimize prompt caching performance:</p>
<ul>
<li>Cache stable, reusable content like system instructions, background information, large contexts, or frequent tool definitions.</li>
<li>Place cached content at the prompt’s beginning for best performance.</li>
<li>Use cache breakpoints strategically to separate different cacheable prefix sections.</li>
<li>Regularly analyze cache hit rates and adjust your strategy as needed.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="optimizing-for-different-use-cases"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#optimizing-for-different-use-cases">​</a></div><span class="cursor-pointer">Optimizing for different use cases</span></h3>
<p>Tailor your prompt caching strategy to your scenario:</p>
<ul>
<li>Conversational agents: Reduce cost and latency for extended conversations, especially those with long instructions or uploaded documents.</li>
<li>Coding assistants: Improve autocomplete and codebase Q&amp;A by keeping relevant sections or a summarized version of the codebase in the prompt.</li>
<li>Large document processing: Incorporate complete long-form material including images in your prompt without increasing response latency.</li>
<li>Detailed instruction sets: Share extensive lists of instructions, procedures, and examples to fine-tune Claude’s responses.  Developers often include an example or two in the prompt, but with prompt caching you can get even better performance by including 20+ diverse examples of high quality answers.</li>
<li>Agentic tool use: Enhance performance for scenarios involving multiple tool calls and iterative code changes, where each step typically requires a new API call.</li>
<li>Talk to books, papers, documentation, podcast transcripts, and other longform content:  Bring any knowledge base alive by embedding the entire document(s) into the prompt, and letting users ask it questions.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="troubleshooting-common-issues"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#troubleshooting-common-issues">​</a></div><span class="cursor-pointer">Troubleshooting common issues</span></h3>
<p>If experiencing unexpected behavior:</p>
<ul>
<li>Ensure cached sections are identical and marked with cache_control in the same locations across calls</li>
<li>Check that calls are made within the cache lifetime (5 minutes by default)</li>
<li>Verify that <code>tool_choice</code> and image usage remain consistent between calls</li>
<li>Validate that you are caching at least the minimum number of tokens</li>
<li>While the system will attempt to use previously cached content at positions prior to a cache breakpoint, you may use an additional <code>cache_control</code> parameter to guarantee cache lookup on previous portions of the prompt, which may be useful for queries with very long lists of content blocks</li>
</ul>
<p>Note that changes to <code>tool_choice</code> or the presence/absence of images anywhere in the prompt will invalidate the cache, requiring a new cache entry to be created.</p>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="caching-with-thinking-blocks"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#caching-with-thinking-blocks">​</a></div><span class="cursor-pointer">Caching with thinking blocks</span></h3>
<p>When using <a class="link" href="/en/docs/build-with-claude/extended-thinking">extended thinking</a> with prompt caching, thinking blocks have special behavior:</p>
<p><strong>Automatic caching alongside other content</strong>: While thinking blocks cannot be explicitly marked with <code>cache_control</code>, they get cached as part of the request content when you make subsequent API calls with tool results. This commonly happens during tool use when you pass thinking blocks back to continue the conversation.</p>
<p><strong>Input token counting</strong>: When thinking blocks are read from cache, they count as input tokens in your usage metrics. This is important for cost calculation and token budgeting.</p>
<p><strong>Cache invalidation patterns</strong>:</p>
<ul>
<li>Cache remains valid when only tool results are provided as user messages</li>
<li>Cache gets invalidated when non-tool-result user content is added, causing all previous thinking blocks to be stripped</li>
<li>This caching behavior occurs even without explicit <code>cache_control</code> markers</li>
</ul>
<p><strong>Example with tool use</strong>:</p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">Request 1: User: "What's the weather in Paris?"</span>
<span class="">Response: [thinking_block_1] + [tool_use block 1]</span>
<!-- -->
<span class="">Request 2: </span>
<span class="">User: ["What's the weather in Paris?"], </span>
<span class="">Assistant: [thinking_block_1] + [tool_use block 1], </span>
<span class="">User: [tool_result_1, cache=True]</span>
<span class="">Response: [thinking_block_2] + [text block 2]</span>
<span class=""># Request 2 caches its request content (not the response)</span>
<span class=""># The cache includes: user message, thinking_block_1, tool_use block 1, and tool_result_1</span>
<!-- -->
<span class="">Request 3:</span>
<span class="">User: ["What's the weather in Paris?"], </span>
<span class="">Assistant: [thinking_block_1] + [tool_use block 1], </span>
<span class="">User: [tool_result_1, cache=True], </span>
<span class="">Assistant: [thinking_block_2] + [text block 2], </span>
<span class="">User: [Text response, cache=True]</span>
<span class=""># Non-tool-result user block causes all thinking blocks to be ignored</span>
<span class=""># This request is processed as if thinking blocks were never present</span>
</code></pre></div></div></div>
<p>When a non-tool-result user block is included, it designates a new assistant loop and all previous thinking blocks are removed from context.</p>
<p>For more detailed information, see the <a class="link" href="/en/docs/build-with-claude/extended-thinking#understanding-thinking-block-caching-behavior">extended thinking documentation</a>.</p>

<h2 class="flex whitespace-pre-wrap group font-semibold" id="cache-storage-and-sharing"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#cache-storage-and-sharing">​</a></div><span class="cursor-pointer">Cache storage and sharing</span></h2>
<ul>
<li>
<p><strong>Organization Isolation</strong>: Caches are isolated between organizations. Different organizations never share caches, even if they use identical prompts.</p>
</li>
<li>
<p><strong>Exact Matching</strong>: Cache hits require 100% identical prompt segments, including all text and images up to and including the block marked with cache control.</p>
</li>
<li>
<p><strong>Output Token Generation</strong>: Prompt caching has no effect on output token generation. The response you receive will be identical to what you would get if prompt caching was not used.</p>
</li>
</ul>

<h2 class="flex whitespace-pre-wrap group font-semibold" id="1-hour-cache-duration-beta"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#1-hour-cache-duration-beta">​</a></div><span class="cursor-pointer">1-hour cache duration (beta)</span></h2>
<p>If you find that 5 minutes is too short, Anthropic also offers a 1-hour cache duration.</p>
<p>To use the extended cache, add <code>extended-cache-ttl-2025-04-11</code> as a <a class="link" href="/en/api/beta-headers">beta header</a> to your request, and then include <code>ttl</code> in the <code>cache_control</code> definition like this:</p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json"><code class="language-JSON"><span class=""><span class="token property">"cache_control"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="">    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"ephemeral"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"ttl"</span><span class="token operator">:</span> <span class="token string">"5m"</span> | <span class="token string">"1h"</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<p>The response will include detailed cache information like the following:</p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json language-json"><code class="language-JSON"><span class=""><span class="token punctuation">{</span></span>
<span class="">    <span class="token property">"usage"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="">        <span class="token property">"input_tokens"</span><span class="token operator">:</span> ...<span class="token punctuation">,</span></span>
<span class="">        <span class="token property">"cache_read_input_tokens"</span><span class="token operator">:</span> ...<span class="token punctuation">,</span></span>
<span class="">        <span class="token property">"cache_creation_input_tokens"</span><span class="token operator">:</span> ...<span class="token punctuation">,</span></span>
<span class="">        <span class="token property">"output_tokens"</span><span class="token operator">:</span> ...<span class="token punctuation">,</span></span>
<!-- -->        <!-- -->
<span class="">        <span class="token property">"cache_creation"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="">            <span class="token property">"ephemeral_5m_input_tokens"</span><span class="token operator">:</span> <span class="token number">456</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"ephemeral_1h_input_tokens"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<p>Note that the current <code>cache_creation_input_tokens</code> field equals the sum of the values in the <code>cache_creation</code> object.</p>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="when-to-use-the-1-hour-cache"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#when-to-use-the-1-hour-cache">​</a></div><span class="cursor-pointer">When to use the 1-hour cache</span></h3>
<p>If you have prompts that are used at a regular cadence (i.e., system prompts that are used more frequently than every 5 minutes), continue to use the 5-minute cache, since this will continue to be refreshed at no additional charge.</p>
<p>The 1-hour cache is best used in the following scenarios:</p>
<ul>
<li>When you have prompts that are likely used less frequently than 5 minutes, but more frequently than every hour. For example, when an agentic side-agent will take longer than 5 minutes, or when storing a long chat conversation with a user and you generally expect that user may not respond in the next 5 minutes.</li>
<li>When latency is important and your follow up prompts may be sent beyond 5 minutes.</li>
<li>When you want to improve your rate limit utilization, since cache hits are not deducted against your rate limit.</li>
</ul>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10" data-callout-type="note"><div class="text-sm prose min-w-0 w-full text-sky-900 dark:text-sky-200" data-component-part="callout-content"><p>The 5-minute and 1-hour cache behave the same with respect to latency. You will generally see improved time-to-first-token for long documents.</p></div></div>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="mixing-different-ttls"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#mixing-different-ttls">​</a></div><span class="cursor-pointer">Mixing different TTLs</span></h3>
<p>You can use both 1-hour and 5-minute cache controls in the same request, but with an important constraint: Cache entries with longer TTL must appear before shorter TTLs (i.e., a 1-hour cache entry must appear before any 5-minute cache entries).</p>
<p>When mixing TTLs, we determine three billing locations in your prompt:</p>
<ol>
<li>Position <code>A</code>: The token count at the highest cache hit (or 0 if no hits).</li>
<li>Position <code>B</code>: The token count at the highest 1-hour <code>cache_control</code> block after <code>A</code> (or equals <code>A</code> if none exist).</li>
<li>Position <code>C</code>: The token count at the last <code>cache_control</code> block.</li>
</ol>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10" data-callout-type="note"><div class="text-sm prose min-w-0 w-full text-sky-900 dark:text-sky-200" data-component-part="callout-content"><p>If <code>B</code> and/or <code>C</code> are larger than <code>A</code>, they will necessarily be cache misses, because <code>A</code> is the highest cache hit.</p></div></div>
<p>You’ll be charged for:</p>
<ol>
<li>Cache read tokens for <code>A</code>.</li>
<li>1-hour cache write tokens for <code>(B - A)</code>.</li>
<li>5-minute cache write tokens for <code>(C - B)</code>.</li>
</ol>
<p>Here are 3 examples. This depicts the input tokens of 3 requests, each of which has different cache hits and cache misses. Each has a different calculated pricing, shown in the colored boxes, as a result.
</p>

<h2 class="flex whitespace-pre-wrap group font-semibold" id="prompt-caching-examples"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#prompt-caching-examples">​</a></div><span class="cursor-pointer">Prompt caching examples</span></h2>
<p>To help you get started with prompt caching, we’ve prepared a <a class="link" href="https://github.com/anthropics/anthropic-cookbook/blob/main/misc/prompt_caching.ipynb" rel="noreferrer" target="_blank">prompt caching cookbook</a> with detailed examples and best practices.</p>
<p>Below, we’ve included several code snippets that showcase various prompt caching patterns. These examples demonstrate how to implement caching in different scenarios, helping you understand the practical applications of this feature:</p>
<div class="accordion-group [&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="large-context-caching-example accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Large context caching example</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="large-context-caching-example accordion children" role="contentinfo"><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:R5ccrimpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R9ccrimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rdccrimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rhccrimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R1kcrimpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-bash language-bash"><code class="language-bash"><span class=""><span class="token function">curl</span> https://api.anthropic.com/v1/messages <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"x-api-key: <span class="token variable">$ANTHROPIC_API_KEY</span>"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"anthropic-version: 2023-06-01"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"content-type: application/json"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--data</span> <span class="token punctuation">\</span></span>
<span class="">'<span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"model"</span><span class="token builtin class-name">:</span> <span class="token string">"claude-opus-4-20250514"</span>,</span>
<span class="">    <span class="token string">"max_tokens"</span><span class="token builtin class-name">:</span> <span class="token number">1024</span>,</span>
<span class="">    <span class="token string">"system"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,</span>
<span class="">            <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"You are an AI assistant tasked with analyzing legal documents."</span></span>
<span class="">        <span class="token punctuation">}</span>,</span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,</span>
<span class="">            <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"Here is the full text of a complex legal agreement: [Insert full text of a 50-page legal agreement here]"</span>,</span>
<span class="">            <span class="token string">"cache_control"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"ephemeral"</span><span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span>,</span>
<span class="">    <span class="token string">"messages"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token builtin class-name">:</span> <span class="token string">"user"</span>,</span>
<span class="">            <span class="token string">"content"</span><span class="token builtin class-name">:</span> <span class="token string">"What are the key terms and conditions in this agreement?"</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span>'</span>
</code></pre></div></div></div></div><p>This example demonstrates basic prompt caching usage, caching the full text of the legal agreement as a prefix while keeping the user instruction uncached.</p><p>For the first request:</p><ul>
<li><code>input_tokens</code>: Number of tokens in the user message only</li>
<li><code>cache_creation_input_tokens</code>: Number of tokens in the entire system message, including the legal document</li>
<li><code>cache_read_input_tokens</code>: 0 (no cache hit on first request)</li>
</ul><p>For subsequent requests within the cache lifetime:</p><ul>
<li><code>input_tokens</code>: Number of tokens in the user message only</li>
<li><code>cache_creation_input_tokens</code>: 0 (no new cache creation)</li>
<li><code>cache_read_input_tokens</code>: Number of tokens in the entire cached system message</li>
</ul></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="caching-tool-definitions accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Caching tool definitions</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="caching-tool-definitions accordion children" role="contentinfo"><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:Raodbimpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Riodbimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rqodbimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R12odbimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R38dbimpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-bash language-bash"><code class="language-bash"><span class=""><span class="token function">curl</span> https://api.anthropic.com/v1/messages <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"x-api-key: <span class="token variable">$ANTHROPIC_API_KEY</span>"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"anthropic-version: 2023-06-01"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"content-type: application/json"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--data</span> <span class="token punctuation">\</span></span>
<span class="">'<span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"model"</span><span class="token builtin class-name">:</span> <span class="token string">"claude-opus-4-20250514"</span>,</span>
<span class="">    <span class="token string">"max_tokens"</span><span class="token builtin class-name">:</span> <span class="token number">1024</span>,</span>
<span class="">    <span class="token string">"tools"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"get_weather"</span>,</span>
<span class="">            <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">"Get the current weather in a given location"</span>,</span>
<span class="">            <span class="token string">"input_schema"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"object"</span>,</span>
<span class="">                <span class="token string">"properties"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="">                    <span class="token string">"location"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="">                        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"string"</span>,</span>
<span class="">                        <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">"The city and state, e.g. San Francisco, CA"</span></span>
<span class="">                    <span class="token punctuation">}</span>,</span>
<span class="">                    <span class="token string">"unit"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="">                        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"string"</span>,</span>
<span class="">                        <span class="token string">"enum"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"celsius"</span>, <span class="token string">"fahrenheit"</span><span class="token punctuation">]</span>,</span>
<span class="">                        <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">"The unit of temperature, either celsius or fahrenheit"</span></span>
<span class="">                    <span class="token punctuation">}</span></span>
<span class="">                <span class="token punctuation">}</span>,</span>
<span class="">                <span class="token string">"required"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"location"</span><span class="token punctuation">]</span></span>
<span class="">            <span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span>,</span>
<span class="">        <span class="token comment"># many more tools</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"name"</span><span class="token builtin class-name">:</span> <span class="token string">"get_time"</span>,</span>
<span class="">            <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">"Get the current time in a given time zone"</span>,</span>
<span class="">            <span class="token string">"input_schema"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"object"</span>,</span>
<span class="">                <span class="token string">"properties"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="">                    <span class="token string">"timezone"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="">                        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"string"</span>,</span>
<span class="">                        <span class="token string">"description"</span><span class="token builtin class-name">:</span> <span class="token string">"The IANA time zone name, e.g. America/Los_Angeles"</span></span>
<span class="">                    <span class="token punctuation">}</span></span>
<span class="">                <span class="token punctuation">}</span>,</span>
<span class="">                <span class="token string">"required"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">"timezone"</span><span class="token punctuation">]</span></span>
<span class="">            <span class="token punctuation">}</span>,</span>
<span class="">            <span class="token string">"cache_control"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"ephemeral"</span><span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span>,</span>
<span class="">    <span class="token string">"messages"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token builtin class-name">:</span> <span class="token string">"user"</span>,</span>
<span class="">            <span class="token string">"content"</span><span class="token builtin class-name">:</span> <span class="token string">"What is the weather and time in New York?"</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span>'</span>
</code></pre></div></div></div></div><p>In this example, we demonstrate caching tool definitions.</p><p>The <code>cache_control</code> parameter is placed on the final tool (<code>get_time</code>) to designate all of the tools as part of the static prefix.</p><p>This means that all tool definitions, including <code>get_weather</code> and any other tools defined before <code>get_time</code>, will be cached as a single prefix.</p><p>This approach is useful when you have a consistent set of tools that you want to reuse across multiple requests without re-processing them each time.</p><p>For the first request:</p><ul>
<li><code>input_tokens</code>: Number of tokens in the user message</li>
<li><code>cache_creation_input_tokens</code>: Number of tokens in all tool definitions and system prompt</li>
<li><code>cache_read_input_tokens</code>: 0 (no cache hit on first request)</li>
</ul><p>For subsequent requests within the cache lifetime:</p><ul>
<li><code>input_tokens</code>: Number of tokens in the user message</li>
<li><code>cache_creation_input_tokens</code>: 0 (no new cache creation)</li>
<li><code>cache_read_input_tokens</code>: Number of tokens in all cached tool definitions and system prompt</li>
</ul></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="continuing-a-multi-turn-conversation accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Continuing a multi-turn conversation</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="continuing-a-multi-turn-conversation accordion children" role="contentinfo"><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:R5cdrimpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R9cdrimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rdcdrimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rhcdrimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R1kdrimpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-bash language-bash"><code class="language-bash"><span class=""><span class="token function">curl</span> https://api.anthropic.com/v1/messages <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"x-api-key: <span class="token variable">$ANTHROPIC_API_KEY</span>"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"anthropic-version: 2023-06-01"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"content-type: application/json"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--data</span> <span class="token punctuation">\</span></span>
<span class="">'<span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"model"</span><span class="token builtin class-name">:</span> <span class="token string">"claude-opus-4-20250514"</span>,</span>
<span class="">    <span class="token string">"max_tokens"</span><span class="token builtin class-name">:</span> <span class="token number">1024</span>,</span>
<span class="">    <span class="token string">"system"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,</span>
<span class="">            <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"...long system prompt"</span>,</span>
<span class="">            <span class="token string">"cache_control"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"ephemeral"</span><span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span>,</span>
<span class="">    <span class="token string">"messages"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token builtin class-name">:</span> <span class="token string">"user"</span>,</span>
<span class="">            <span class="token string">"content"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">                <span class="token punctuation">{</span></span>
<span class="">                    <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,</span>
<span class="">                    <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"Hello, can you tell me more about the solar system?"</span>,</span>
<span class="">                <span class="token punctuation">}</span></span>
<span class="">            <span class="token punctuation">]</span></span>
<span class="">        <span class="token punctuation">}</span>,</span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token builtin class-name">:</span> <span class="token string">"assistant"</span>,</span>
<span class="">            <span class="token string">"content"</span><span class="token builtin class-name">:</span> <span class="token string">"Certainly! The solar system is the collection of celestial bodies that orbit our Sun. It consists of eight planets, numerous moons, asteroids, comets, and other objects. The planets, in order from closest to farthest from the Sun, are: Mercury, Venus, Earth, Mars, Jupiter, Saturn, Uranus, and Neptune. Each planet has its own unique characteristics and features. Is there a specific aspect of the solar system you would like to know more about?"</span></span>
<span class="">        <span class="token punctuation">}</span>,</span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token builtin class-name">:</span> <span class="token string">"user"</span>,</span>
<span class="">            <span class="token string">"content"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">                <span class="token punctuation">{</span></span>
<span class="">                    <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,</span>
<span class="">                    <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"Good to know."</span></span>
<span class="">                <span class="token punctuation">}</span>,</span>
<span class="">                <span class="token punctuation">{</span></span>
<span class="">                    <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text"</span>,</span>
<span class="">                    <span class="token string">"text"</span><span class="token builtin class-name">:</span> <span class="token string">"Tell me more about Mars."</span>,</span>
<span class="">                    <span class="token string">"cache_control"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"ephemeral"</span><span class="token punctuation">}</span></span>
<span class="">                <span class="token punctuation">}</span></span>
<span class="">            <span class="token punctuation">]</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span>'</span>
</code></pre></div></div></div></div><p>In this example, we demonstrate how to use prompt caching in a multi-turn conversation.</p><p>During each turn, we mark the final block of the final message with <code>cache_control</code> so the conversation can be incrementally cached. The system will automatically lookup and use the longest previously cached prefix for follow-up messages. That is, blocks that were previously marked with a <code>cache_control</code> block are later not marked with this, but they will still be considered a cache hit (and also a cache refresh!) if they are hit within 5 minutes.</p><p>In addition, note that the <code>cache_control</code> parameter is placed on the system message. This is to ensure that if this gets evicted from the cache (after not being used for more than 5 minutes), it will get added back to the cache on the next request.</p><p>This approach is useful for maintaining context in ongoing conversations without repeatedly processing the same information.</p><p>When this is set up properly, you should see the following in the usage response of each request:</p><ul>
<li><code>input_tokens</code>: Number of tokens in the new user message (will be minimal)</li>
<li><code>cache_creation_input_tokens</code>: Number of tokens in the new assistant and user turns</li>
<li><code>cache_read_input_tokens</code>: Number of tokens in the conversation up to the previous turn</li>
</ul></div></div></div>

<h2 class="flex whitespace-pre-wrap group font-semibold" id="faq"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#faq">​</a></div><span class="cursor-pointer">FAQ</span></h2>
<div class="accordion-group [&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="what-is-the-cache-lifetime accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">What is the cache lifetime?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="what-is-the-cache-lifetime accordion children" role="contentinfo"><p>The cache has a minimum lifetime (TTL) of 5 minutes. This lifetime is refreshed each time the cached content is used.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="how-many-cache-breakpoints-can-i-use accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">How many cache breakpoints can I use?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="how-many-cache-breakpoints-can-i-use accordion children" role="contentinfo"><p>You can define up to 4 cache breakpoints (using <code>cache_control</code> parameters) in your prompt.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="is-prompt-caching-available-for-all-models accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Is prompt caching available for all models?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="is-prompt-caching-available-for-all-models accordion children" role="contentinfo"><p>No, prompt caching is currently only available for Claude Opus 4, Claude Sonnet 4, Claude Sonnet 3.7, Claude Sonnet 3.5, Claude Haiku 3.5, Claude Haiku 3, and Claude Opus 3.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="how-does-prompt-caching-work-with-extended-thinking accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">How does prompt caching work with extended thinking?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="how-does-prompt-caching-work-with-extended-thinking accordion children" role="contentinfo"><p>Cached system prompts and tools will be reused when thinking parameters change. However, thinking changes (enabling/disabling or budget changes) will invalidate previously cached prompt prefixes with messages content.</p><p>For more detailed information about extended thinking, including its interaction with tool use and prompt caching, see the <a class="link" href="/en/docs/build-with-claude/extended-thinking#extended-thinking-and-prompt-caching">extended thinking documentation</a>.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="how-do-i-enable-prompt-caching accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">How do I enable prompt caching?</p></div></button></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="can-i-use-prompt-caching-with-other-api-features accordion children" role="contentinfo"><p>Yes, prompt caching can be used alongside other API features like tool use and vision capabilities. However, changing whether there are images in a prompt or modifying tool use settings will break the cache.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="how-does-prompt-caching-affect-pricing accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">How does prompt caching affect pricing?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="how-does-prompt-caching-affect-pricing accordion children" role="contentinfo"><p>Prompt caching introduces a new pricing structure where cache writes cost 25% more than base input tokens, while cache hits cost only 10% of the base input token price.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="can-i-manually-clear-the-cache accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Can I manually clear the cache?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="can-i-manually-clear-the-cache accordion children" role="contentinfo"><p>Currently, there’s no way to manually clear the cache. Cached prefixes automatically expire after a minimum of 5 minutes of inactivity.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="how-can-i-track-the-effectiveness-of-my-caching-strategy accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">How can I track the effectiveness of my caching strategy?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="how-can-i-track-the-effectiveness-of-my-caching-strategy accordion children" role="contentinfo"><p>You can monitor cache performance using the <code>cache_creation_input_tokens</code> and <code>cache_read_input_tokens</code> fields in the API response.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="what-can-break-the-cache accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">What can break the cache?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="what-can-break-the-cache accordion children" role="contentinfo"><p>Changes that can break the cache include modifying any content, changing whether there are any images (anywhere in the prompt), and altering <code>tool_choice.type</code>. Any of these changes will require creating a new cache entry.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="how-does-prompt-caching-handle-privacy-and-data-separation accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">How does prompt caching handle privacy and data separation?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="how-does-prompt-caching-handle-privacy-and-data-separation accordion children" role="contentinfo"><p>Prompt caching is designed with strong privacy and data separation measures:</p><ol>
<li>
<p>Cache keys are generated using a cryptographic hash of the prompts up to the cache control point. This means only requests with identical prompts can access a specific cache.</p>
</li>
<li>
<p>Caches are organization-specific. Users within the same organization can access the same cache if they use identical prompts, but caches are not shared across different organizations, even for identical prompts.</p>
</li>
<li>
<p>The caching mechanism is designed to maintain the integrity and privacy of each unique conversation or context.</p>
</li>
<li>
<p>It’s safe to use <code>cache_control</code> anywhere in your prompts. For cost efficiency, it’s better to exclude highly variable parts (e.g., user’s arbitrary input) from caching.</p>
</li>
</ol><p>These measures ensure that prompt caching maintains data privacy and security while offering performance benefits.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="can-i-use-prompt-caching-with-the-batches-api accordion children" role="contentinfo"><p>Yes, it is possible to use prompt caching with your <a class="link" href="/en/docs/build-with-claude/batch-processing">Batches API</a> requests. However, because asynchronous batch requests can be processed concurrently and in any order, cache hits are provided on a best-effort basis.</p><p>The <a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/prompt-caching#1-hour-cache-beta">1-hour cache</a> can help improve your cache hits. The most cost effective way of using it is the following:</p><ul>
<li>Gather a set of message requests that have a shared prefix.</li>
<li>Send a batch request with just a single request that has this shared prefix and a 1-hour cache block. This will get written to the 1-hour cache.</li>
<li>As soon as this is complete, submit the rest of the requests. You will have to monitor the job to know when it completes.</li>
</ul><p>This is typically better than using the 5-minute cache simply because it’s common for batch requests to take between 5 minutes and 1 hour to complete. We’re considering ways to improve these cache hit rates and making this process more straightforward.</p></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="why-am-i-seeing-the-error-attributeerror-beta-object-has-no-attribute-prompt-caching-in-python accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Why am I seeing the error `AttributeError: 'Beta' object has no attribute 'prompt_caching'` in Python?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="why-am-i-seeing-the-error-attributeerror-beta-object-has-no-attribute-prompt-caching-in-python accordion children" role="contentinfo"><p>This error typically appears when you have upgraded your SDK or you are using outdated code examples. Prompt caching is now generally available, so you no longer need the beta prefix. Instead of:</p><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:Rlimrumpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10">Python</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R6imrumpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python"><code class="language-Python"><span class="">python client<span class="token punctuation">.</span>beta<span class="token punctuation">.</span>prompt_caching<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></span>
</code></pre></div></div></div></div><p>Simply use:</p><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:Rlkmrumpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10">Python</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R6kmrumpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python"><code class="language-Python"><span class="">python client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span></span>
</code></pre></div></div></div></div></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="why-am-i-seeing-typeerror-cannot-read-properties-of-undefined-reading-messages accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Why am I seeing 'TypeError: Cannot read properties of undefined (reading 'messages')'?</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="why-am-i-seeing-typeerror-cannot-read-properties-of-undefined-reading-messages accordion children" role="contentinfo"><p>This error typically appears when you have upgraded your SDK or you are using outdated code examples. Prompt caching is now generally available, so you no longer need the beta prefix. Instead of:</p><div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="flex rounded-t-2xl text-gray-400 text-xs leading-6 border-b font-medium bg-black/40 border-gray-900/80" data-component-part="code-block-tab-bar"><div class="flex-none border-b px-4 pt-2.5 pb-2 flex items-center text-primary-light border-primary-light" data-component-part="code-block-tab-bar-filename">TypeScript</div></div><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-typescript"><code class="language-typescript"><span class="">client<span class="token punctuation">.</span>beta<span class="token punctuation">.</span>promptCaching<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span></span>
</code></pre></div></div></div><p>Simply use:</p><div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-typescript"><code class="language-typescript"><span class="">client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span></span>
</code></pre></div></div></div></div></div></div></div><div class="leading-6 mt-14"><div class="feedback-toolbar pb-16 w-full"><div class="flex flex-col gap-y-4 xl:flex-col xl:gap-6 min-[1400px]:flex-row md:flex-row md:justify-end"><div class="flex flex-row gap-5 items-center grow justify-between md:justify-start xl:justify-between min-[1400px]:justify-start"><p class="text-sm text-gray-600 dark:text-gray-400">Was this page helpful?</p><div class="flex flex-row gap-3 items-center"><button class="px-3.5 py-2 flex flex-row gap-3 items-center border-standard rounded-xl text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 bg-white/50 dark:bg-codeblock/50 hover:border-gray-500 hover:dark:border-gray-500"><small class="text-sm font-normal leading-4">Yes</small></button><button class="px-3.5 py-2 flex flex-row gap-3 items-center border-standard rounded-xl text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 bg-white/50 dark:bg-codeblock/50 hover:border-gray-500 hover:dark:border-gray-500"><small class="text-sm font-normal leading-4">No</small></button></div></div></div></div><div class="mb-12 px-0.5 flex items-center text-sm font-semibold text-gray-700 dark:text-gray-200" id="pagination"><a class="flex items-center space-x-3 group" href="/en/docs/build-with-claude/overview"><span class="group-hover:text-gray-900 dark:group-hover:text-white">Features overview</span></a><a class="flex items-center ml-auto space-x-3 group" href="/en/docs/build-with-claude/extended-thinking"><span class="group-hover:text-gray-900 dark:group-hover:text-white">Extended thinking</span></a></div></div></div><div class="hidden xl:flex self-start sticky xl:flex-col h-[calc(100vh-9.5rem)] top-[9.5rem]" id="content-side-layout"><div class="z-10 hidden xl:flex pl-10 box-border w-[19rem] max-h-full" id="table-of-contents-layout"><div class="text-gray-600 text-sm leading-6 w-[16.5rem] overflow-y-auto space-y-2 pb-4 -mt-10 pt-10" id="table-of-contents"><div class="text-gray-700 dark:text-gray-300 font-medium flex items-center space-x-2"><span>On this page</span></div></div></div></div></div></div></div></div></main>