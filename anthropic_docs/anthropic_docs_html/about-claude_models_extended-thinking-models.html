<main class="jsx-4145347147"><div class="relative antialiased text-gray-500 dark:text-gray-400"><div class="max-w-8xl px-4 mx-auto lg:px-8"><div class="z-20 hidden lg:block fixed bottom-0 right-auto w-[18rem]" id="sidebar" style="top:7rem"><div class="absolute inset-0 z-10 stable-scrollbar-gutter overflow-auto pr-8 pb-10" id="sidebar-content"><div class="relative lg:text-sm lg:leading-6"><div id="navigation-items"><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-semibold text-primary dark:text-primary-light" href="/en/home">Documentation</a></li><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://console.anthropic.com/" rel="noreferrer" target="_blank">Developer Console</a></li><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://www.anthropic.com/discord" rel="noreferrer" target="_blank">Developer Discord</a></li><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://support.anthropic.com/" rel="noreferrer" target="_blank">Support</a></li><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">First steps</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/welcome"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/welcome" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Intro to Claude</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/get-started"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/get-started" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Get started</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Models &amp; pricing</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/models/overview"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/models/overview" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Models overview</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/models/choosing-a-model"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/models/choosing-a-model" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Choosing a model</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/models/migrating-to-claude-4"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/models/migrating-to-claude-4" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Migrating to Claude 4</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/model-deprecations"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/model-deprecations" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Model deprecations</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/pricing"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/pricing" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Pricing</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Learn about Claude</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/overview"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/overview" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Building with Claude</div></div></a></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div class="">Use cases</div></div></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/context-windows"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/context-windows" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Context windows</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/about-claude/glossary"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/about-claude/glossary" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Glossary</div></div></a></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div class="">Prompt engineering</div></div></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Explore features</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/overview"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/overview" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Features overview</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/prompt-caching"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/prompt-caching" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Prompt caching</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/extended-thinking"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl bg-primary/10 text-primary font-semibold dark:text-primary-light dark:bg-primary-light/10" href="/en/docs/build-with-claude/extended-thinking" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Extended thinking</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/streaming"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/streaming" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Streaming Messages</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/batch-processing"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/batch-processing" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Batch processing</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/citations"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/citations" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Citations</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/multilingual-support"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/multilingual-support" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Multilingual support</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/token-counting"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/token-counting" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Token counting</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/embeddings"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/embeddings" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Embeddings</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/vision"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/vision" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Vision</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/pdf-support"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/pdf-support" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>PDF support</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Agent components</h5><ul id="sidebar-group"><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div class="">Tools</div></div></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div class="">Model Context Protocol (MCP)</div></div></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/agents-and-tools/computer-use"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/agents-and-tools/computer-use" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Computer use (beta)</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/agents-and-tools/claude-for-sheets"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/agents-and-tools/claude-for-sheets" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Google Sheets add-on</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Test &amp; evaluate</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/test-and-evaluate/define-success"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/test-and-evaluate/define-success" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Define success criteria</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/test-and-evaluate/develop-tests"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/test-and-evaluate/develop-tests" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Develop test cases</div></div></a></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div class="">Strengthen guardrails</div></div></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/docs/test-and-evaluate/eval-tool"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/test-and-evaluate/eval-tool" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Using the Evaluation Tool</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Legal center</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="https://www.anthropic.com/legal/privacy"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://www.anthropic.com/legal/privacy" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Anthropic Privacy Policy</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="https://trust.anthropic.com/"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://trust.anthropic.com/" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Security and compliance</div></div></a></li></ul></div></div></div></div></div><div class="" id="content-container"><div class="flex flex-row gap-12 box-border w-full pt-40 lg:pt-10"><div class="relative grow box-border flex-col w-full mx-auto px-1 lg:pl-[23.7rem] lg:-ml-12 xl:w-[calc(100%-28rem)]" id="content-area"><div class="mdx-content relative mt-8 prose prose-gray dark:prose-invert"><p>Extended thinking gives Claude enhanced reasoning capabilities for complex tasks, while providing varying levels of transparency into its step-by-step thought process before it delivers its final answer.</p>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="supported-models"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#supported-models">​</a></div><span class="cursor-pointer">Supported models</span></h2>
<p>Extended thinking is supported in the following models:</p>
<ul>
<li>Claude Opus 4 (<code>claude-opus-4-20250514</code>)</li>
<li>Claude Sonnet 4 (<code>claude-sonnet-4-20250514</code>)</li>
<li>Claude Sonnet 3.7 (<code>claude-3-7-sonnet-20250219</code>)</li>
</ul>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10" data-callout-type="note"><div class="text-sm prose min-w-0 w-full text-sky-900 dark:text-sky-200" data-component-part="callout-content"><p>API behavior differs across Claude 3.7 and Claude 4 models, but the API shapes remain exactly the same.</p><p>For more information, see <a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#differences-in-thinking-across-model-versions">Differences in thinking across model versions</a>.</p></div></div>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="how-extended-thinking-works"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#how-extended-thinking-works">​</a></div><span class="cursor-pointer">How extended thinking works</span></h2>
<p>When extended thinking is turned on, Claude creates <code>thinking</code> content blocks where it outputs its internal reasoning. Claude incorporates insights from this reasoning before crafting a final response.</p>
<p>The API response will include <code>thinking</code> content blocks, followed by <code>text</code> content blocks.</p>
<p>Here’s an example of the default response format:</p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json language-json"><code class="language-json"><span class=""><span class="token punctuation">{</span></span>
<span class="">  <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking"</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">"Let me analyze this step by step..."</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"signature"</span><span class="token operator">:</span> <span class="token string">"WaUjzkypQ2mUEVM36O2TxuC06KN8xyfbJwyem2dw3URve/op91XWHOEBLLqIOMfFG/UvLEczmEsUjavL...."</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Based on my analysis..."</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class="">  <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<p>For more information about the response format of extended thinking, see the <a class="link" href="/en/api/messages">Messages API Reference</a>.</p>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="how-to-use-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#how-to-use-extended-thinking">​</a></div><span class="cursor-pointer">How to use extended thinking</span></h2>
<p>Here is an example of using extended thinking in the Messages API:</p>
<div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:R2m1mmpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R4m1mmpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R6m1mmpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R8m1mmpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:Rq1mmpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-bash language-bash"><code class="language-bash"><span class=""><span class="token function">curl</span> https://api.anthropic.com/v1/messages <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"x-api-key: <span class="token variable">$ANTHROPIC_API_KEY</span>"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"anthropic-version: 2023-06-01"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"content-type: application/json"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--data</span> <span class="token punctuation">\</span></span>
<span class="">'<span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"model"</span><span class="token builtin class-name">:</span> <span class="token string">"claude-sonnet-4-20250514"</span>,</span>
<span class="">    <span class="token string">"max_tokens"</span><span class="token builtin class-name">:</span> <span class="token number">16000</span>,</span>
<span class="">    <span class="token string">"thinking"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"enabled"</span>,</span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token builtin class-name">:</span> <span class="token number">10000</span></span>
<span class="">    <span class="token punctuation">}</span>,</span>
<span class="">    <span class="token string">"messages"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token builtin class-name">:</span> <span class="token string">"user"</span>,</span>
<span class="">            <span class="token string">"content"</span><span class="token builtin class-name">:</span> <span class="token string">"Are there an infinite number of prime numbers such that n mod 4 == 3?"</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span>'</span>
</code></pre></div></div></div></div>
<p>To turn on extended thinking, add a <code>thinking</code> object, with the <code>thinking</code> parameter set to <code>enabled</code> and the <code>budget_tokens</code> to a specified token budget for extended thinking.</p>
<p>The <code>budget_tokens</code> parameter determines the maximum number of tokens Claude is allowed to use for its internal reasoning process. In Claude 4 models, this limit applies to full thinking tokens, and not to <a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#summarized-thinking">the summarized output</a>. Larger budgets can improve response quality by enabling more thorough analysis for complex problems, although Claude may not use the entire budget allocated, especially at ranges above 32k.</p>
<p><code>budget_tokens</code> must be set to a value less than <code>max_tokens</code>. However, when using <a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#interleaved-thinking">interleaved thinking with tools</a>, you can exceed this limit as the token limit becomes your entire context window (200k tokens).</p>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="summarized-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#summarized-thinking">​</a></div><span class="cursor-pointer">Summarized thinking</span></h3>
<p>With extended thinking enabled, the Messages API for Claude 4 models returns a summary of Claude’s full thinking process. Summarized thinking provides the full intelligence benefits of extended thinking, while preventing misuse.</p>
<p>Here are some important considerations for summarized thinking:</p>
<ul>
<li>You’re charged for the full thinking tokens generated by the original request, not the summary tokens.</li>
<li>The billed output token count will <strong>not match</strong> the count of tokens you see in the response.</li>
<li>The first few lines of thinking output are more verbose, providing detailed reasoning that’s particularly helpful for prompt engineering purposes.</li>
<li>As Anthropic seeks to improve the extended thinking feature, summarization behavior is subject to change.</li>
<li>Summarization preserves the key ideas of Claude’s thinking process with minimal added latency, enabling a streamable user experience and easy migration from Claude 3.7 models to Claude 4 models.</li>
<li>Summarization is processed by a different model than the one you target in your requests. The thinking model does not see the summarized output.</li>
</ul>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10" data-callout-type="note"><div class="text-sm prose min-w-0 w-full text-sky-900 dark:text-sky-200" data-component-part="callout-content"><p>Claude Sonnet 3.7 continues to return full thinking output.</p><p>In rare cases where you need access to full thinking output for Claude 4 models, <a class="link" href="mailto:sales@anthropic.com" rel="noreferrer" target="_blank">contact our sales team</a>.</p></div></div>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="streaming-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#streaming-thinking">​</a></div><span class="cursor-pointer">Streaming thinking</span></h3>
<p>You can stream extended thinking responses using <a class="link" href="https://developer.mozilla.org/en-US/docs/Web/API/Server-sent%5Fevents/Using%5Fserver-sent%5Fevents" rel="noreferrer" target="_blank">server-sent events (SSE)</a>.</p>
<p>When streaming is enabled for extended thinking, you receive thinking content via <code>thinking_delta</code> events.</p>
<p>For more documention on streaming via the Messages API, see <a class="link" href="/en/api/messages-streaming">Streaming Messages</a>.</p>
<p>Here’s how to handle streaming with thinking:</p>
<div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:R2m3empkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R4m3empkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R6m3empkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R8m3empkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Ram3empkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light"><a class="link btn size-xs primary" href="https://console.anthropic.com/workbench/new?user=What+is+27+*+453%3F&amp;thinking.budget_tokens=16000" rel="noreferrer" style="margin:-0.25rem -0.5rem" target="_blank">Try in Console<!-- --> </a></div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:Rq3empkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-bash language-bash"><code class="language-bash"><span class=""><span class="token function">curl</span> https://api.anthropic.com/v1/messages <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"x-api-key: <span class="token variable">$ANTHROPIC_API_KEY</span>"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"anthropic-version: 2023-06-01"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--header</span> <span class="token string">"content-type: application/json"</span> <span class="token punctuation">\</span></span>
<span class="">     <span class="token parameter variable">--data</span> <span class="token punctuation">\</span></span>
<span class="">'<span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"model"</span><span class="token builtin class-name">:</span> <span class="token string">"claude-sonnet-4-20250514"</span>,</span>
<span class="">    <span class="token string">"max_tokens"</span><span class="token builtin class-name">:</span> <span class="token number">16000</span>,</span>
<span class="">    <span class="token string">"stream"</span><span class="token builtin class-name">:</span> true,</span>
<span class="">    <span class="token string">"thinking"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"enabled"</span>,</span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token builtin class-name">:</span> <span class="token number">10000</span></span>
<span class="">    <span class="token punctuation">}</span>,</span>
<span class="">    <span class="token string">"messages"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token builtin class-name">:</span> <span class="token string">"user"</span>,</span>
<span class="">            <span class="token string">"content"</span><span class="token builtin class-name">:</span> <span class="token string">"What is 27 * 453?"</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span>'</span>
</code></pre></div></div></div></div>
<p>Example streaming output:</p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json"><code class="language-json"><span class="">event<span class="token operator">:</span> message_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message_start"</span><span class="token punctuation">,</span> <span class="token property">"message"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"msg_01..."</span><span class="token punctuation">,</span> <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token property">"role"</span><span class="token operator">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token property">"model"</span><span class="token operator">:</span> <span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span> <span class="token property">"stop_reason"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span> <span class="token property">"stop_sequence"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_start"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">"content_block"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking"</span><span class="token punctuation">,</span> <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_delta"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">"delta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking_delta"</span><span class="token punctuation">,</span> <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">"Let me solve this step by step:\n\n1. First break down 27 * 453"</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_delta"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">"delta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking_delta"</span><span class="token punctuation">,</span> <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">"\n2. 453 = 400 + 50 + 3"</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class=""><span class="token comment">// Additional thinking deltas...</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_delta"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token property">"delta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"signature_delta"</span><span class="token punctuation">,</span> <span class="token property">"signature"</span><span class="token operator">:</span> <span class="token string">"EqQBCgIYAhIM1gbcDa9GJwZA2b3hGgxBdjrkzLoky3dl1pkiMOYds..."</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_stop"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_start</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_start"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">"content_block"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_delta"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token property">"delta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text_delta"</span><span class="token punctuation">,</span> <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"27 * 453 = 12,231"</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class=""><span class="token comment">// Additional text deltas...</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> content_block_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"content_block_stop"</span><span class="token punctuation">,</span> <span class="token property">"index"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> message_delta</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message_delta"</span><span class="token punctuation">,</span> <span class="token property">"delta"</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"stop_reason"</span><span class="token operator">:</span> <span class="token string">"end_turn"</span><span class="token punctuation">,</span> <span class="token property">"stop_sequence"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<!-- -->
<span class="">event<span class="token operator">:</span> message_stop</span>
<span class="">data<span class="token operator">:</span> <span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message_stop"</span><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10" data-callout-type="note"><div class="text-sm prose min-w-0 w-full text-sky-900 dark:text-sky-200" data-component-part="callout-content"><p>When using streaming with thinking enabled, you might notice that text sometimes arrives in larger chunks alternating with smaller, token-by-token delivery. This is expected behavior, especially for thinking content.</p><p>The streaming system needs to process content in batches for optimal performance, which can result in this “chunky” delivery pattern, with possible delays between streaming events. We’re continuously working to improve this experience, with future updates focused on making thinking content stream more smoothly.</p></div></div>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="extended-thinking-with-tool-use"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#extended-thinking-with-tool-use">​</a></div><span class="cursor-pointer">Extended thinking with tool use</span></h2>
<p>Extended thinking can be used alongside <a class="link" href="/en/docs/build-with-claude/tool-use">tool use</a>, allowing Claude to reason through tool selection and results processing.</p>
<p>When using extended thinking with tool use, be aware of the following limitations:</p>
<ol>
<li>
<p><strong>Tool choice limitation</strong>: Tool use with thinking only supports <code>tool_choice: {"type": "auto"}</code> (the default) or <code>tool_choice: {"type": "none"}</code>. Using <code>tool_choice: {"type": "any"}</code> or <code>tool_choice: {"type": "tool", "name": "..."}</code> will result in an error because these options force tool use, which is incompatible with extended thinking.</p>
</li>
<li>
<p><strong>Preserving thinking blocks</strong>: During tool use, you must pass <code>thinking</code> blocks back to the API for the last assistant message. Include the complete unmodified block back to the API to maintain reasoning continuity.</p>
</li>
</ol>
<div class="accordion-group [&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="example-passing-thinking-blocks-with-tool-results accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Example: Passing thinking blocks with tool results</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="example-passing-thinking-blocks-with-tool-results accordion children" role="contentinfo"><p>Here’s a practical example showing how to preserve thinking blocks when providing tool results:</p><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:R5ca4empkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R9ca4empkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rdca4empkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R1ka4empkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python"><code class="language-python"><span class="">weather_tool <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"get_weather"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Get current weather for a location"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"input_schema"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"location"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"location"</span><span class="token punctuation">]</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">}</span></span>
<!-- -->
<span class=""><span class="token comment"># First request - Claude responds with thinking and tool request</span></span>
<span class="">response <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">16000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">10000</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    tools<span class="token operator">=</span><span class="token punctuation">[</span>weather_tool<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"What's the weather in Paris?"</span><span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">)</span></span>
</code></pre></div></div></div></div><p>The API response will include thinking, text, and tool_use blocks:</p><div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json language-json"><code class="language-json"><span class=""><span class="token punctuation">{</span></span>
<span class="">    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">"The user wants to know the current weather in Paris. I have access to a function `get_weather`..."</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"signature"</span><span class="token operator">:</span> <span class="token string">"BDaL4VrbR2Oj0hO4XpJxT28J5TILnCrrUXoKiiNBZW9P+nr8XSj1zuZzAl4egiCCpQNvfyUuFFJP5CncdYZEQPPmLxYsNrcs...."</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"I can help you get the current weather information for Paris. Let me check that for you"</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"tool_use"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"toolu_01CswdEQBMshySk6Y9DFKrfq"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"get_weather"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"input"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="">                <span class="token property">"location"</span><span class="token operator">:</span> <span class="token string">"Paris"</span></span>
<span class="">            <span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div><p>Now let’s continue the conversation and use the tool</p><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:R5cq4empkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R9cq4empkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rdcq4empkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R1kq4empkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python"><code class="language-python"><span class=""><span class="token comment"># Extract thinking block and tool use block</span></span>
<span class="">thinking_block <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block <span class="token keyword">for</span> block <span class="token keyword">in</span> response<span class="token punctuation">.</span>content</span>
<span class="">                      <span class="token keyword">if</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">'thinking'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span></span>
<span class="">tool_use_block <span class="token operator">=</span> <span class="token builtin">next</span><span class="token punctuation">(</span><span class="token punctuation">(</span>block <span class="token keyword">for</span> block <span class="token keyword">in</span> response<span class="token punctuation">.</span>content</span>
<span class="">                      <span class="token keyword">if</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">'tool_use'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Call your actual weather API, here is where your actual API call would go</span></span>
<span class=""><span class="token comment"># let's pretend this is what we get back</span></span>
<span class="">weather_data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"temperature"</span><span class="token punctuation">:</span> <span class="token number">88</span><span class="token punctuation">}</span></span>
<!-- -->
<span class=""><span class="token comment"># Second request - Include thinking block and tool result</span></span>
<span class=""><span class="token comment"># No new thinking blocks will be generated in the response</span></span>
<span class="">continuation <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">16000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">10000</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    tools<span class="token operator">=</span><span class="token punctuation">[</span>weather_tool<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"What's the weather in Paris?"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token comment"># notice that the thinking_block is passed in as well as the tool_use_block</span></span>
<span class="">        <span class="token comment"># if this is not passed in, an error is raised</span></span>
<span class="">        <span class="token punctuation">{</span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>thinking_block<span class="token punctuation">,</span> tool_use_block<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span><span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span> <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"tool_result"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token string">"tool_use_id"</span><span class="token punctuation">:</span> tool_use_block<span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string-interpolation"><span class="token string">f"Current temperature: </span><span class="token interpolation"><span class="token punctuation">{</span>weather_data<span class="token punctuation">[</span><span class="token string">'temperature'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">°F"</span></span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">)</span></span>
</code></pre></div></div></div></div><p>The API response will now <strong>only</strong> include text</p><div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json language-json"><code class="language-json"><span class=""><span class="token punctuation">{</span></span>
<span class="">    <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Currently in Paris, the temperature is 88°F (31°C)"</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div></div></div></div>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="preserving-thinking-blocks"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#preserving-thinking-blocks">​</a></div><span class="cursor-pointer">Preserving thinking blocks</span></h3>
<p>During tool use, you must pass <code>thinking</code> blocks back to the API, and you must include the complete unmodified block back to the API.  This is critical for maintaining the model’s reasoning flow and conversation integrity.</p>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-emerald-500/20 bg-emerald-50/50 dark:border-emerald-500/30 dark:bg-emerald-500/10" data-callout-type="tip"><div class="text-sm prose min-w-0 w-full text-emerald-900 dark:text-emerald-200" data-component-part="callout-content"><p>While you can omit <code>thinking</code> blocks from prior <code>assistant</code> role turns, we suggest always passing back all thinking blocks to the API for any multi-turn conversation. The API will:</p><ul>
<li>Automatically filter the provided thinking blocks</li>
<li>Use the relevant thinking blocks necessary to preserve the model’s reasoning</li>
<li>Only bill for the input tokens for the blocks shown to Claude</li>
</ul></div></div>
<p>When Claude invokes tools, it is pausing its construction of a response to await external information. When tool results are returned, Claude will continue building that existing response. This necessitates preserving thinking blocks during tool use, for a couple of reasons:</p>
<ol>
<li>
<p><strong>Reasoning continuity</strong>: The thinking blocks capture Claude’s step-by-step reasoning that led to tool requests. When you post tool results, including the original thinking ensures Claude can continue its reasoning from where it left off.</p>
</li>
<li>
<p><strong>Context maintenance</strong>: While tool results appear as user messages in the API structure, they’re part of a continuous reasoning flow. Preserving thinking blocks maintains this conceptual flow across multiple API calls. For more information on context management, see our <a class="link" href="/en/docs/context-windows">guide on context windows</a>.</p>
</li>
</ol>
<p><strong>Important</strong>: When providing <code>thinking</code> blocks, the entire sequence of consecutive <code>thinking</code> blocks must match the outputs generated by the model during the original request; you cannot rearrange or modify the sequence of these blocks.</p>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="interleaved-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#interleaved-thinking">​</a></div><span class="cursor-pointer">Interleaved thinking</span></h3>
<p>Extended thinking with tool use in Claude 4 models supports interleaved thinking, which enables Claude to think between tool calls and make more sophisticated reasoning after receiving tool results.</p>
<p>With interleaved thinking, Claude can:</p>
<ul>
<li>Reason about the results of a tool call before deciding what to do next</li>
<li>Chain multiple tool calls with reasoning steps in between</li>
<li>Make more nuanced decisions based on intermediate results</li>
</ul>
<p>To enable interleaved thinking, add <a class="link" href="/en/api/beta-headers">the beta header</a> <code>interleaved-thinking-2025-05-14</code> to your API request.</p>
<p>Here are some important considerations for interleaved thinking:</p>
<ul>
<li>With interleaved thinking, the <code>budget_tokens</code> can exceed the <code>max_tokens</code> parameter, as it represents the total budget across all thinking blocks within one assistant turn.</li>
<li>Interleaved thinking is only supported for <a class="link" href="/en/docs/build-with-claude/tool-use/overview">tools used via the Messages API</a>.</li>
<li>Interleaved thinking is supported for Claude 4 models only, with the beta header <code>interleaved-thinking-2025-05-14</code>.</li>
<li>Direct calls to Anthropic’s API allow you to pass <code>interleaved-thinking-2025-05-14</code> in requests to any model, with no effect.</li>
<li>On 3rd-party platforms (e.g., <a class="link" href="/en/api/claude-on-amazon-bedrock">Amazon Bedrock</a> and <a class="link" href="/en/api/claude-on-vertex-ai">Vertex AI</a>), if you pass <code>interleaved-thinking-2025-05-14</code> to any model aside from Claude Opus 4 or Sonnet 4, your request will fail.</li>
</ul>
<div class="accordion-group [&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="tool-use-without-interleaved-thinking accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Tool use without interleaved thinking</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="tool-use-without-interleaved-thinking accordion children" role="contentinfo"><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:R5cp66mpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R9cp66mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rdcp66mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R1kp66mpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python language-python"><code class="language-python"><span class=""><span class="token keyword">import</span> anthropic</span>
<!-- -->
<span class="">client <span class="token operator">=</span> anthropic<span class="token punctuation">.</span>Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Define tools</span></span>
<span class="">calculator_tool <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"calculator"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Perform mathematical calculations"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"input_schema"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"expression"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Mathematical expression to evaluate"</span></span>
<span class="">            <span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"expression"</span><span class="token punctuation">]</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">}</span></span>
<!-- -->
<span class="">database_tool <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"database_query"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Query product database"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"input_schema"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"SQL query to execute"</span></span>
<span class="">            <span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"query"</span><span class="token punctuation">]</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">}</span></span>
<!-- -->
<span class=""><span class="token comment"># First request - Claude thinks once before all tool calls</span></span>
<span class="">response <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">16000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">10000</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    tools<span class="token operator">=</span><span class="token punctuation">[</span>calculator_tool<span class="token punctuation">,</span> database_tool<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"What's the total revenue if we sold 150 units of product A at $50 each, and how does this compare to our average monthly revenue from the database?"</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Response includes thinking followed by tool uses</span></span>
<span class=""><span class="token comment"># Note: Claude thinks once at the beginning, then makes all tool decisions</span></span>
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"First response:"</span><span class="token punctuation">)</span></span>
<span class=""><span class="token keyword">for</span> block <span class="token keyword">in</span> response<span class="token punctuation">.</span>content<span class="token punctuation">:</span></span>
<span class="">    <span class="token keyword">if</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"thinking"</span><span class="token punctuation">:</span></span>
<span class="">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Thinking (summarized): </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span>thinking<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="">    <span class="token keyword">elif</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"tool_use"</span><span class="token punctuation">:</span></span>
<span class="">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Tool use: </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string"> with input </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="">    <span class="token keyword">elif</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"text"</span><span class="token punctuation">:</span></span>
<span class="">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Text: </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># You would execute the tools and return results...</span></span>
<span class=""><span class="token comment"># After getting both tool results back, Claude directly responds without additional thinking</span></span>
</code></pre></div></div></div></div><p>In this example without interleaved thinking:</p><ol>
<li>Claude thinks once at the beginning to understand the task</li>
<li>Makes all tool use decisions upfront</li>
<li>When tool results are returned, Claude immediately provides a response without additional thinking</li>
</ol></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="tool-use-with-interleaved-thinking accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Tool use with interleaved thinking</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="tool-use-with-interleaved-thinking accordion children" role="contentinfo"><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:Raoq66mpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rioq66mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rqoq66mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R38q66mpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python language-python"><code class="language-python"><span class=""><span class="token keyword">import</span> anthropic</span>
<!-- -->
<span class="">client <span class="token operator">=</span> anthropic<span class="token punctuation">.</span>Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Same tool definitions as before</span></span>
<span class="">calculator_tool <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"calculator"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Perform mathematical calculations"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"input_schema"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"expression"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Mathematical expression to evaluate"</span></span>
<span class="">            <span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"expression"</span><span class="token punctuation">]</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">}</span></span>
<!-- -->
<span class="">database_tool <span class="token operator">=</span> <span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"name"</span><span class="token punctuation">:</span> <span class="token string">"database_query"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"Query product database"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"input_schema"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"object"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"properties"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"query"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"string"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"description"</span><span class="token punctuation">:</span> <span class="token string">"SQL query to execute"</span></span>
<span class="">            <span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"required"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"query"</span><span class="token punctuation">]</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">}</span></span>
<!-- -->
<span class=""><span class="token comment"># First request with interleaved thinking enabled</span></span>
<span class="">response <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">16000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">10000</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    tools<span class="token operator">=</span><span class="token punctuation">[</span>calculator_tool<span class="token punctuation">,</span> database_tool<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token comment"># Enable interleaved thinking with beta header</span></span>
<span class="">    extra_headers<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"anthropic-beta"</span><span class="token punctuation">:</span> <span class="token string">"interleaved-thinking-2025-05-14"</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"What's the total revenue if we sold 150 units of product A at $50 each, and how does this compare to our average monthly revenue from the database?"</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Initial response:"</span><span class="token punctuation">)</span></span>
<span class="">thinking_blocks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<span class="">tool_use_blocks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></span>
<!-- -->
<span class=""><span class="token keyword">for</span> block <span class="token keyword">in</span> response<span class="token punctuation">.</span>content<span class="token punctuation">:</span></span>
<span class="">    <span class="token keyword">if</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"thinking"</span><span class="token punctuation">:</span></span>
<span class="">        thinking_blocks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>block<span class="token punctuation">)</span></span>
<span class="">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Thinking: </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span>thinking<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="">    <span class="token keyword">elif</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"tool_use"</span><span class="token punctuation">:</span></span>
<span class="">        tool_use_blocks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>block<span class="token punctuation">)</span></span>
<span class="">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Tool use: </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string"> with input </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="">    <span class="token keyword">elif</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"text"</span><span class="token punctuation">:</span></span>
<span class="">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Text: </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># First tool result (calculator)</span></span>
<span class="">calculator_result <span class="token operator">=</span> <span class="token string">"7500"</span>  <span class="token comment"># 150 * 50</span></span>
<!-- -->
<span class=""><span class="token comment"># Continue with first tool result</span></span>
<span class="">response2 <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">16000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">10000</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    tools<span class="token operator">=</span><span class="token punctuation">[</span>calculator_tool<span class="token punctuation">,</span> database_tool<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="">    extra_headers<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"anthropic-beta"</span><span class="token punctuation">:</span> <span class="token string">"interleaved-thinking-2025-05-14"</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"What's the total revenue if we sold 150 units of product A at $50 each, and how does this compare to our average monthly revenue from the database?"</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>thinking_blocks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tool_use_blocks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"tool_result"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"tool_use_id"</span><span class="token punctuation">:</span> tool_use_blocks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"content"</span><span class="token punctuation">:</span> calculator_result</span>
<span class="">            <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nAfter calculator result:"</span><span class="token punctuation">)</span></span>
<span class=""><span class="token comment"># With interleaved thinking, Claude can think about the calculator result</span></span>
<span class=""><span class="token comment"># before deciding to query the database</span></span>
<span class=""><span class="token keyword">for</span> block <span class="token keyword">in</span> response2<span class="token punctuation">.</span>content<span class="token punctuation">:</span></span>
<span class="">    <span class="token keyword">if</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"thinking"</span><span class="token punctuation">:</span></span>
<span class="">        thinking_blocks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>block<span class="token punctuation">)</span></span>
<span class="">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Interleaved thinking: </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span>thinking<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="">    <span class="token keyword">elif</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"tool_use"</span><span class="token punctuation">:</span></span>
<span class="">        tool_use_blocks<span class="token punctuation">.</span>append<span class="token punctuation">(</span>block<span class="token punctuation">)</span></span>
<span class="">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Tool use: </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string"> with input </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span><span class="token builtin">input</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Second tool result (database)</span></span>
<span class="">database_result <span class="token operator">=</span> <span class="token string">"5200"</span>  <span class="token comment"># Example average monthly revenue</span></span>
<!-- -->
<span class=""><span class="token comment"># Continue with second tool result</span></span>
<span class="">response3 <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">16000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">10000</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    tools<span class="token operator">=</span><span class="token punctuation">[</span>calculator_tool<span class="token punctuation">,</span> database_tool<span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="">    extra_headers<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"anthropic-beta"</span><span class="token punctuation">:</span> <span class="token string">"interleaved-thinking-2025-05-14"</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"What's the total revenue if we sold 150 units of product A at $50 each, and how does this compare to our average monthly revenue from the database?"</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>thinking_blocks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> tool_use_blocks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"tool_result"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"tool_use_id"</span><span class="token punctuation">:</span> tool_use_blocks<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"content"</span><span class="token punctuation">:</span> calculator_result</span>
<span class="">            <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token string">"content"</span><span class="token punctuation">:</span> thinking_blocks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">+</span> tool_use_blocks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span></span>
<span class="">        <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token punctuation">{</span></span>
<span class="">            <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"tool_result"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"tool_use_id"</span><span class="token punctuation">:</span> tool_use_blocks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">id</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"content"</span><span class="token punctuation">:</span> database_result</span>
<span class="">            <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="">        <span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nAfter database result:"</span><span class="token punctuation">)</span></span>
<span class=""><span class="token comment"># With interleaved thinking, Claude can think about both results</span></span>
<span class=""><span class="token comment"># before formulating the final response</span></span>
<span class=""><span class="token keyword">for</span> block <span class="token keyword">in</span> response3<span class="token punctuation">.</span>content<span class="token punctuation">:</span></span>
<span class="">    <span class="token keyword">if</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"thinking"</span><span class="token punctuation">:</span></span>
<span class="">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Final thinking: </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span>thinking<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<span class="">    <span class="token keyword">elif</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"text"</span><span class="token punctuation">:</span></span>
<span class="">        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Final response: </span><span class="token interpolation"><span class="token punctuation">{</span>block<span class="token punctuation">.</span>text<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
</code></pre></div></div></div></div><p>In this example with interleaved thinking:</p><ol>
<li>Claude thinks about the task initially</li>
<li>After receiving the calculator result, Claude can think again about what that result means</li>
<li>Claude then decides how to query the database based on the first result</li>
<li>After receiving the database result, Claude thinks once more about both results before formulating a final response</li>
<li>The thinking budget is distributed across all thinking blocks within the turn</li>
</ol><p>This pattern allows for more sophisticated reasoning chains where each tool’s output informs the next decision.</p></div></div></div>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="extended-thinking-with-prompt-caching"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#extended-thinking-with-prompt-caching">​</a></div><span class="cursor-pointer">Extended thinking with prompt caching</span></h2>
<p><a class="link" href="/en/docs/build-with-claude/prompt-caching">Prompt caching</a> with thinking has several important considerations:</p>
<p><strong>Thinking block context removal</strong></p>
<ul>
<li>Thinking blocks from previous turns are removed from context, which can affect cache breakpoints</li>
<li>When continuing conversations with tool use, thinking blocks are cached and count as input tokens when read from cache</li>
<li>This creates a tradeoff: while thinking blocks don’t consume context window space visually, they still count toward your input token usage when cached</li>
<li>If thinking becomes disabled, requests will fail if you pass thinking content in the current tool use turn. In other contexts, thinking content passed to the API is simply ignored</li>
</ul>
<p><strong>Cache invalidation patterns</strong></p>
<ul>
<li>Changes to thinking parameters (enabled/disabled or budget allocation) invalidate message cache breakpoints</li>
<li><a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#interleaved-thinking">Interleaved thinking</a> amplifies cache invalidation, as thinking blocks can occur between multiple <a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#extended-thinking-with-tool-use">tool calls</a></li>
<li>System prompts and tools remain cached despite thinking parameter changes or block removal</li>
</ul>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10" data-callout-type="note"><div class="text-sm prose min-w-0 w-full text-sky-900 dark:text-sky-200" data-component-part="callout-content"><p>While thinking blocks are removed for caching and context calculations, they must be preserved when continuing conversations with <a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#extended-thinking-with-tool-use">tool use</a>, especially with <a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#interleaved-thinking">interleaved thinking</a>.</p></div></div>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="understanding-thinking-block-caching-behavior"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#understanding-thinking-block-caching-behavior">​</a></div><span class="cursor-pointer">Understanding thinking block caching behavior</span></h3>
<p>When using extended thinking with tool use, thinking blocks exhibit specific caching behavior that affects token counting:</p>
<p><strong>How it works:</strong></p>
<ol>
<li>Caching only occurs when you make a subsequent request that includes tool results</li>
<li>When the subsequent request is made, the previous conversation history (including thinking blocks) can be cached</li>
<li>These cached thinking blocks count as input tokens in your usage metrics when read from the cache</li>
<li>When a non-tool-result user block is included, all previous thinking blocks are ignored and stripped from context</li>
</ol>
<p><strong>Detailed example flow:</strong></p>
<p><strong>Request 1:</strong></p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">User: "What's the weather in Paris?"</span>
</code></pre></div></div></div>
<p><strong>Response 1:</strong></p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">[thinking_block_1] + [tool_use block 1]</span>
</code></pre></div></div></div>
<p><strong>Request 2:</strong></p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">User: ["What's the weather in Paris?"], </span>
<span class="">Assistant: [thinking_block_1] + [tool_use block 1], </span>
<span class="">User: [tool_result_1, cache=True]</span>
</code></pre></div></div></div>
<p><strong>Response 2:</strong></p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">[thinking_block_2] + [text block 2]</span>
</code></pre></div></div></div>
<p>Request 2 writes a cache of the request content (not the response). The cache includes the original user message, the first thinking block, tool use block, and the tool result.</p>
<p><strong>Request 3:</strong></p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">User: ["What's the weather in Paris?"], </span>
<span class="">Assistant: [thinking_block_1] + [tool_use block 1], </span>
<span class="">User: [tool_result_1, cache=True], </span>
<span class="">Assistant: [thinking_block_2] + [text block 2], </span>
<span class="">User: [Text response, cache=True]</span>
</code></pre></div></div></div>
<p>Because a non-tool-result user block was included, all previous thinking blocks are ignored. This request will be processed the same as:</p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">User: ["What's the weather in Paris?"], </span>
<span class="">Assistant: [tool_use block 1], </span>
<span class="">User: [tool_result_1, cache=True], </span>
<span class="">Assistant: [text block 2], </span>
<span class="">User: [Text response, cache=True]</span>
</code></pre></div></div></div>
<p><strong>Key points:</strong></p>
<ul>
<li>This caching behavior happens automatically, even without explicit <code>cache_control</code> markers</li>
<li>This behavior is consistent whether using regular thinking or interleaved thinking</li>
</ul>
<div class="accordion-group [&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="system-prompt-caching-preserved-when-thinking-changes accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">System prompt caching (preserved when thinking changes)</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="system-prompt-caching-preserved-when-thinking-changes accordion children" role="contentinfo"><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:R1b99mmpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R2b99mmpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:Rd99mmpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python language-python"><code class="language-python"><span class=""><span class="token keyword">from</span> anthropic <span class="token keyword">import</span> Anthropic</span>
<span class=""><span class="token keyword">import</span> requests</span>
<span class=""><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup</span>
<!-- -->
<span class="">client <span class="token operator">=</span> Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">def</span> <span class="token function">fetch_article_content</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="">    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span></span>
<span class="">    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">    <span class="token comment"># Remove script and style elements</span></span>
<span class="">    <span class="token keyword">for</span> script <span class="token keyword">in</span> soup<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"script"</span><span class="token punctuation">,</span> <span class="token string">"style"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="">        script<span class="token punctuation">.</span>decompose<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">    <span class="token comment"># Get text</span></span>
<span class="">    text <span class="token operator">=</span> soup<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">    <span class="token comment"># Break into lines and remove leading and trailing space on each</span></span>
<span class="">    lines <span class="token operator">=</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> text<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="">    <span class="token comment"># Break multi-headlines into a line each</span></span>
<span class="">    chunks <span class="token operator">=</span> <span class="token punctuation">(</span>phrase<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> lines <span class="token keyword">for</span> phrase <span class="token keyword">in</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="">    <span class="token comment"># Drop blank lines</span></span>
<span class="">    text <span class="token operator">=</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>chunk <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks <span class="token keyword">if</span> chunk<span class="token punctuation">)</span></span>
<!-- -->
<span class="">    <span class="token keyword">return</span> text</span>
<!-- -->
<span class=""><span class="token comment"># Fetch the content of the article</span></span>
<span class="">book_url <span class="token operator">=</span> <span class="token string">"https://www.gutenberg.org/cache/epub/1342/pg1342.txt"</span></span>
<span class="">book_content <span class="token operator">=</span> fetch_article_content<span class="token punctuation">(</span>book_url<span class="token punctuation">)</span></span>
<span class=""><span class="token comment"># Use just enough text for caching (first few chapters)</span></span>
<span class="">LARGE_TEXT <span class="token operator">=</span> book_content<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">]</span></span>
<!-- -->
<span class="">SYSTEM_PROMPT<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"You are an AI assistant that is tasked with literary analysis. Analyze the following text carefully."</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"text"</span><span class="token punctuation">:</span> LARGE_TEXT<span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"cache_control"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"ephemeral"</span><span class="token punctuation">}</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">]</span></span>
<!-- -->
<span class="">MESSAGES <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"Analyze the tone of this passage."</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">]</span></span>
<!-- -->
<span class=""><span class="token comment"># First request - establish cache</span></span>
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"First request - establishing cache"</span><span class="token punctuation">)</span></span>
<span class="">response1 <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">20000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">4000</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    system<span class="token operator">=</span>SYSTEM_PROMPT<span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span>MESSAGES</span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"First response usage: </span><span class="token interpolation"><span class="token punctuation">{</span>response1<span class="token punctuation">.</span>usage<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">MESSAGES<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"content"</span><span class="token punctuation">:</span> response1<span class="token punctuation">.</span>content</span>
<span class=""><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="">MESSAGES<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"Analyze the characters in this passage."</span></span>
<span class=""><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class=""><span class="token comment"># Second request - same thinking parameters (cache hit expected)</span></span>
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nSecond request - same thinking parameters (cache hit expected)"</span><span class="token punctuation">)</span></span>
<span class="">response2 <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">20000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">4000</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    system<span class="token operator">=</span>SYSTEM_PROMPT<span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span>MESSAGES</span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Second response usage: </span><span class="token interpolation"><span class="token punctuation">{</span>response2<span class="token punctuation">.</span>usage<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Third request - different thinking parameters (cache miss for messages)</span></span>
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nThird request - different thinking parameters (cache miss for messages)"</span><span class="token punctuation">)</span></span>
<span class="">response3 <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">20000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">8000</span>  <span class="token comment"># Changed thinking budget</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    system<span class="token operator">=</span>SYSTEM_PROMPT<span class="token punctuation">,</span>  <span class="token comment"># System prompt remains cached</span></span>
<span class="">    messages<span class="token operator">=</span>MESSAGES  <span class="token comment"># Messages cache is invalidated</span></span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Third response usage: </span><span class="token interpolation"><span class="token punctuation">{</span>response3<span class="token punctuation">.</span>usage<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
</code></pre></div></div></div></div></div></div><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="messages-caching-invalidated-when-thinking-changes accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Messages caching (invalidated when thinking changes)</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="messages-caching-invalidated-when-thinking-changes accordion children" role="contentinfo"><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:Raoq9mmpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rioq9mmpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rqoq9mmpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R38q9mmpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python language-python"><code class="language-python"><span class=""><span class="token keyword">from</span> anthropic <span class="token keyword">import</span> Anthropic</span>
<span class=""><span class="token keyword">import</span> requests</span>
<span class=""><span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup</span>
<!-- -->
<span class="">client <span class="token operator">=</span> Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">def</span> <span class="token function">fetch_article_content</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="">    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span></span>
<span class="">    soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>response<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token string">'html.parser'</span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">    <span class="token comment"># Remove script and style elements</span></span>
<span class="">    <span class="token keyword">for</span> script <span class="token keyword">in</span> soup<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"script"</span><span class="token punctuation">,</span> <span class="token string">"style"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="">        script<span class="token punctuation">.</span>decompose<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">    <span class="token comment"># Get text</span></span>
<span class="">    text <span class="token operator">=</span> soup<span class="token punctuation">.</span>get_text<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">    <span class="token comment"># Break into lines and remove leading and trailing space on each</span></span>
<span class="">    lines <span class="token operator">=</span> <span class="token punctuation">(</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> text<span class="token punctuation">.</span>splitlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="">    <span class="token comment"># Break multi-headlines into a line each</span></span>
<span class="">    chunks <span class="token operator">=</span> <span class="token punctuation">(</span>phrase<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> line <span class="token keyword">in</span> lines <span class="token keyword">for</span> phrase <span class="token keyword">in</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"  "</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span>
<span class="">    <span class="token comment"># Drop blank lines</span></span>
<span class="">    text <span class="token operator">=</span> <span class="token string">'\n'</span><span class="token punctuation">.</span>join<span class="token punctuation">(</span>chunk <span class="token keyword">for</span> chunk <span class="token keyword">in</span> chunks <span class="token keyword">if</span> chunk<span class="token punctuation">)</span></span>
<!-- -->
<span class="">    <span class="token keyword">return</span> text</span>
<!-- -->
<span class=""><span class="token comment"># Fetch the content of the article</span></span>
<span class="">book_url <span class="token operator">=</span> <span class="token string">"https://www.gutenberg.org/cache/epub/1342/pg1342.txt"</span></span>
<span class="">book_content <span class="token operator">=</span> fetch_article_content<span class="token punctuation">(</span>book_url<span class="token punctuation">)</span></span>
<span class=""><span class="token comment"># Use just enough text for caching (first few chapters)</span></span>
<span class="">LARGE_TEXT <span class="token operator">=</span> book_content<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">5000</span><span class="token punctuation">]</span></span>
<!-- -->
<span class=""><span class="token comment"># No system prompt - caching in messages instead</span></span>
<span class="">MESSAGES <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token punctuation">[</span></span>
<span class="">            <span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"text"</span><span class="token punctuation">:</span> LARGE_TEXT<span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"cache_control"</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"ephemeral"</span><span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">            <span class="token punctuation">{</span></span>
<span class="">                <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token string">"text"</span><span class="token punctuation">:</span> <span class="token string">"Analyze the tone of this passage."</span></span>
<span class="">            <span class="token punctuation">}</span></span>
<span class="">        <span class="token punctuation">]</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">]</span></span>
<!-- -->
<span class=""><span class="token comment"># First request - establish cache</span></span>
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"First request - establishing cache"</span><span class="token punctuation">)</span></span>
<span class="">response1 <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">20000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">4000</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span>MESSAGES</span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"First response usage: </span><span class="token interpolation"><span class="token punctuation">{</span>response1<span class="token punctuation">.</span>usage<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">MESSAGES<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"content"</span><span class="token punctuation">:</span> response1<span class="token punctuation">.</span>content</span>
<span class=""><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="">MESSAGES<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"Analyze the characters in this passage."</span></span>
<span class=""><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class=""><span class="token comment"># Second request - same thinking parameters (cache hit expected)</span></span>
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nSecond request - same thinking parameters (cache hit expected)"</span><span class="token punctuation">)</span></span>
<span class="">response2 <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">20000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">4000</span>  <span class="token comment"># Same thinking budget</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span>MESSAGES</span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Second response usage: </span><span class="token interpolation"><span class="token punctuation">{</span>response2<span class="token punctuation">.</span>usage<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">MESSAGES<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"assistant"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"content"</span><span class="token punctuation">:</span> response2<span class="token punctuation">.</span>content</span>
<span class=""><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="">MESSAGES<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="">    <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"Analyze the setting in this passage."</span></span>
<span class=""><span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Third request - different thinking budget (cache miss expected)</span></span>
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\nThird request - different thinking budget (cache miss expected)"</span><span class="token punctuation">)</span></span>
<span class="">response3 <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-sonnet-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">20000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">8000</span>  <span class="token comment"># Different thinking budget breaks cache</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span>MESSAGES</span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Third response usage: </span><span class="token interpolation"><span class="token punctuation">{</span>response3<span class="token punctuation">.</span>usage<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span></span>
</code></pre></div></div></div></div><p>Here is the output of the script (you may see slightly different numbers)</p><div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">First request - establishing cache</span>
<span class="">First response usage: { cache_creation_input_tokens: 1370, cache_read_input_tokens: 0, input_tokens: 17, output_tokens: 700 }</span>
<!-- -->
<span class="">Second request - same thinking parameters (cache hit expected)</span>
<!-- -->
<span class="">Second response usage: { cache_creation_input_tokens: 0, cache_read_input_tokens: 1370, input_tokens: 303, output_tokens: 874 }</span>
<!-- -->
<span class="">Third request - different thinking budget (cache miss expected)</span>
<span class="">Third response usage: { cache_creation_input_tokens: 1370, cache_read_input_tokens: 0, input_tokens: 747, output_tokens: 619 }</span>
</code></pre></div></div></div><p>This example demonstrates that when caching is set up in the messages array, changing the thinking parameters (budget_tokens increased from 4000 to 8000) <strong>invalidates the cache</strong>. The third request shows no cache hit with <code>cache_creation_input_tokens=1370</code> and <code>cache_read_input_tokens=0</code>, proving that message-based caching is invalidated when thinking parameters change.</p></div></div></div>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="max-tokens-and-context-window-size-with-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#max-tokens-and-context-window-size-with-extended-thinking">​</a></div><span class="cursor-pointer">Max tokens and context window size with extended thinking</span></h2>
<p>In older Claude models (prior to Claude Sonnet 3.7), if the sum of prompt tokens and <code>max_tokens</code> exceeded the model’s context window, the system would automatically adjust <code>max_tokens</code> to fit within the context limit. This meant you could set a large <code>max_tokens</code> value and the system would silently reduce it as needed.</p>
<p>With Claude 3.7 and 4 models, <code>max_tokens</code> (which includes your thinking budget when thinking is enabled) is enforced as a strict limit. The system will now return a validation error if prompt tokens + <code>max_tokens</code> exceeds the context window size.</p>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10" data-callout-type="note"><div class="text-sm prose min-w-0 w-full text-sky-900 dark:text-sky-200" data-component-part="callout-content"><p>You can read through our <a class="link" href="/en/docs/context-windows">guide on context windows</a> for a more thorough deep dive.</p></div></div>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="the-context-window-with-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#the-context-window-with-extended-thinking">​</a></div><span class="cursor-pointer">The context window with extended thinking</span></h3>
<p>When calculating context window usage with thinking enabled, there are some considerations to be aware of:</p>
<ul>
<li>Thinking blocks from previous turns are stripped and not counted towards your context window</li>
<li>Current turn thinking counts towards your <code>max_tokens</code> limit for that turn</li>
</ul>
<p>The diagram below demonstrates the specialized token management when extended thinking is enabled:</p>

<p>The effective context window is calculated as:</p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">context window =</span>
<span class="">  (current input tokens - previous thinking tokens) +</span>
<span class="">  (thinking tokens + encrypted thinking tokens + text output tokens)</span>
</code></pre></div></div></div>
<p>We recommend using the <a class="link" href="/en/docs/build-with-claude/token-counting">token counting API</a> to get accurate token counts for your specific use case, especially when working with multi-turn conversations that include thinking.</p>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="the-context-window-with-extended-thinking-and-tool-use"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#the-context-window-with-extended-thinking-and-tool-use">​</a></div><span class="cursor-pointer">The context window with extended thinking and tool use</span></h3>
<p>When using extended thinking with tool use, thinking blocks must be explicitly preserved and returned with the tool results.</p>
<p>The effective context window calculation for extended thinking with tool use becomes:</p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-plaintext"><code><span class="">context window =</span>
<span class="">  (current input tokens + previous thinking tokens + tool use tokens) +</span>
<span class="">  (thinking tokens + encrypted thinking tokens + text output tokens)</span>
</code></pre></div></div></div>
<p>The diagram below illustrates token management for extended thinking with tool use:</p>

<h3 class="flex whitespace-pre-wrap group font-semibold" id="managing-tokens-with-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#managing-tokens-with-extended-thinking">​</a></div><span class="cursor-pointer">Managing tokens with extended thinking</span></h3>
<p>Given the context window and <code>max_tokens</code> behavior with extended thinking Claude 3.7 and 4 models, you may need to:</p>
<ul>
<li>More actively monitor and manage your token usage</li>
<li>Adjust <code>max_tokens</code> values as your prompt length changes</li>
<li>Potentially use the <a class="link" href="/en/docs/build-with-claude/token-counting">token counting endpoints</a> more frequently</li>
<li>Be aware that previous thinking blocks don’t accumulate in your context window</li>
</ul>
<p>This change has been made to provide more predictable and transparent behavior, especially as maximum token limits have increased significantly.</p>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="thinking-encryption"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#thinking-encryption">​</a></div><span class="cursor-pointer">Thinking encryption</span></h2>
<p>Full thinking content is encrypted and returned in the <code>signature</code> field. This field is used to verify that thinking blocks were generated by Claude when passed back to the API.</p>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10" data-callout-type="note"><div class="text-sm prose min-w-0 w-full text-sky-900 dark:text-sky-200" data-component-part="callout-content"><p>It is only strictly necessary to send back thinking blocks when using <a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#extended-thinking-with-tool-use">tools with extended thinking</a>. Otherwise you can omit thinking blocks from previous turns, or let the API strip them for you if you pass them back.</p><p>If sending back thinking blocks, we recommend passing everything back as you received it for consistency and to avoid potential issues.</p></div></div>
<p>Here are some important considerations on thinking encryption:</p>
<ul>
<li>When <a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#streaming-extended-thinking">streaming responses</a>, the signature is added via a <code>signature_delta</code> inside a <code>content_block_delta</code> event just before the <code>content_block_stop</code> event.</li>
<li><code>signature</code> values are significantly longer in Claude 4 than in previous models.</li>
<li>The <code>signature</code> field is an opaque field and should not be interpreted or parsed - it exists solely for verification purposes.</li>
<li><code>signature</code> values are compatible across platforms (Anthropic APIs, <a class="link" href="/en/api/claude-on-amazon-bedrock">Amazon Bedrock</a>, and <a class="link" href="/en/api/claude-on-vertex-ai">Vertex AI</a>). Values generated on one platform will be compatible with another.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="thinking-redaction"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#thinking-redaction">​</a></div><span class="cursor-pointer">Thinking redaction</span></h3>
<p>Occasionally Claude’s internal reasoning will be flagged by our safety systems. When this occurs, we encrypt some or all of the <code>thinking</code> block and return it to you as a <code>redacted_thinking</code> block. <code>redacted_thinking</code> blocks are decrypted when passed back to the API, allowing Claude to continue its response without losing context.</p>
<p>When building customer-facing applications that use extended thinking:</p>
<ul>
<li>Be aware that redacted thinking blocks contain encrypted content that isn’t human-readable</li>
<li>Consider providing a simple explanation like: “Some of Claude’s internal reasoning has been automatically encrypted for safety reasons. This doesn’t affect the quality of responses.”</li>
<li>If showing thinking blocks to users, you can filter out redacted blocks while preserving normal thinking blocks</li>
<li>Be transparent that using extended thinking features may occasionally result in some reasoning being encrypted</li>
<li>Implement appropriate error handling to gracefully manage redacted thinking without breaking your UI</li>
</ul>
<p>Here’s an example showing both normal and redacted thinking blocks:</p>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json language-json"><code class="language-json"><span class=""><span class="token punctuation">{</span></span>
<span class="">  <span class="token property">"content"</span><span class="token operator">:</span> <span class="token punctuation">[</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"thinking"</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"thinking"</span><span class="token operator">:</span> <span class="token string">"Let me analyze this step by step..."</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"signature"</span><span class="token operator">:</span> <span class="token string">"WaUjzkypQ2mUEVM36O2TxuC06KN8xyfbJwyem2dw3URve/op91XWHOEBLLqIOMfFG/UvLEczmEsUjavL...."</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"redacted_thinking"</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"data"</span><span class="token operator">:</span> <span class="token string">"EmwKAhgBEgy3va3pzix/LafPsn4aDFIT2Xlxh0L5L8rLVyIwxtE3rAFBa8cr3qpPkNRj2YfWXGmKDxH4mPnZ5sQ7vB9URj2pLmN3kF8/dW5hR7xJ0aP1oLs9yTcMnKVf2wRpEGjH9XZaBt4UvDcPrQ..."</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token punctuation">{</span></span>
<span class="">      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></span>
<span class="">      <span class="token property">"text"</span><span class="token operator">:</span> <span class="token string">"Based on my analysis..."</span></span>
<span class="">    <span class="token punctuation">}</span></span>
<span class="">  <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10" data-callout-type="note"><div class="text-sm prose min-w-0 w-full text-sky-900 dark:text-sky-200" data-component-part="callout-content"><p>Seeing redacted thinking blocks in your output is expected behavior. The model can still use this redacted reasoning to inform its responses while maintaining safety guardrails.</p><p>If you need to test redacted thinking handling in your application, you can use this special test string as your prompt: <code>ANTHROPIC_MAGIC_STRING_TRIGGER_REDACTED_THINKING_46C9A13E193C177646C7398A98432ECCCE4C1253D5E2D82641AC0E52CC2876CB</code></p></div></div>
<p>When passing <code>thinking</code> and <code>redacted_thinking</code> blocks back to the API in a multi-turn conversation, you must include the complete unmodified block back to the API for the last assistant turn. This is critical for maintaining the model’s reasoning flow. We suggest always passing back all thinking blocks to the API. For more details, see the <a class="link" href="/_sites/docs.anthropic.com/en/docs/build-with-claude/extended-thinking#preserving-thinking-blocks">Preserving thinking blocks</a> section above.</p>
<div class="accordion-group [&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="accordion border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock cursor-default" role="button"><button aria-controls="example-working-with-redacted-thinking-blocks accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl" data-component-part="accordion-button"><div class="leading-tight text-left" contenteditable="false" data-component-part="accordion-title-container"><p class="m-0 font-medium text-gray-900 dark:text-gray-200" data-component-part="accordion-title">Example: Working with redacted thinking blocks</p></div></button><div class="mt-2 mb-4 mx-6 hidden overflow-x-auto cursor-default" data-component-part="accordion-content" id="example-working-with-redacted-thinking-blocks accordion children" role="contentinfo"><p>This example demonstrates how to handle <code>redacted_thinking</code> blocks that may appear in responses when Claude’s internal reasoning contains content flagged by safety systems:</p><div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:R1bae6mpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R2bae6mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R3bae6mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Java</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:R4bae6mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light"><a class="link btn size-xs primary" href="https://console.anthropic.com/workbench/new?user=ANTHROPIC_MAGIC_STRING_TRIGGER_REDACTED_THINKING_46C9A13E193C177646C7398A98432ECCCE4C1253D5E2D82641AC0E52CC2876CB&amp;thinking.budget_tokens=16000" rel="noreferrer" style="margin:-0.25rem -0.5rem" target="_blank">Try in Console<!-- --> </a></div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:Rdae6mpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python language-python"><code class="language-python"><span class=""><span class="token keyword">import</span> anthropic</span>
<!-- -->
<span class="">client <span class="token operator">=</span> anthropic<span class="token punctuation">.</span>Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Using a special prompt that triggers redacted thinking (for demonstration purposes only)</span></span>
<span class="">response <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    model<span class="token operator">=</span><span class="token string">"claude-3-7-sonnet-20250219"</span><span class="token punctuation">,</span></span>
<span class="">    max_tokens<span class="token operator">=</span><span class="token number">16000</span><span class="token punctuation">,</span></span>
<span class="">    thinking<span class="token operator">=</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"type"</span><span class="token punctuation">:</span> <span class="token string">"enabled"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"budget_tokens"</span><span class="token punctuation">:</span> <span class="token number">10000</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">    messages<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="">        <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">        <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"ANTHROPIC_MAGIC_STRING_TRIGGER_REDACTED_THINKING_46C9A13E193C177646C7398A98432ECCCE4C1253D5E2D82641AC0E52CC2876CB"</span></span>
<span class="">    <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Identify redacted thinking blocks</span></span>
<span class="">has_redacted_thinking <span class="token operator">=</span> <span class="token builtin">any</span><span class="token punctuation">(</span></span>
<span class="">    block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token operator">==</span> <span class="token string">"redacted_thinking"</span> <span class="token keyword">for</span> block <span class="token keyword">in</span> response<span class="token punctuation">.</span>content</span>
<span class=""><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token keyword">if</span> has_redacted_thinking<span class="token punctuation">:</span></span>
<span class="">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Response contains redacted thinking blocks"</span><span class="token punctuation">)</span></span>
<span class="">    <span class="token comment"># These blocks are still usable in subsequent requests</span></span>
<!-- -->
<span class="">    <span class="token comment"># Extract all blocks (both redacted and non-redacted)</span></span>
<span class="">    all_thinking_blocks <span class="token operator">=</span> <span class="token punctuation">[</span></span>
<span class="">        block <span class="token keyword">for</span> block <span class="token keyword">in</span> response<span class="token punctuation">.</span>content</span>
<span class="">        <span class="token keyword">if</span> block<span class="token punctuation">.</span><span class="token builtin">type</span> <span class="token keyword">in</span> <span class="token punctuation">[</span><span class="token string">"thinking"</span><span class="token punctuation">,</span> <span class="token string">"redacted_thinking"</span><span class="token punctuation">]</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<!-- -->
<span class="">    <span class="token comment"># When passing to subsequent requests, include all blocks without modification</span></span>
<span class="">    <span class="token comment"># This preserves the integrity of Claude's reasoning</span></span>
<!-- -->
<span class="">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Found </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>all_thinking_blocks<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> thinking blocks total"</span></span><span class="token punctuation">)</span></span>
<span class="">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"These blocks are still billable as output tokens"</span></span><span class="token punctuation">)</span></span>
</code></pre></div></div></div></div></div></div></div>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="differences-in-thinking-across-model-versions"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#differences-in-thinking-across-model-versions">​</a></div><span class="cursor-pointer">Differences in thinking across model versions</span></h2>
<p>The Messages API handles thinking differently across Claude Sonnet 3.7 and Claude 4 models, primarily in redaction and summarization behavior.</p>
<p>See the table below for a condensed comparison:</p>
<table><thead><tr><th>Feature</th><th>Claude Sonnet 3.7</th><th>Claude 4 Models</th></tr></thead><tbody><tr><td><strong>Thinking Output</strong></td><td>Returns full thinking output</td><td>Returns summarized thinking</td></tr><tr><td><strong>Interleaved Thinking</strong></td><td>Not supported</td><td>Supported with <code>interleaved-thinking-2025-05-14</code> beta header</td></tr></tbody></table>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="pricing"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#pricing">​</a></div><span class="cursor-pointer">Pricing</span></h2>
<p>Extended thinking uses the standard token pricing scheme:</p>
<table><thead><tr><th>Model</th><th>Base Input Tokens</th><th>Cache Writes</th><th>Cache Hits</th><th>Output Tokens</th></tr></thead><tbody><tr><td>Claude Opus 4</td><td>$15 / MTok</td><td>$18.75 / MTok</td><td>$1.50 / MTok</td><td>$75 / MTok</td></tr><tr><td>Claude Sonnet 4</td><td>$3 / MTok</td><td>$3.75 / MTok</td><td>$0.30 / MTok</td><td>$15 / MTok</td></tr><tr><td>Claude Sonnet 3.7</td><td>$3 / MTok</td><td>$3.75 / MTok</td><td>$0.30 / MTok</td><td>$15 / MTok</td></tr></tbody></table>
<p>The thinking process incurs charges for:</p>
<ul>
<li>Tokens used during thinking (output tokens)</li>
<li>Thinking blocks from the last assistant turn included in subsequent requests (input tokens)</li>
<li>Standard text output tokens</li>
</ul>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-sky-500/20 bg-sky-50/50 dark:border-sky-500/30 dark:bg-sky-500/10" data-callout-type="note"><div class="text-sm prose min-w-0 w-full text-sky-900 dark:text-sky-200" data-component-part="callout-content"><p>When extended thinking is enabled, a specialized system prompt is automatically included to support this feature.</p></div></div>
<p>When using summarized thinking:</p>
<ul>
<li><strong>Input tokens</strong>: Tokens in your original request (excludes thinking tokens from previous turns)</li>
<li><strong>Output tokens (billed)</strong>: The original thinking tokens that Claude generated internally</li>
<li><strong>Output tokens (visible)</strong>: The summarized thinking tokens you see in the response</li>
<li><strong>No charge</strong>: Tokens used to generate the summary</li>
</ul>
<div class="callout my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-amber-500/20 bg-amber-50/50 dark:border-amber-500/30 dark:bg-amber-500/10" data-callout-type="warning"><div class="text-sm prose min-w-0 w-full text-amber-900 dark:text-amber-200" data-component-part="callout-content"><p>The billed output token count will <strong>not</strong> match the visible token count in the response. You are billed for the full thinking process, not the summary you see.</p></div></div>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="best-practices-and-considerations-for-extended-thinking"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#best-practices-and-considerations-for-extended-thinking">​</a></div><span class="cursor-pointer">Best practices and considerations for extended thinking</span></h2>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="working-with-thinking-budgets"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#working-with-thinking-budgets">​</a></div><span class="cursor-pointer">Working with thinking budgets</span></h3>
<ul>
<li><strong>Budget optimization:</strong> The minimum budget is 1,024 tokens. We suggest starting at the minimum and increasing the thinking budget incrementally to find the optimal range for your use case. Higher token counts enable more comprehensive reasoning but with diminishing returns depending on the task. Increasing the budget can improve response quality at the tradeoff of increased latency. For critical tasks, test different settings to find the optimal balance. Note that the thinking budget is a target rather than a strict limit—actual token usage may vary based on the task.</li>
<li><strong>Starting points:</strong> Start with larger thinking budgets (16k+ tokens) for complex tasks and adjust based on your needs.</li>
<li><strong>Large budgets:</strong> For thinking budgets above 32k, we recommend using <a class="link" href="/en/docs/build-with-claude/batch-processing">batch processing</a> to avoid networking issues. Requests pushing the model to think above 32k tokens causes long running requests that might run up against system timeouts and open connection limits.</li>
<li><strong>Token usage tracking:</strong> Monitor thinking token usage to optimize costs and performance.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="performance-considerations"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#performance-considerations">​</a></div><span class="cursor-pointer">Performance considerations</span></h3>
<ul>
<li><strong>Response times:</strong> Be prepared for potentially longer response times due to the additional processing required for the reasoning process. Factor in that generating thinking blocks may increase overall response time.</li>
<li><strong>Streaming requirements:</strong> Streaming is required when <code>max_tokens</code> is greater than 21,333. When streaming, be prepared to handle both thinking and text content blocks as they arrive.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="feature-compatibility"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#feature-compatibility">​</a></div><span class="cursor-pointer">Feature compatibility</span></h3>
<ul>
<li>Thinking isn’t compatible with <code>temperature</code> or <code>top_k</code> modifications as well as <a class="link" href="/en/docs/build-with-claude/tool-use#forcing-tool-use">forced tool use</a>.</li>
<li>When thinking is enabled, you can set <code>top_p</code> to values between 1 and 0.95.</li>
<li>You cannot pre-fill responses when thinking is enabled.</li>
<li>Changes to the thinking budget invalidate cached prompt prefixes that include messages. However, cached system prompts and tool definitions will continue to work when thinking parameters change.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group font-semibold" id="usage-guidelines"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#usage-guidelines">​</a></div><span class="cursor-pointer">Usage guidelines</span></h3>
<ul>
<li><strong>Task selection:</strong> Use extended thinking for particularly complex tasks that benefit from step-by-step reasoning like math, coding, and analysis.</li>
<li><strong>Context handling:</strong> You do not need to remove previous thinking blocks yourself. The Anthropic API automatically ignores thinking blocks from previous turns and they are not included when calculating context usage.</li>
<li><strong>Prompt engineering:</strong> Review our <a class="link" href="/en/docs/build-with-claude/prompt-engineering/extended-thinking-tips">extended thinking prompting tips</a> if you want to maximize Claude’s thinking capabilities.</li>
</ul>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="next-steps"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#next-steps">​</a></div><span class="cursor-pointer">Next steps</span></h2>
<div class="card-group not-prose grid gap-x-4 sm:grid-cols-2"><a class="card block font-normal group relative my-2 ring-2 ring-transparent rounded-2xl bg-white dark:bg-background-dark border border-gray-950/10 dark:border-white/10 overflow-hidden w-full cursor-pointer hover:!border-primary dark:hover:!border-primary-light" href="https://github.com/anthropics/anthropic-cookbook/tree/main/extended_thinking" rel="noreferrer" target="_blank"><div class="px-6 py-5 relative" data-component-part="card-content-container"><div><h2 class="not-prose font-semibold text-base text-gray-800 dark:text-white mt-4" contenteditable="false" data-component-part="card-title">Try the extended thinking cookbook</h2><div class="prose mt-1 font-normal text-sm leading-6 text-gray-600 dark:text-gray-400" data-component-part="card-content"><p>Explore practical examples of thinking in our cookbook.</p></div></div></div></a><a class="card block font-normal group relative my-2 ring-2 ring-transparent rounded-2xl bg-white dark:bg-background-dark border border-gray-950/10 dark:border-white/10 overflow-hidden w-full cursor-pointer hover:!border-primary dark:hover:!border-primary-light" href="/en/docs/build-with-claude/prompt-engineering/extended-thinking-tips"><div class="px-6 py-5 relative" data-component-part="card-content-container"><div><h2 class="not-prose font-semibold text-base text-gray-800 dark:text-white mt-4" contenteditable="false" data-component-part="card-title">Extended thinking prompting tips</h2><div class="prose mt-1 font-normal text-sm leading-6 text-gray-600 dark:text-gray-400" data-component-part="card-content"><p>Learn prompt engineering best practices for extended thinking.</p></div></div></div></a></div></div><div class="leading-6 mt-14"><div class="feedback-toolbar pb-16 w-full"><div class="flex flex-col gap-y-4 xl:flex-col xl:gap-6 min-[1400px]:flex-row md:flex-row md:justify-end"><div class="flex flex-row gap-5 items-center grow justify-between md:justify-start xl:justify-between min-[1400px]:justify-start"><p class="text-sm text-gray-600 dark:text-gray-400">Was this page helpful?</p><div class="flex flex-row gap-3 items-center"><button class="px-3.5 py-2 flex flex-row gap-3 items-center border-standard rounded-xl text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 bg-white/50 dark:bg-codeblock/50 hover:border-gray-500 hover:dark:border-gray-500"><small class="text-sm font-normal leading-4">Yes</small></button><button class="px-3.5 py-2 flex flex-row gap-3 items-center border-standard rounded-xl text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 bg-white/50 dark:bg-codeblock/50 hover:border-gray-500 hover:dark:border-gray-500"><small class="text-sm font-normal leading-4">No</small></button></div></div></div></div><div class="mb-12 px-0.5 flex items-center text-sm font-semibold text-gray-700 dark:text-gray-200" id="pagination"><a class="flex items-center space-x-3 group" href="/en/docs/build-with-claude/prompt-caching"><span class="group-hover:text-gray-900 dark:group-hover:text-white">Prompt caching</span></a><a class="flex items-center ml-auto space-x-3 group" href="/en/docs/build-with-claude/streaming"><span class="group-hover:text-gray-900 dark:group-hover:text-white">Streaming Messages</span></a></div></div></div><div class="hidden xl:flex self-start sticky xl:flex-col h-[calc(100vh-9.5rem)] top-[9.5rem]" id="content-side-layout"><div class="z-10 hidden xl:flex pl-10 box-border w-[19rem] max-h-full" id="table-of-contents-layout"><div class="text-gray-600 text-sm leading-6 w-[16.5rem] overflow-y-auto space-y-2 pb-4 -mt-10 pt-10" id="table-of-contents"><div class="text-gray-700 dark:text-gray-300 font-medium flex items-center space-x-2"><span>On this page</span></div></div></div></div></div></div></div></div></main>