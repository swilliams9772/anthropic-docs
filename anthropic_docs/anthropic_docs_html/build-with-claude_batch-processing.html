<main class="jsx-4145347147"><div class="relative antialiased text-gray-500 dark:text-gray-400"><div class="z-30 fixed lg:sticky top-0 w-full" id="navbar"><div class="max-w-8xl mx-auto relative"><div class=""><div class="relative"><div class="flex items-center lg:px-12 h-16 min-w-0 mx-4 lg:mx-0"><div class="h-full relative flex-1 flex items-center gap-x-4 min-w-0 border-b border-gray-500/5 dark:border-gray-300/[0.06]"><div class="flex-1 flex items-center gap-x-4"><a href="/"><span class="sr-only">Anthropic<!-- --> home page</span></a><div class="flex items-center gap-x-2"><button aria-expanded="false" aria-haspopup="menu" class="group bg-background-light dark:bg-background-dark disabled:pointer-events-none [&amp;&gt;span]:line-clamp-1 overflow-hidden group outline-none group-hover:text-zinc-950/70 dark:group-hover:text-white/70 text-xs gap-1.5 text-gray-500 dark:text-gray-400 leading-5 font-semibold border border-gray-200 dark:border-gray-800 hover:border-gray-300 dark:hover:border-gray-700 rounded-full py-1 px-3 flex items-center space-x-2 whitespace-nowrap" data-state="closed" id="radix-:R25fcql6:" type="button">English</button></div></div><div class="hidden lg:block mx-px relative flex-1 bg-white dark:bg-gray-900 pointer-events-auto rounded-xl min-w-0"><button class="w-full flex items-center text-sm leading-6 rounded-xl py-1.5 pl-3.5 pr-3 shadow-sm text-gray-400 dark:text-white/50 bg-background-light dark:bg-background-dark dark:brightness-[1.1] dark:ring-1 dark:hover:brightness-[1.25] ring-1 ring-gray-400/20 hover:ring-gray-600/25 dark:ring-gray-600/30 dark:hover:ring-gray-500/30 focus:outline-primary justify-between truncate gap-2 min-w-[43px]" id="search-bar-entry" type="button"><div class="flex items-center gap-3 min-w-[42px]"><div class="truncate min-w-0">Search...</div></div></button></div><div class="flex lg:hidden items-center gap-2"><button class="text-gray-500 w-8 h-8 flex items-center justify-center hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300" id="search-bar-entry-mobile" type="button"><span class="sr-only">Search...</span></button></div></div></div><div class="flex items-center h-14 py-4 px-5 lg:hidden"><button class="text-gray-500 hover:text-gray-600 dark:text-gray-400 dark:hover:text-gray-300" type="button"><span class="sr-only">Navigation</span></button><div class="ml-4 flex text-sm leading-6 whitespace-nowrap min-w-0 space-x-3"><div class="flex items-center space-x-3"><span>Build with Claude</span></div><div class="font-semibold text-gray-900 truncate dark:text-gray-200">Batch processing</div></div></div></div><div class="hidden lg:flex px-12 h-12"><div class="h-full flex text-sm space-x-6"><a class="group relative h-full flex items-center font-medium text-gray-600 dark:text-gray-400 group-hover:text-gray-800 dark:group-hover:text-gray-300" href="/en/home">Welcome</a><a class="group relative h-full flex items-center text-gray-800 dark:text-gray-200 font-semibold" href="/en/docs/welcome">User Guides</a><a class="group relative h-full flex items-center font-medium text-gray-600 dark:text-gray-400 group-hover:text-gray-800 dark:group-hover:text-gray-300" href="/en/api/getting-started">API Reference</a><a class="group relative h-full flex items-center font-medium text-gray-600 dark:text-gray-400 group-hover:text-gray-800 dark:group-hover:text-gray-300" href="/en/prompt-library/library">Prompt Library</a><a class="group relative h-full flex items-center font-medium text-gray-600 dark:text-gray-400 group-hover:text-gray-800 dark:group-hover:text-gray-300" href="/en/release-notes/overview">Release Notes</a></div></div></div></div></div><div class="max-w-8xl px-4 mx-auto lg:px-8 min-h-screen"><div class="z-20 hidden lg:block fixed bottom-0 right-auto w-[18rem] top-[7.1rem]" id="sidebar"><div class="absolute inset-0 z-10 stable-scrollbar-gutter overflow-auto pr-8 pb-10" id="sidebar-content"><div class="relative lg:text-sm lg:leading-6"><div id="navigation-items"><li class="list-none"><a class="pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://console.anthropic.com/" rel="noreferrer" target="_blank">Developer Console</a></li><li class="list-none"><a class="pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://www.anthropic.com/discord" rel="noreferrer" target="_blank">Developer Discord</a></li><li class="list-none"><a class="pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://support.anthropic.com/" rel="noreferrer" target="_blank">Support</a></li><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Get started</h5><ul><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/welcome"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/welcome" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Overview</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/initial-setup"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/initial-setup" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Initial setup</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/intro-to-claude"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/intro-to-claude" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Intro to Claude</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Learn about Claude</h5><ul><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Use cases</div></div></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Models &amp; pricing</div></div></li><li class="scroll-m-4 first:scroll-m-20" id="https://trust.anthropic.com/"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://trust.anthropic.com/" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Security and compliance</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Build with Claude</h5><ul><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/define-success"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/define-success" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Define success criteria</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/develop-tests"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/develop-tests" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Develop test cases</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/context-windows"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/context-windows" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Context windows</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/vision"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/vision" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Vision</div></div></a></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Prompt engineering</div></div></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/extended-thinking"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/extended-thinking" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Extended thinking</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/multilingual-support"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/multilingual-support" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Multilingual support</div></div></a></li><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Tool use (function calling)</div></div></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/prompt-caching"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/prompt-caching" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Prompt caching</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/pdf-support"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/pdf-support" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>PDF support</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/citations"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/citations" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Citations</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/token-counting"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/token-counting" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Token counting</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/batch-processing"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl bg-primary/10 text-primary font-semibold dark:text-primary-light dark:bg-primary-light/10" href="/en/docs/build-with-claude/batch-processing" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Batch processing</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/build-with-claude/embeddings"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/build-with-claude/embeddings" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Embeddings</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Agents and tools</h5><ul><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Claude Code</div></div></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/agents-and-tools/computer-use"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/agents-and-tools/computer-use" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Computer use (beta)</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/agents-and-tools/mcp"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/agents-and-tools/mcp" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Model Context Protocol (MCP)</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/agents-and-tools/claude-for-sheets"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/agents-and-tools/claude-for-sheets" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Google Sheets add-on</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Test and evaluate</h5><ul><li><div class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" style="padding-left:1rem"><div>Strengthen guardrails</div></div></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/test-and-evaluate/eval-tool"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/test-and-evaluate/eval-tool" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Using the Evaluation Tool</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Administration</h5><ul><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/administration/administration-api"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/administration/administration-api" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Admin API</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Resources</h5><ul><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/resources/glossary"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/resources/glossary" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Glossary</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/resources/model-deprecations"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/resources/model-deprecations" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Model deprecations</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="https://status.anthropic.com/"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://status.anthropic.com/" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>System status</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="https://assets.anthropic.com/m/61e7d27f8c8f5919/original/Claude-3-Model-Card.pdf"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://assets.anthropic.com/m/61e7d27f8c8f5919/original/Claude-3-Model-Card.pdf" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Claude 3 model card</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="https://anthropic.com/claude-3-7-sonnet-system-card"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://anthropic.com/claude-3-7-sonnet-system-card" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Claude 3.7 system card</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="https://github.com/anthropics/anthropic-cookbook"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://github.com/anthropics/anthropic-cookbook" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Anthropic Cookbook</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="https://github.com/anthropics/courses"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://github.com/anthropics/courses" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Anthropic Courses</div></div></a></li><li class="scroll-m-4 first:scroll-m-20" id="/en/docs/resources/api-features"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/docs/resources/api-features" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>API features</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200">Legal center</h5><ul><li class="scroll-m-4 first:scroll-m-20" id="https://www.anthropic.com/legal/privacy"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light space-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://www.anthropic.com/legal/privacy" style="padding-left:1rem" target="_blank"><div class="flex-1 flex items-center space-x-2.5"><div>Anthropic Privacy Policy</div></div></a></li></ul></div></div></div></div></div><div class="" id="content-container"><div class="flex flex-row gap-12 box-border w-full pt-40 lg:pt-10"><div class="relative grow box-border flex-col w-full mx-auto px-1 lg:pl-[23.7rem] lg:-ml-12 xl:w-[calc(100%-28rem)]" id="content-area"><div class="relative mt-8 prose prose-gray dark:prose-invert"><p>Batch processing is a powerful approach for handling large volumes of requests efficiently. Instead of processing requests one at a time with immediate responses, batch processing allows you to submit multiple requests together for asynchronous processing. This pattern is particularly useful when:</p>
<ul>
<li>You need to process large volumes of data</li>
<li>Immediate responses are not required</li>
<li>You want to optimize for cost efficiency</li>
<li>You’re running large-scale evaluations or analyses</li>
</ul>
<p>The Message Batches API is our first implementation of this pattern.</p>

<h1 class="flex whitespace-pre-wrap group text-2xl sm:text-3xl mt-8" id="message-batches-api"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#message-batches-api">​</a></div><span class="cursor-pointer">Message Batches API</span></h1>
<p>The Message Batches API is a powerful, cost-effective way to asynchronously process large volumes of <a href="/en/api/messages">Messages</a> requests. This approach is well-suited to tasks that do not require immediate responses, with most batches finishing in less than 1 hour while reducing costs by 50% and increasing throughput.</p>
<p>You can <a href="/en/api/creating-message-batches">explore the API reference directly</a>, in addition to this guide.</p>
<h2 class="flex whitespace-pre-wrap group" id="how-the-message-batches-api-works"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#how-the-message-batches-api-works">​</a></div><span class="cursor-pointer">How the Message Batches API works</span></h2>
<p>When you send a request to the Message Batches API:</p>
<ol>
<li>The system creates a new Message Batch with the provided Messages requests.</li>
<li>The batch is then processed asynchronously, with each request handled independently.</li>
<li>You can poll for the status of the batch and retrieve results when processing has ended for all requests.</li>
</ol>
<p>This is especially useful for bulk operations that don’t require immediate results, such as:</p>
<ul>
<li>Large-scale evaluations: Process thousands of test cases efficiently.</li>
<li>Content moderation: Analyze large volumes of user-generated content asynchronously.</li>
<li>Data analysis: Generate insights or summaries for large datasets.</li>
<li>Bulk content generation: Create large amounts of text for various purposes (e.g., product descriptions, article summaries).</li>
</ul>
<h3 class="flex whitespace-pre-wrap group" id="batch-limitations"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#batch-limitations">​</a></div><span class="cursor-pointer">Batch limitations</span></h3>
<ul>
<li>A Message Batch is limited to either 100,000 Message requests or 256 MB in size, whichever is reached first.</li>
<li>We process each batch as fast as possible, with most batches completing within 1 hour. You will be able to access batch results when all messages have completed or after 24 hours, whichever comes first. Batches will expire if processing does not complete within 24 hours.</li>
<li>Batch results are available for 29 days after creation. After that, you may still view the Batch, but its results will no longer be available for download.</li>
<li>Claude 3.7 Sonnet supports up to 128K output tokens using the <a href="/en/docs/build-with-claude/extended-thinking#extended-output-capabilities-beta">extended output capabilities</a>.</li>
<li>Batches are scoped to a <a href="https://console.anthropic.com/settings/workspaces" rel="noreferrer" target="_blank">Workspace</a>. You may view all batches—and their results—that were created within the Workspace that your API key belongs to.</li>
<li>Rate limits apply to both Batches API HTTP requests and the number of requests within a batch waiting to be processed. See <a href="/en/api/rate-limits#message-batches-api">Message Batches API rate limits</a>. Additionally, we may slow down processing based on current demand and your request volume. In that case, you may see more requests expiring after 24 hours.</li>
<li>Due to high throughput and concurrent processing, batches may go slightly over your Workspace’s configured <a href="https://console.anthropic.com/settings/limits" rel="noreferrer" target="_blank">spend limit</a>.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group" id="supported-models"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#supported-models">​</a></div><span class="cursor-pointer">Supported models</span></h3>
<p>The Message Batches API currently supports:</p>
<ul>
<li>Claude 3.7 Sonnet (<code>claude-3-7-sonnet-20250219</code>)</li>
<li>Claude 3.5 Sonnet (<code>claude-3-5-sonnet-20240620</code> and <code>claude-3-5-sonnet-20241022</code>)</li>
<li>Claude 3.5 Haiku (<code>claude-3-5-haiku-20241022</code>)</li>
<li>Claude 3 Haiku (<code>claude-3-haiku-20240307</code>)</li>
<li>Claude 3 Opus (<code>claude-3-opus-20240229</code>)</li>
</ul>
<h3 class="flex whitespace-pre-wrap group" id="what-can-be-batched"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#what-can-be-batched">​</a></div><span class="cursor-pointer">What can be batched</span></h3>
<p>Any request that you can make to the Messages API can be included in a batch. This includes:</p>
<ul>
<li>Vision</li>
<li>Tool use</li>
<li>System messages</li>
<li>Multi-turn conversations</li>
<li>Any beta features</li>
</ul>
<p>Since each request in the batch is processed independently, you can mix different types of requests within a single batch.</p>

<h2 class="flex whitespace-pre-wrap group" id="pricing"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#pricing">​</a></div><span class="cursor-pointer">Pricing</span></h2>
<p>The Batches API offers significant cost savings. All usage is charged at 50% of the standard API prices.</p>
<table><thead><tr><th>Model</th><th>Batch Input</th><th>Batch Output</th></tr></thead><tbody><tr><td>Claude 3.7 Sonnet</td><td>$1.50 / MTok</td><td>$7.50 / MTok</td></tr><tr><td>Claude 3.5 Sonnet</td><td>$1.50 / MTok</td><td>$7.50 / MTok</td></tr><tr><td>Claude 3 Opus</td><td>$7.50 / MTok</td><td>$37.50 / MTok</td></tr><tr><td>Claude 3.5 Haiku</td><td>$0.40 / MTok</td><td>$2 / MTok</td></tr><tr><td>Claude 3 Haiku</td><td>$0.125 / MTok</td><td>$0.625 / MTok</td></tr></tbody></table>

<h2 class="flex whitespace-pre-wrap group" id="how-to-use-the-message-batches-api"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#how-to-use-the-message-batches-api">​</a></div><span class="cursor-pointer">How to use the Message Batches API</span></h2>
<h3 class="flex whitespace-pre-wrap group" id="prepare-and-create-your-batch"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#prepare-and-create-your-batch">​</a></div><span class="cursor-pointer">Prepare and create your batch</span></h3>
<p>A Message Batch is composed of a list of requests to create a Message. The shape of an individual request is comprised of:</p>
<ul>
<li>A unique <code>custom_id</code> for identifying the Messages request</li>
<li>A <code>params</code> object with the standard <a href="/en/api/messages">Messages API</a> parameters</li>
</ul>
<p>You can <a href="/en/api/creating-message-batches">create a batch</a> by passing this list into the <code>requests</code> parameter:</p>
<!-- -->
<p>In this example, two separate requests are batched together for asynchronous processing. Each request has a unique <code>custom_id</code> and contains the standard parameters you’d use for a Messages API call.</p>
<div class="my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-emerald-500/20 bg-emerald-50/50 dark:border-emerald-500/30 dark:bg-emerald-500/10"><div class="text-sm prose min-w-0 text-emerald-900 dark:text-emerald-200"><p><strong>Test your batch requests with the Messages API</strong></p><p>Validation of the <code>params</code> object for each message request is performed asynchronously, and validation errors are returned when processing of the entire batch has ended. You can ensure that you are building your input correctly by verifying your request shape with the <a href="/en/api/messages">Messages API</a> first.</p></div></div>
<p>When a batch is first created, the response will have a processing status of <code>in_progress</code>.</p>
<div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="flex rounded-t-2xl text-gray-400 text-xs leading-6 border-b font-medium bg-black/40 border-gray-900/80"><div class="flex-none border-b px-4 pt-2.5 pb-2 flex items-center text-primary-light border-primary-light">JSON</div></div><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json"><code class="language-JSON"><span class=""><span class="token punctuation">{</span></span>
<span class="">  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"msgbatch_01HkcTjaV5uDC8jWR4ZsDV8d"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message_batch"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"processing_status"</span><span class="token operator">:</span> <span class="token string">"in_progress"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"request_counts"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="">    <span class="token property">"processing"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"succeeded"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"errored"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"canceled"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"expired"</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"ended_at"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-09-24T18:37:24.100435Z"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"expires_at"</span><span class="token operator">:</span> <span class="token string">"2024-09-25T18:37:24.100435Z"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"cancel_initiated_at"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"results_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<h3 class="flex whitespace-pre-wrap group" id="tracking-your-batch"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#tracking-your-batch">​</a></div><span class="cursor-pointer">Tracking your batch</span></h3>
<p>The Message Batch’s <code>processing_status</code> field indicates the stage of processing the batch is in. It starts as <code>in_progress</code>, then updates to <code>ended</code> once all the requests in the batch have finished processing, and results are ready. You can monitor the state of your batch by visiting the <a href="https://console.anthropic.com/settings/workspaces/default/batches" rel="noreferrer" target="_blank">Console</a>, or using the <a href="/en/api/retrieving-message-batches">retrieval endpoint</a>:</p>
<!-- -->
<p>You can <a href="/en/api/messages-batch-examples#polling-for-message-batch-completion">poll</a> this endpoint to know when processing has ended.</p>
<h3 class="flex whitespace-pre-wrap group" id="retrieving-batch-results"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#retrieving-batch-results">​</a></div><span class="cursor-pointer">Retrieving batch results</span></h3>
<p>Once batch processing has ended, each Messages request in the batch will have a result. There are 4 result types:</p>
<table><thead><tr><th>Result Type</th><th>Description</th></tr></thead><tbody><tr><td><code>succeeded</code></td><td>Request was successful. Includes the message result.</td></tr><tr><td><code>errored</code></td><td>Request encountered an error and a message was not created. Possible errors include invalid requests and internal server errors. You will not be billed for these requests.</td></tr><tr><td><code>canceled</code></td><td>User canceled the batch before this request could be sent to the model. You will not be billed for these requests.</td></tr><tr><td><code>expired</code></td><td>Batch reached its 24 hour expiration before this request could be sent to the model. You will not be billed for these requests.</td></tr></tbody></table>
<p>You will see an overview of your results with the batch’s <code>request_counts</code>, which shows how many requests reached each of these four states.</p>
<p>Results of the batch are available for download at the <code>results_url</code> property on the Message Batch, and if the organization permission allows, in the Console. Because of the potentially large size of the results, it’s recommended to <a href="/en/api/retrieving-message-batch-results">stream results</a> back rather than download them all at once.</p>
<!-- -->
<p>The results will be in <code>.jsonl</code> format, where each line is a valid JSON object representing the result of a single request in the Message Batch. For each streamed result, you can do something different depending on its <code>custom_id</code> and result type. Here is an example set of results:</p>
<div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="flex rounded-t-2xl text-gray-400 text-xs leading-6 border-b font-medium bg-black/40 border-gray-900/80"><div class="flex-none border-b px-4 pt-2.5 pb-2 flex items-center text-primary-light border-primary-light">.jsonl file</div></div><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json"><code class="language-JSON"><span class=""><span class="token punctuation">{</span><span class="token property">"custom_id"</span><span class="token operator">:</span><span class="token string">"my-second-request"</span><span class="token punctuation">,</span><span class="token property">"result"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"succeeded"</span><span class="token punctuation">,</span><span class="token property">"message"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"msg_014VwiXbi91y3JMjcpyGBHX5"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"assistant"</span><span class="token punctuation">,</span><span class="token property">"model"</span><span class="token operator">:</span><span class="token string">"claude-3-7-sonnet-20250219"</span><span class="token punctuation">,</span><span class="token property">"content"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token property">"text"</span><span class="token operator">:</span><span class="token string">"Hello again! It's nice to see you. How can I assist you today? Is there anything specific you'd like to chat about or any questions you have?"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"stop_reason"</span><span class="token operator">:</span><span class="token string">"end_turn"</span><span class="token punctuation">,</span><span class="token property">"stop_sequence"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"usage"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"input_tokens"</span><span class="token operator">:</span><span class="token number">11</span><span class="token punctuation">,</span><span class="token property">"output_tokens"</span><span class="token operator">:</span><span class="token number">36</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
<span class=""><span class="token punctuation">{</span><span class="token property">"custom_id"</span><span class="token operator">:</span><span class="token string">"my-first-request"</span><span class="token punctuation">,</span><span class="token property">"result"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"succeeded"</span><span class="token punctuation">,</span><span class="token property">"message"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"id"</span><span class="token operator">:</span><span class="token string">"msg_01FqfsLoHwgeFbguDgpz48m7"</span><span class="token punctuation">,</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"message"</span><span class="token punctuation">,</span><span class="token property">"role"</span><span class="token operator">:</span><span class="token string">"assistant"</span><span class="token punctuation">,</span><span class="token property">"model"</span><span class="token operator">:</span><span class="token string">"claude-3-7-sonnet-20250219"</span><span class="token punctuation">,</span><span class="token property">"content"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token property">"type"</span><span class="token operator">:</span><span class="token string">"text"</span><span class="token punctuation">,</span><span class="token property">"text"</span><span class="token operator">:</span><span class="token string">"Hello! How can I assist you today? Feel free to ask me any questions or let me know if there's anything you'd like to chat about."</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token property">"stop_reason"</span><span class="token operator">:</span><span class="token string">"end_turn"</span><span class="token punctuation">,</span><span class="token property">"stop_sequence"</span><span class="token operator">:</span><span class="token null keyword">null</span><span class="token punctuation">,</span><span class="token property">"usage"</span><span class="token operator">:</span><span class="token punctuation">{</span><span class="token property">"input_tokens"</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token property">"output_tokens"</span><span class="token operator">:</span><span class="token number">34</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<p>If your result has an error, its <code>result.error</code> will be set to our standard <a href="https://docs.anthropic.com/en/api/errors#error-shapes" rel="noreferrer" target="_blank">error shape</a>.</p>
<div class="my-4 px-5 py-4 overflow-hidden rounded-2xl flex gap-3 border border-emerald-500/20 bg-emerald-50/50 dark:border-emerald-500/30 dark:bg-emerald-500/10"><div class="text-sm prose min-w-0 text-emerald-900 dark:text-emerald-200"><p><strong>Batch results may not match input order</strong></p><p>Batch results can be returned in any order, and may not match the ordering of requests when the batch was created. In the above example, the result for the second batch request is returned before the first. To correctly match results with their corresponding requests, always use the <code>custom_id</code> field.</p></div></div>
<h3 class="flex whitespace-pre-wrap group" id="using-prompt-caching-with-message-batches"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#using-prompt-caching-with-message-batches">​</a></div><span class="cursor-pointer">Using prompt caching with Message Batches</span></h3>
<p>The Message Batches API supports prompt caching, allowing you to potentially reduce costs and processing time for batch requests. The pricing discounts from prompt caching and Message Batches can stack, providing even greater cost savings when both features are used together. However, since batch requests are processed asynchronously and concurrently, cache hits are provided on a best-effort basis. Users typically experience cache hit rates ranging from 30% to 98%, depending on their traffic patterns.</p>
<p>To maximize the likelihood of cache hits in your batch requests:</p>
<ol>
<li>Include identical <code>cache_control</code> blocks in every Message request within your batch</li>
<li>Maintain a steady stream of requests to prevent cache entries from expiring after their 5-minute lifetime</li>
<li>Structure your requests to share as much cached content as possible</li>
</ol>
<p>Example of implementing prompt caching in a batch:</p>
<!-- -->
<p>In this example, both requests in the batch include identical system messages and the full text of Pride and Prejudice marked with <code>cache_control</code> to increase the likelihood of cache hits.</p>
<h3 class="flex whitespace-pre-wrap group" id="best-practices-for-effective-batching"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#best-practices-for-effective-batching">​</a></div><span class="cursor-pointer">Best practices for effective batching</span></h3>
<p>To get the most out of the Batches API:</p>
<ul>
<li>Monitor batch processing status regularly and implement appropriate retry logic for failed requests.</li>
<li>Use meaningful <code>custom_id</code> values to easily match results with requests, since order is not guaranteed.</li>
<li>Consider breaking very large datasets into multiple batches for better manageability.</li>
<li>Dry run a single request shape with the Messages API to avoid validation errors.</li>
</ul>
<h3 class="flex whitespace-pre-wrap group" id="troubleshooting-common-issues"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#troubleshooting-common-issues">​</a></div><span class="cursor-pointer">Troubleshooting common issues</span></h3>
<p>If experiencing unexpected behavior:</p>
<ul>
<li>Verify that the total batch request size doesn’t exceed 256 MB. If the request size is too large, you may get a 413 <code>request_too_large</code> error.</li>
<li>Check that you’re using <a href="/_sites/docs.anthropic.com/en/docs/build-with-claude/batch-processing#supported-models">supported models</a> for all requests in the batch.</li>
<li>Ensure each request in the batch has a unique <code>custom_id</code>.</li>
<li>Ensure that it has been less than 29 days since batch <code>created_at</code> (not processing <code>ended_at</code>) time. If over 29 days have passed, results will no longer be viewable.</li>
<li>Confirm that the batch has not been canceled.</li>
</ul>
<p>Note that the failure of one request in a batch does not affect the processing of other requests.</p>

<h2 class="flex whitespace-pre-wrap group" id="batch-storage-and-privacy"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#batch-storage-and-privacy">​</a></div><span class="cursor-pointer">Batch storage and privacy</span></h2>
<ul>
<li>
<p><strong>Workspace isolation</strong>: Batches are isolated within the Workspace they are created in. They can only be accessed by API keys associated with that Workspace, or users with permission to view Workspace batches in the Console.</p>
</li>
<li>
<p><strong>Result availability</strong>: Batch results are available for 29 days after the batch is created, allowing ample time for retrieval and processing.</p>
</li>
</ul>

<h2 class="flex whitespace-pre-wrap group" id="faq"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#faq">​</a></div><span class="cursor-pointer">FAQ</span></h2>
<div class="[&amp;&gt;div]:border-0 [&amp;&gt;div]:rounded-none [&amp;&gt;div&gt;button]:rounded-none [&amp;&gt;div]:mb-0 overflow-hidden mt-0 mb-3 rounded-xl prose prose-gray dark:prose-invert divide-y divide-inherit border dark:border-gray-800/50"><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="how-long-does-it-take-for-a-batch-to-process accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">How long does it take for a batch to process?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="how-long-does-it-take-for-a-batch-to-process accordion children"><p>Batches may take up to 24 hours for processing, but many will finish sooner. Actual processing time depends on the size of the batch, current demand, and your request volume. It is possible for a batch to expire and not complete within 24 hours.</p></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="is-the-batches-api-available-for-all-models accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Is the Batches API available for all models?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="is-the-batches-api-available-for-all-models accordion children"><p>See <a href="/_sites/docs.anthropic.com/en/docs/build-with-claude/batch-processing#supported-models">above</a> for the list of supported models.</p></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="can-i-use-the-message-batches-api-with-other-api-features accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Can I use the Message Batches API with other API features?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="can-i-use-the-message-batches-api-with-other-api-features accordion children"><p>Yes, the Message Batches API supports all features available in the Messages API, including beta features. However, streaming is not supported for batch requests.</p></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="how-does-the-message-batches-api-affect-pricing accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">How does the Message Batches API affect pricing?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="how-does-the-message-batches-api-affect-pricing accordion children"><p>The Message Batches API offers a 50% discount on all usage compared to standard API prices. This applies to input tokens, output tokens, and any special tokens. For more on pricing, visit our <a href="https://www.anthropic.com/pricing#anthropic-api" rel="noreferrer" target="_blank">pricing page</a>.</p></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="can-i-update-a-batch-after-its-been-submitted accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Can I update a batch after it's been submitted?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="can-i-update-a-batch-after-its-been-submitted accordion children"><p>No, once a batch has been submitted, it cannot be modified. If you need to make changes, you should cancel the current batch and submit a new one. Note that cancellation may not take immediate effect.</p></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="are-there-message-batches-api-rate-limits-and-do-they-interact-with-the-messages-api-rate-limits accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Are there Message Batches API rate limits and do they interact with the Messages API rate limits?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="are-there-message-batches-api-rate-limits-and-do-they-interact-with-the-messages-api-rate-limits accordion children"><p>The Message Batches API has HTTP requests-based rate limits in addition to limits on the number of requests in need of processing. See <a href="/en/api/rate-limits#message-batches-api">Message Batches API rate limits</a>. Usage of the Batches API does not affect rate limits in the Messages API.</p></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="how-do-i-handle-errors-in-my-batch-requests accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">How do I handle errors in my batch requests?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="how-do-i-handle-errors-in-my-batch-requests accordion children"><p>When you retrieve the results, each request will have a <code>result</code> field indicating whether it <code>succeeded</code>, <code>errored</code>, was <code>canceled</code>, or <code>expired</code>. For <code>errored</code> results, additional error information will be provided. View the error response object in the <a href="/en/api/creating-message-batches">API reference</a>.</p></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="how-does-the-message-batches-api-handle-privacy-and-data-separation accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">How does the Message Batches API handle privacy and data separation?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="how-does-the-message-batches-api-handle-privacy-and-data-separation accordion children"><p>The Message Batches API is designed with strong privacy and data separation measures:</p><ol>
<li>Batches and their results are isolated within the Workspace in which they were created. This means they can only be accessed by API keys from that same Workspace.</li>
<li>Each request within a batch is processed independently, with no data leakage between requests.</li>
<li>Results are only available for a limited time (29 days), and follow our <a href="https://support.anthropic.com/en/articles/7996866-how-long-do-you-store-personal-data" rel="noreferrer" target="_blank">data retention policy</a>.</li>
<li>Downloading batch results in the Console can be disabled on the organization-level or on a per-workspace basis.</li>
</ol></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="can-i-use-prompt-caching-in-the-message-batches-api accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Can I use prompt caching in the Message Batches API?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="can-i-use-prompt-caching-in-the-message-batches-api accordion children"><p>Yes, it is possible to use prompt caching with Message Batches API. However, because asynchronous batch requests can be processed concurrently and in any order, cache hits are provided on a best-effort basis.</p></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="how-do-i-use-beta-features-in-the-message-batches-api accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">How do I use beta features in the Message Batches API?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="how-do-i-use-beta-features-in-the-message-batches-api accordion children"><p>Like the Messages API, you can provide the <code>anthropic-beta</code> header or use the top-evel <code>betas</code> field in the SDK:</p><div class="mt-5 mb-8 not-prose rounded-2xl relative text-gray-50 bg-[#0F1117] dark:bg-codeblock dark:ring-1 dark:ring-gray-800/50 codeblock-dark"><div class="flex rounded-t-2xl text-gray-400 text-xs leading-6 border-b font-medium bg-black/40 border-gray-900/80"><div class="flex-none border-b px-4 pt-2.5 pb-2 flex items-center text-primary-light border-primary-light">Python</div></div><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-python"><code class="language-python"><span class=""><span class="token keyword">import</span> anthropic</span>
<!-- -->
<span class="">client <span class="token operator">=</span> anthropic<span class="token punctuation">.</span>Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">message_batch <span class="token operator">=</span> client<span class="token punctuation">.</span>beta<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>batches<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    betas<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"output-128k-2025-02-19"</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span></span>
<span class=""><span class="token punctuation">)</span></span>
</code></pre></div></div></div><p>Note that because betas are specified only once for the entire batch, all requests within that batch will share the same beta access.</p></div></div><div class="border-standard rounded-2xl mb-3 overflow-hidden bg-background-light dark:bg-codeblock" role="button"><button aria-controls="does-the-message-batches-api-support-extended-output-capabilities-with-claude-3-7-sonnet accordion children" aria-expanded="false" class="relative not-prose flex flex-row items-center content-center w-full py-4 px-5 space-x-2 hover:bg-gray-100 hover:dark:bg-gray-800 rounded-t-xl"><div class="leading-tight text-left"><p class="m-0 font-medium text-gray-900 dark:text-gray-200">Does the Message Batches API support extended output capabilities with Claude 3.7 sonnet?</p></div></button><div class="mt-2 mb-4 mx-6 hidden" id="does-the-message-batches-api-support-extended-output-capabilities-with-claude-3-7-sonnet accordion children"><p>Yes, Claude 3.7 Sonnet’s <a href="/en/docs/build-with-claude/extended-thinking#extended-output-capabilities-beta">extended output capabilities</a> (up to 128K tokens) are supported in the Message Batches API.</p></div></div></div></div><div class="leading-6 mt-14"><div class="pb-16 w-full"><div class="flex flex-col gap-y-4 xl:flex-col xl:gap-6 min-[1400px]:flex-row md:flex-row md:justify-end"><div class="flex flex-row gap-5 items-center grow justify-between md:justify-start xl:justify-between min-[1400px]:justify-start"><p class="text-sm text-gray-600 dark:text-gray-400">Was this page helpful?</p><div class="flex flex-row gap-3 items-center"><button class="px-3.5 py-2 flex flex-row gap-3 items-center border-standard rounded-xl text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 bg-white/50 dark:bg-codeblock/50 hover:border-gray-400 hover:dark:border-gray-500"><small class="text-sm font-normal leading-4">Yes</small></button><button class="px-3.5 py-2 flex flex-row gap-3 items-center border-standard rounded-xl text-gray-600 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 bg-white/50 dark:bg-codeblock/50 hover:border-gray-400 hover:dark:border-gray-500"><small class="text-sm font-normal leading-4">No</small></button></div></div></div></div><div class="mb-12 px-0.5 flex items-center text-sm font-semibold text-gray-700 dark:text-gray-200"><a class="flex items-center space-x-3 group" href="/en/docs/build-with-claude/token-counting"><span class="group-hover:text-gray-900 dark:group-hover:text-white">Token counting</span></a><a class="flex items-center ml-auto space-x-3 group" href="/en/docs/build-with-claude/embeddings"><span class="group-hover:text-gray-900 dark:group-hover:text-white">Embeddings</span></a></div></div></div><div class="z-10 hidden xl:flex pl-10 box-border w-[19rem]" id="table-of-contents"><div class="fixed text-gray-600 text-sm leading-6 w-[16.5rem] overflow-y-auto space-y-2 h-[calc(100%-10rem)]" id="table-of-contents-content"><div class="text-gray-700 dark:text-gray-300 font-medium flex items-center space-x-2"><span>On this page</span></div><ul><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#message-batches-api">Message Batches API</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#how-the-message-batches-api-works">How the Message Batches API works</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#batch-limitations">Batch limitations</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#supported-models">Supported models</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#what-can-be-batched">What can be batched</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#pricing">Pricing</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#how-to-use-the-message-batches-api">How to use the Message Batches API</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#prepare-and-create-your-batch">Prepare and create your batch</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#tracking-your-batch">Tracking your batch</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#retrieving-batch-results">Retrieving batch results</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#using-prompt-caching-with-message-batches">Using prompt caching with Message Batches</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#best-practices-for-effective-batching">Best practices for effective batching</a></li><li style="margin-left:1rem"><a class="group flex items-start py-1 whitespace-pre-wrap text-gray-500 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#troubleshooting-common-issues">Troubleshooting common issues</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#batch-storage-and-privacy">Batch storage and privacy</a></li><li><a class="py-1 block font-medium hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="#faq">FAQ</a></li></ul></div></div></div></div></div></div></main>