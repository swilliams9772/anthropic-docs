<main class="jsx-4145347147"><div class="relative antialiased text-gray-500 dark:text-gray-400"><div class="max-w-8xl px-4 mx-auto lg:px-8"><div class="z-20 hidden lg:block fixed bottom-0 right-auto w-[18rem]" id="sidebar" style="top:7rem"><div class="absolute inset-0 z-10 stable-scrollbar-gutter overflow-auto pr-8 pb-10" id="sidebar-content"><div class="relative lg:text-sm lg:leading-6"><div id="navigation-items"><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-semibold text-primary dark:text-primary-light" href="/en/home">Documentation</a></li><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://console.anthropic.com/" rel="noreferrer" target="_blank">Developer Console</a></li><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://www.anthropic.com/discord" rel="noreferrer" target="_blank">Developer Discord</a></li><li class="list-none"><a class="link nav-anchor pl-4 group flex items-center lg:text-sm lg:leading-6 mb-5 sm:mb-4 font-medium text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="https://support.anthropic.com/" rel="noreferrer" target="_blank">Support</a></li><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">SDKs</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/api/client-sdks"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/api/client-sdks" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Client SDKs</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/api/openai-sdk"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/api/openai-sdk" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>OpenAI SDK compatibility (beta)</div></div></a></li></ul></div><div class="mt-12 lg:mt-8"><h5 class="pl-4 mb-3.5 lg:mb-2.5 font-semibold text-gray-900 dark:text-gray-200" id="sidebar-title">Examples</h5><ul id="sidebar-group"><li class="relative scroll-m-4 first:scroll-m-20" id="/en/api/messages-examples"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl hover:bg-gray-600/5 dark:hover:bg-gray-200/5 text-gray-700 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-300" href="/en/api/messages-examples" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Messages examples</div></div></a></li><li class="relative scroll-m-4 first:scroll-m-20" id="/en/api/messages-batch-examples"><a class="group mt-2 lg:mt-0 flex items-center pr-3 py-1.5 cursor-pointer focus:outline-primary dark:focus:outline-primary-light gap-x-3 rounded-xl bg-primary/10 text-primary font-semibold dark:text-primary-light dark:bg-primary-light/10" href="/en/api/messages-batch-examples" style="padding-left:1rem"><div class="flex-1 flex items-center space-x-2.5"><div>Message Batches examples</div></div></a></li></ul></div></div></div></div></div><div class="" id="content-container"><div class="flex flex-row gap-12 box-border w-full pt-40 lg:pt-10"><div class="relative grow box-border flex-col w-full mx-auto px-1 lg:pl-[23.7rem] lg:-ml-12 xl:w-[calc(100%-28rem)]" id="content-area"><div class="mdx-content relative mt-8 prose prose-gray dark:prose-invert"><p>The Message Batches API supports the same set of features as the Messages API. While this page focuses on how to use the Message Batches API, see <a class="link" href="/en/api/messages-examples">Messages API examples</a> for examples of the Messages API featureset.</p>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="creating-a-message-batch"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#creating-a-message-batch">â€‹</a></div><span class="cursor-pointer">Creating a Message Batch</span></h2>
<div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:Raoampkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rioampkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rqoampkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R38ampkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python language-python"><code class="language-Python"><span class=""><span class="token keyword">import</span> anthropic</span>
<span class=""><span class="token keyword">from</span> anthropic<span class="token punctuation">.</span>types<span class="token punctuation">.</span>message_create_params <span class="token keyword">import</span> MessageCreateParamsNonStreaming</span>
<span class=""><span class="token keyword">from</span> anthropic<span class="token punctuation">.</span>types<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>batch_create_params <span class="token keyword">import</span> Request</span>
<!-- -->
<span class="">client <span class="token operator">=</span> anthropic<span class="token punctuation">.</span>Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">message_batch <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>batches<span class="token punctuation">.</span>create<span class="token punctuation">(</span></span>
<span class="">    requests<span class="token operator">=</span><span class="token punctuation">[</span></span>
<span class="">        Request<span class="token punctuation">(</span></span>
<span class="">            custom_id<span class="token operator">=</span><span class="token string">"my-first-request"</span><span class="token punctuation">,</span></span>
<span class="">            params<span class="token operator">=</span>MessageCreateParamsNonStreaming<span class="token punctuation">(</span></span>
<span class="">                model<span class="token operator">=</span><span class="token string">"claude-opus-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">                max_tokens<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span></span>
<span class="">                messages<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="">                    <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">                    <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"Hello, world"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="">            <span class="token punctuation">)</span></span>
<span class="">        <span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="">        Request<span class="token punctuation">(</span></span>
<span class="">            custom_id<span class="token operator">=</span><span class="token string">"my-second-request"</span><span class="token punctuation">,</span></span>
<span class="">            params<span class="token operator">=</span>MessageCreateParamsNonStreaming<span class="token punctuation">(</span></span>
<span class="">                model<span class="token operator">=</span><span class="token string">"claude-opus-4-20250514"</span><span class="token punctuation">,</span></span>
<span class="">                max_tokens<span class="token operator">=</span><span class="token number">1024</span><span class="token punctuation">,</span></span>
<span class="">                messages<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="">                    <span class="token string">"role"</span><span class="token punctuation">:</span> <span class="token string">"user"</span><span class="token punctuation">,</span></span>
<span class="">                    <span class="token string">"content"</span><span class="token punctuation">:</span> <span class="token string">"Hi again, friend"</span><span class="token punctuation">,</span></span>
<span class="">                <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="">            <span class="token punctuation">)</span></span>
<span class="">        <span class="token punctuation">)</span></span>
<span class="">    <span class="token punctuation">]</span></span>
<span class=""><span class="token punctuation">)</span></span>
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span>message_batch<span class="token punctuation">)</span></span>
</code></pre></div></div></div></div>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="flex rounded-t-2xl text-gray-400 text-xs leading-6 border-b font-medium bg-black/40 border-gray-900/80" data-component-part="code-block-tab-bar"><div class="flex-none border-b px-4 pt-2.5 pb-2 flex items-center text-primary-light border-primary-light" data-component-part="code-block-tab-bar-filename">JSON</div></div><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json language-json"><code class="language-JSON"><span class=""><span class="token punctuation">{</span></span>
<span class="">  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"msgbatch_013Zva2CMHLNnXjNJJKqJ2EF"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message_batch"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"processing_status"</span><span class="token operator">:</span> <span class="token string">"in_progress"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"request_counts"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="">    <span class="token property">"processing"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"succeeded"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"errored"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"canceled"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"expired"</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"ended_at"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-09-24T18:37:24.100435Z"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"expires_at"</span><span class="token operator">:</span> <span class="token string">"2024-09-25T18:37:24.100435Z"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"cancel_initiated_at"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"results_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="polling-for-message-batch-completion"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#polling-for-message-batch-completion">â€‹</a></div><span class="cursor-pointer">Polling for Message Batch completion</span></h2>
<p>To poll a Message Batch, youâ€™ll need its <code>id</code>, which is provided in the response when <a class="link" href="/_sites/docs.anthropic.com/en/api/messages-batch-examples#creating-a-message-batch">creating</a> request or by <a class="link" href="/_sites/docs.anthropic.com/en/api/messages-batch-examples#listing-all-message-batches-in-a-workspace">listing</a> batches. Example <code>id</code>: <code>msgbatch_013Zva2CMHLNnXjNJJKqJ2EF</code>.</p>
<div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:Raoqmpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rioqmpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rqoqmpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R38qmpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python language-python"><code class="language-Python"><span class=""><span class="token keyword">import</span> anthropic</span>
<!-- -->
<span class="">client <span class="token operator">=</span> anthropic<span class="token punctuation">.</span>Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">message_batch <span class="token operator">=</span> <span class="token boolean">None</span></span>
<span class=""><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span></span>
<span class="">    message_batch <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>batches<span class="token punctuation">.</span>retrieve<span class="token punctuation">(</span></span>
<span class="">        MESSAGE_BATCH_ID</span>
<span class="">    <span class="token punctuation">)</span></span>
<span class="">    <span class="token keyword">if</span> message_batch<span class="token punctuation">.</span>processing_status <span class="token operator">==</span> <span class="token string">"ended"</span><span class="token punctuation">:</span></span>
<span class="">        <span class="token keyword">break</span></span>
<!-- -->              <!-- -->
<span class="">    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Batch </span><span class="token interpolation"><span class="token punctuation">{</span>MESSAGE_BATCH_ID<span class="token punctuation">}</span></span><span class="token string"> is still processing..."</span></span><span class="token punctuation">)</span></span>
<span class="">    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span></span>
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span>message_batch<span class="token punctuation">)</span></span>
</code></pre></div></div></div></div>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="listing-all-message-batches-in-a-workspace"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#listing-all-message-batches-in-a-workspace">â€‹</a></div><span class="cursor-pointer">Listing all Message Batches in a Workspace</span></h2>
<div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:Rap2mpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rip2mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rqp2mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R392mpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python language-python"><code class="language-Python"><span class=""><span class="token keyword">import</span> anthropic</span>
<!-- -->
<span class="">client <span class="token operator">=</span> anthropic<span class="token punctuation">.</span>Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Automatically fetches more pages as needed.</span></span>
<span class=""><span class="token keyword">for</span> message_batch <span class="token keyword">in</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>batches<span class="token punctuation">.</span><span class="token builtin">list</span><span class="token punctuation">(</span></span>
<span class="">    limit<span class="token operator">=</span><span class="token number">20</span></span>
<span class=""><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="">    <span class="token keyword">print</span><span class="token punctuation">(</span>message_batch<span class="token punctuation">)</span></span>
</code></pre></div></div></div></div>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="flex rounded-t-2xl text-gray-400 text-xs leading-6 border-b font-medium bg-black/40 border-gray-900/80" data-component-part="code-block-tab-bar"><div class="flex-none border-b px-4 pt-2.5 pb-2 flex items-center text-primary-light border-primary-light" data-component-part="code-block-tab-bar-filename">Output</div></div><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-markup language-json"><code class="language-Markup"><span class="">{</span>
<span class="">  "id": "msgbatch_013Zva2CMHLNnXjNJJKqJ2EF",</span>
<span class="">  "type": "message_batch",</span>
<span class="">  ...</span>
<span class="">}</span>
<span class="">{</span>
<span class="">  "id": "msgbatch_01HkcTjaV5uDC8jWR4ZsDV8d",</span>
<span class="">  "type": "message_batch",</span>
<span class="">  ...</span>
<span class="">}</span>
</code></pre></div></div></div>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="retrieving-message-batch-results"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#retrieving-message-batch-results">â€‹</a></div><span class="cursor-pointer">Retrieving Message Batch Results</span></h2>
<p>Once your Message Batch status is <code>ended</code>, you will be able to view the <code>results_url</code> of the batch and retrieve results in the form of a <code>.jsonl</code> file.</p>
<div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:Rapimpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Ripimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rqpimpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R39impkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python language-python"><code class="language-Python"><span class=""><span class="token keyword">import</span> anthropic</span>
<!-- -->
<span class="">client <span class="token operator">=</span> anthropic<span class="token punctuation">.</span>Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class=""><span class="token comment"># Stream results file in memory-efficient chunks, processing one at a time</span></span>
<span class=""><span class="token keyword">for</span> result <span class="token keyword">in</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>batches<span class="token punctuation">.</span>results<span class="token punctuation">(</span></span>
<span class="">    MESSAGE_BATCH_ID<span class="token punctuation">,</span></span>
<span class=""><span class="token punctuation">)</span><span class="token punctuation">:</span></span>
<span class="">    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span></span>
</code></pre></div></div></div></div>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="flex rounded-t-2xl text-gray-400 text-xs leading-6 border-b font-medium bg-black/40 border-gray-900/80" data-component-part="code-block-tab-bar"><div class="flex-none border-b px-4 pt-2.5 pb-2 flex items-center text-primary-light border-primary-light" data-component-part="code-block-tab-bar-filename">Output</div></div><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-markup language-json"><code class="language-Markup"><span class="">{</span>
<span class="">  "id": "my-second-request",</span>
<span class="">  "result": {</span>
<span class="">    "type": "succeeded",</span>
<span class="">    "message": {</span>
<span class="">      "id": "msg_018gCsTGsXkYJVqYPxTgDHBU",</span>
<span class="">      "type": "message",</span>
<span class="">      ...</span>
<span class="">    }</span>
<span class="">  }</span>
<span class="">}</span>
<span class="">{</span>
<span class="">  "custom_id": "my-first-request",</span>
<span class="">  "result": {</span>
<span class="">    "type": "succeeded",</span>
<span class="">    "message": {</span>
<span class="">      "id": "msg_01XFDUDYJgAACzvnptvVoYEL",</span>
<span class="">      "type": "message",</span>
<span class="">      ...</span>
<span class="">    }</span>
<span class="">  }</span>
<span class="">}</span>
</code></pre></div></div></div>
<h2 class="flex whitespace-pre-wrap group font-semibold" id="canceling-a-message-batch"><div class="absolute"><a aria-label="Navigate to header" class="-ml-10 flex items-center opacity-0 border-0 group-hover:opacity-100" href="#canceling-a-message-batch">â€‹</a></div><span class="cursor-pointer">Canceling a Message Batch</span></h2>
<p>Immediately after cancellation, a batchâ€™s <code>processing_status</code> will be <code>canceling</code>. You can use the same <a class="link" href="/_sites/docs.anthropic.com/en/api/messages-batch-examples#polling-for-message-batch-completion">polling for batch completion</a> technique to poll for when cancellation is finalized as canceled batches also end up <code>ended</code> and may contain results.</p>
<div class="code-group mt-5 mb-8 flex flex-col not-prose relative overflow-hidden rounded-2xl dark:border-gray-800/50 bg-[#0F1117] border border-transparent dark:bg-codeblock text-gray-50 codeblock-dark" id="code-group"><div class="relative border-b border-gray-900/80 bg-[#0F1117] dark:bg-codeblock" data-component-part="code-group-tab-bar"><div aria-orientation="horizontal" class="text-xs leading-6 rounded-t-xl flex overflow-x-auto overflow-y-hidden mr-12 scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25" role="tablist"><button aria-selected="true" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-primary-light" data-headlessui-state="selected" id="headlessui-tabs-tab-:Raq2mpkql6:" role="tab" tabindex="0" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Python</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Riq2mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">TypeScript</div></button><button aria-selected="false" class="group flex items-center relative px-2 pt-2.5 pb-2 outline-none whitespace-nowrap font-medium text-gray-400" data-headlessui-state="" id="headlessui-tabs-tab-:Rqq2mpkql6:" role="tab" tabindex="-1" type="button"><div class="px-2 rounded-lg z-10 group-hover:bg-gray-700/70 group-hover:text-primary-light">Shell</div></button></div></div><div class="flex flex-1 overflow-hidden"><div class="relative min-w-full w-full transition-[height] duration-300 ease-in-out" data-headlessui-state="selected" id="headlessui-tabs-panel-:R3a2mpkql6:" role="tabpanel" style="font-variant-ligatures:none;height:auto" tabindex="0"><div class="flex-none p-5 overflow-x-auto text-sm h-full scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25 leading-6" data-component-part="code-group-tab-content"><pre class="language-python language-python"><code class="language-Python"><span class=""><span class="token keyword">import</span> anthropic</span>
<!-- -->
<span class="">client <span class="token operator">=</span> anthropic<span class="token punctuation">.</span>Anthropic<span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<!-- -->
<span class="">message_batch <span class="token operator">=</span> client<span class="token punctuation">.</span>messages<span class="token punctuation">.</span>batches<span class="token punctuation">.</span>cancel<span class="token punctuation">(</span></span>
<span class="">    MESSAGE_BATCH_ID<span class="token punctuation">,</span></span>
<span class=""><span class="token punctuation">)</span></span>
<span class=""><span class="token keyword">print</span><span class="token punctuation">(</span>message_batch<span class="token punctuation">)</span></span>
</code></pre></div></div></div></div>
<div class="code-block mt-5 mb-8 not-prose rounded-2xl relative group text-gray-50 bg-[#0F1117] dark:bg-codeblock ring-1 ring-transparent dark:ring-gray-800/50 codeblock-dark"><div class="flex rounded-t-2xl text-gray-400 text-xs leading-6 border-b font-medium bg-black/40 border-gray-900/80" data-component-part="code-block-tab-bar"><div class="flex-none border-b px-4 pt-2.5 pb-2 flex items-center text-primary-light border-primary-light" data-component-part="code-block-tab-bar-filename">JSON</div></div><div class="min-w-full relative text-sm leading-6 children:!my-0 children:!shadow-none children:!bg-transparent transition-[height] duration-300 ease-in-out" data-component-part="code-block-root" style="font-variant-ligatures:none;height:auto"><div class="overflow-x-auto h-full p-5 [&amp;&gt;pre&gt;code]:pr-[3rem] [&amp;&gt;pre&gt;code&gt;span.line-highlight]:min-w-[calc(100%+3rem)] overflow-y-hidden scrollbar-thin scrollbar-thumb-rounded scrollbar-thumb-white/20 dark:scrollbar-thumb-white/20 hover:scrollbar-thumb-white/25 dark:hover:scrollbar-thumb-white/25 active:scrollbar-thumb-white/25 dark:active:scrollbar-thumb-white/25"><pre class="language-json language-json"><code class="language-JSON"><span class=""><span class="token punctuation">{</span></span>
<span class="">  <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"msgbatch_013Zva2CMHLNnXjNJJKqJ2EF"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"message_batch"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"processing_status"</span><span class="token operator">:</span> <span class="token string">"canceling"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"request_counts"</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="">    <span class="token property">"processing"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"succeeded"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"errored"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"canceled"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></span>
<span class="">    <span class="token property">"expired"</span><span class="token operator">:</span> <span class="token number">0</span></span>
<span class="">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"ended_at"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"created_at"</span><span class="token operator">:</span> <span class="token string">"2024-09-24T18:37:24.100435Z"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"expires_at"</span><span class="token operator">:</span> <span class="token string">"2024-09-25T18:37:24.100435Z"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"cancel_initiated_at"</span><span class="token operator">:</span> <span class="token string">"2024-09-24T18:39:03.114875Z"</span><span class="token punctuation">,</span></span>
<span class="">  <span class="token property">"results_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span></span>
<span class=""><span class="token punctuation">}</span></span>
</code></pre></div></div></div></div></div><div class="hidden xl:flex self-start sticky xl:flex-col h-[calc(100vh-9.5rem)] top-[9.5rem]" id="content-side-layout"><div class="z-10 hidden xl:flex pl-10 box-border w-[19rem] max-h-full" id="table-of-contents-layout"><div class="text-gray-600 text-sm leading-6 w-[16.5rem] overflow-y-auto space-y-2 pb-4 -mt-10 pt-10" id="table-of-contents"><div class="text-gray-700 dark:text-gray-300 font-medium flex items-center space-x-2"><span>On this page</span></div></div></div></div></div></div></div></div></main>